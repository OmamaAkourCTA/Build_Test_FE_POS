"use strict";(self.webpackChunkmarkaizaAdmin=self.webpackChunkmarkaizaAdmin||[]).push([[7172],{55034:(J,M,_)=>{_.d(M,{Y:()=>x});var e=_(94650),c=_(39485),g=_(42953),f=_(29444),m=_(36895);function T(h,k){if(1&h){const p=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){e.CHM(p);const P=e.oxw(3);return e.KtG(P.downloadInvoices())}),e._uU(1),e.qZA()}if(2&h){const p=e.oxw(3);e.xp6(1),e.hij(" ",7004==(null==p.data?null:p.data.collectionType)||7005==(null==p.data?null:p.data.collectionType)||7008==(null==p.data?null:p.data.collectionType)||7009==(null==p.data?null:p.data.collectionType)?"View Receipt":"View Invoice"," ")}}function d(h,k){if(1&h&&(e.ynx(0),e.YNc(1,T,2,1,"button",7),e.BQk()),2&h){e.oxw();const p=e.MAs(9),N=e.oxw();e.xp6(1),e.Q6J("ngIf",7001!==(null==N.data?null:N.data.collectionType)&&7002!==(null==N.data?null:N.data.collectionType)&&7003!==(null==N.data?null:N.data.collectionType))("ngIfElse",p)}}function b(h,k){if(1&h&&(e.TgZ(0,"a",9)(1,"button",10),e._uU(2,"View Invoice"),e.qZA()()),2&h){const p=e.oxw(4);e.s9C("href",null==p.data?null:p.data.invoice,e.LSH)}}function C(h,k){if(1&h&&(e.ynx(0),e.YNc(1,b,3,1,"a",8),e.BQk()),2&h){const p=e.oxw(3);e.xp6(1),e.Q6J("ngIf",10004==p.data.status&&7002!==(null==p.data?null:p.data.collectionType))}}function q(h,k){if(1&h&&(e.TgZ(0,"a",9)(1,"button",10),e._uU(2,"View Receipt"),e.qZA()()),2&h){const p=e.oxw(3);e.s9C("href",null==p.data?null:p.data.receipt,e.LSH)}}function F(h,k){if(1&h&&(e.YNc(0,C,2,1,"ng-container",4),e.YNc(1,q,3,1,"a",8)),2&h){const p=e.oxw(2);e.Q6J("ngIf",!(null!=p.data&&p.data.reverse||null!=p.data&&p.data.refund)),e.xp6(1),e.Q6J("ngIf",(10004==p.data.status||10005==p.data.status)&&"credit"!==(null==p.data?null:p.data.invoiceType)&&"internal"!==(null==p.data?null:p.data.invoiceType)&&"tmc"!==(null==p.data?null:p.data.invoiceType))}}function D(h,k){if(1&h){const p=e.EpF();e.TgZ(0,"div",1)(1,"h5"),e._UZ(2,"i",2),e._uU(3),e.qZA(),e.TgZ(4,"div",3),e.YNc(5,d,2,2,"ng-container",4),e.TgZ(6,"button",5),e.NdJ("click",function(){e.CHM(p);const P=e.oxw();return P.activeModal.close("Close click"),P.navigateTo(),e.KtG(P.emitData())}),e._uU(7,"Close "),e.qZA()(),e.YNc(8,F,2,2,"ng-template",null,6,e.W1O),e.qZA()}if(2&h){const p=e.oxw();e.xp6(3),e.hij(" ",(null!=p.data&&p.data.reverse?"Collection Successfully Updated":(null==p.data?null:p.data.refund)&&"Refund Successfully Performed")||"Your payment successfully completed"," "),e.xp6(2),e.Q6J("ngIf",!(null!=p.data&&p.data.isMultiCollect))}}function A(h,k){if(1&h&&(e.TgZ(0,"h5"),e._UZ(1,"i",13),e._uU(2),e.qZA()),2&h){const p=k.$implicit;e.xp6(2),e.hij(" ",p.errorMessageEn||p.ErrorMessageEn," ")}}function I(h,k){if(1&h){const p=e.EpF();e.TgZ(0,"div",1),e.YNc(1,A,3,1,"h5",11),e.TgZ(2,"button",12),e.NdJ("click",function(){e.CHM(p);const P=e.oxw();return P.activeModal.close("Close click"),e.KtG(P.emitData())}),e._uU(3,"Close "),e.qZA()()}if(2&h){const p=e.oxw();e.xp6(1),e.Q6J("ngForOf",p.errors)}}function y(h,k){if(1&h){const p=e.EpF();e.TgZ(0,"div",1)(1,"h5"),e._UZ(2,"i",13),e._uU(3," Payment must be completed, there is an amount left to pay "),e.qZA(),e.TgZ(4,"button",12),e.NdJ("click",function(){e.CHM(p);const P=e.oxw();return P.activeModal.close("Close click"),e.KtG(P.emitData())}),e._uU(5,"Close "),e.qZA()()}}let x=(()=>{class h{constructor(p,N,P,S){this.router=p,this.modalService=N,this.activeModal=P,this._subjectService=S,this.eventData=new e.vpe}ngOnInit(){setTimeout(()=>{},4e3)}navigateTo(){7008!==this.data?.collectionType&&(this.modalService.dismissAll(),this.routeName?this.router.navigateByUrl(`/${this.routeName}`):this._subjectService.isCollectionPaymentDone.next(!0))}emitData(){7008==this.data?.collectionType&&this._subjectService.paymentDoneModalClosed.next({closed:!0})}downloadInvoices(){Array.isArray(this.response.data)?this.response.data.forEach(N=>{this.iterateData(N)}):this.iterateData(this.response.data),this.notAutoDismiss?this.routeName&&this.router.navigateByUrl(`/${this.routeName}`):setTimeout(()=>{this.routeName?this.router.navigateByUrl(`/${this.routeName}`):this._subjectService.isCollectionPaymentDone.next(!0),this.modalService.dismissAll()},3e3)}iterateData(p){for(let N in p){let P=p[N];P&&setTimeout(()=>{this.downloadURI(P)},500)}}downloadURI(p){p.split("/").pop();var P=document.createElement("a");P.setAttribute("target","_blank"),P.href=p,document.body.appendChild(P),P.click(),P.remove()}}return h.\u0275fac=function(p){return new(p||h)(e.Y36(c.F0),e.Y36(g.FF),e.Y36(g.Kz),e.Y36(f._))},h.\u0275cmp=e.Xpm({type:h,selectors:[["app-modal-pay-done"]],inputs:{name:"name",data:"data",errors:"errors",response:"response",routeName:"routeName",notAutoDismiss:"notAutoDismiss"},outputs:{eventData:"eventData"},decls:3,vars:3,consts:[["class","message",4,"ngIf"],[1,"message"],[1,"fa-regular","fa-circle-check"],[1,"btns-group","gap-2","my-0"],[4,"ngIf"],[1,"redBtn",3,"click"],["elseBlock",""],["class","redBtn",3,"click",4,"ngIf","ngIfElse"],["target","_blank",3,"href",4,"ngIf"],["target","_blank",3,"href"],["type","button",1,"redBtn"],[4,"ngFor","ngForOf"],[1,"btn","btnclose",3,"click"],[1,"fa-regular","fa-circle-xmark"]],template:function(p,N){1&p&&(e.YNc(0,D,10,2,"div",0),e.YNc(1,I,4,1,"div",0),e.YNc(2,y,6,0,"div",0)),2&p&&(e.Q6J("ngIf","ok"==N.name),e.xp6(1),e.Q6J("ngIf","no"==N.name),e.xp6(1),e.Q6J("ngIf","remain"==N.name))},dependencies:[m.sg,m.O5],styles:[".message[_ngcontent-%COMP%]{padding:10px;text-align:center}.message[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-weight:700;font-size:18px;color:#1b212d;margin:0;padding:20px}.message[_ngcontent-%COMP%]   .fa-circle-check[_ngcontent-%COMP%]{color:#25bb00;font-size:28px;vertical-align:middle;margin:2px 10px 5px}.message[_ngcontent-%COMP%]   .fa-circle-xmark[_ngcontent-%COMP%]{color:#dc3545;font-size:28px;vertical-align:middle;margin:2px 10px 5px}.btnclose[_ngcontent-%COMP%]{border:1px solid #f5f5f5;border-radius:30px;font-size:16px;font-weight:600;color:#000;padding:10px 40px;background:#f5f5f5;margin:5px}"]}),h})()},3898:(J,M,_)=>{_.d(M,{k:()=>Zi});var e=_(94650),c=_(24006),g=_(55034),f=_(42953),m=_(36895);function T(o,a){if(1&o&&(e.ynx(0),e.TgZ(1,"p",9),e._uU(2),e.ALo(3,"number"),e.qZA(),e.BQk()),2&o){const t=e.oxw();e.xp6(2),e.hij("The remaining amount after this payment: ",e.xi3(3,1,null==t.data?null:t.data.remainingAmount,"2.3-3")," JOD")}}let d=(()=>{class o{constructor(t){this._activeModal=t}ngOnInit(){}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.Kz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-confirm-payment-modal"]],inputs:{data:"data"},decls:13,vars:3,consts:[[1,"modal-header"],[1,"font-18","fw-600"],[1,"modal-body"],[1,"m-0","font-16","fw-600"],[4,"ngIf"],[1,"modal-footer"],[1,"btns-group"],["type","button",1,"btn","btn-save",3,"click"],["type","button",1,"btn","btn-cancel",3,"click"],[1,"mt-2","font-14","fw-500"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h4",1),e._uU(2),e.qZA()(),e.TgZ(3,"div",2)(4,"p",3),e._uU(5),e.qZA(),e.YNc(6,T,4,4,"ng-container",4),e.qZA(),e.TgZ(7,"div",5)(8,"div",6)(9,"button",7),e.NdJ("click",function(){return n._activeModal.close("close")}),e._uU(10,"Yes"),e.qZA(),e.TgZ(11,"button",8),e.NdJ("click",function(){return n._activeModal.dismiss("dissmiss")}),e._uU(12,"No"),e.qZA()()()),2&t&&(e.xp6(2),e.Oqu(null!=n.data&&n.data.refund?"Confirm Refund Payment":"Confirm Payment"),e.xp6(3),e.Oqu(null!=n.data&&n.data.refund?"Are you sure you want to refund this payment?":"Do you want to continue?"),e.xp6(1),e.Q6J("ngIf",7001==n.data.collectionType||7002==n.data.collectionType||7003==n.data.collectionType))},dependencies:[m.O5,m.JJ]}),o})();var b=_(50727),C=_(43346),q=_(69082),F=_(75304),D=_(29444),A=_(68423),I=_(17489),y=_.n(I),x=_(94349),h=_(55134),k=_(80145);function p(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.resetForm())}),e._UZ(1,"img",19),e.qZA()}}function N(o,a){1&o&&(e.TgZ(0,"th"),e._uU(1,"Action"),e.qZA())}function P(o,a){1&o&&(e.TgZ(0,"span",31),e._uU(1,"Input is required"),e.qZA())}function S(o,a){1&o&&(e.TgZ(0,"span",31),e._uU(1,"Value must be greater than zero"),e.qZA())}function L(o,a){if(1&o&&(e.ynx(0),e.YNc(1,P,2,0,"span",30),e.YNc(2,S,2,0,"span",30),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n,r;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("collectedAmount"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t||null==(r=t.get("collectedAmount"))?null:r.errors.min)}}function K(o,a){if(1&o&&(e.ynx(0),e.YNc(1,L,3,2,"ng-container",9),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("collectedAmount"))?null:n.invalid)&&(null==t||null==(n=t.get("collectedAmount"))?null:n.touched)||(null==t||null==(n=t.get("collectedAmount"))?null:n.dirty))}}function H(o,a){if(1&o&&(e.TgZ(0,"span",32),e._uU(1),e.qZA()),2&o){const t=a.item,n=e.oxw(2);e.Q6J("hidden",n.currenciesArray.includes(t.lookupId)),e.xp6(1),e.hij(" ",t.name," ")}}function j(o,a){1&o&&(e.TgZ(0,"span",31),e._uU(1,"Input is required"),e.qZA())}function $(o,a){if(1&o&&(e.ynx(0),e.YNc(1,j,2,0,"span",30),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("currencyId"))?null:n.errors.required)}}function z(o,a){if(1&o&&(e.ynx(0),e.YNc(1,$,2,1,"ng-container",9),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("currencyId"))?null:n.invalid)&&(null==t||null==(n=t.get("currencyId"))?null:n.touched)||(null==t||null==(n=t.get("currencyId"))?null:n.dirty))}}function W(o,a){1&o&&(e.TgZ(0,"span",31),e._uU(1,"Input is required"),e.qZA())}function X(o,a){if(1&o&&(e.ynx(0),e.YNc(1,W,2,0,"span",30),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("cashPayerName"))?null:n.errors.required)}}function ee(o,a){if(1&o&&(e.ynx(0),e.YNc(1,X,2,1,"ng-container",9),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("cashPayerName"))?null:n.invalid)&&(null==t||null==(n=t.get("cashPayerName"))?null:n.touched)||(null==t||null==(n=t.get("cashPayerName"))?null:n.dirty))}}function te(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",35),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2).index,i=e.oxw();return e.KtG(i.removeItem(r))}),e.qZA(),e.BQk()}}function ne(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",35),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(3).index,i=e.oxw();return e.KtG(i.removeItem(r))}),e.qZA(),e.BQk()}}function oe(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"i",37),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(4),i=r.$implicit,l=r.index,s=e.oxw();return e.KtG(s.reverse(i,l))}),e.qZA(),e.BQk()}}function re(o,a){if(1&o&&e.YNc(0,oe,2,0,"ng-container",9),2&o){const t=e.oxw(3).$implicit;e.Q6J("ngIf",!t.get("isReversed").value)}}function ie(o,a){if(1&o&&(e.YNc(0,ne,2,0,"ng-container",33),e.YNc(1,re,1,1,"ng-template",null,36,e.W1O)),2&o){const t=e.MAs(2),n=e.oxw(2).$implicit;e.Q6J("ngIf",n.get("isNew").value)("ngIfElse",t)}}function ae(o,a){if(1&o&&(e.TgZ(0,"td"),e.YNc(1,te,2,0,"ng-container",33),e.YNc(2,ie,3,2,"ng-template",null,34,e.W1O),e.qZA()),2&o){const t=e.MAs(3),n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.reverse))("ngIfElse",t)}}function le(o,a){if(1&o){const t=e.EpF();e.ynx(0,20),e.TgZ(1,"tr",21)(2,"td")(3,"div",22)(4,"input",23),e.NdJ("input",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.handleAmountFocus())})("change",function(){const i=e.CHM(t).index,l=e.oxw();return e.KtG(l.handleAmountChange(i))}),e.qZA(),e.YNc(5,K,2,1,"ng-container",9),e.qZA()(),e.TgZ(6,"td")(7,"div",24)(8,"ng-select",25),e.NdJ("change",function(r){const l=e.CHM(t).index,s=e.oxw();return e.KtG(s.chooseCurrency(r,l))}),e.YNc(9,H,2,2,"ng-template",26),e.qZA(),e.YNc(10,z,2,1,"ng-container",9),e.qZA()(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td")(16,"div",22),e._UZ(17,"input",27),e.YNc(18,ee,2,1,"ng-container",9),e.qZA()(),e.TgZ(19,"td")(20,"div",28)(21,"input",29),e.NdJ("change",function(r){const l=e.CHM(t).index,s=e.oxw();return e.KtG(s.isSameCustomer(r,l))}),e.qZA()()(),e.YNc(22,ae,4,2,"td",9),e.qZA(),e.BQk()}if(2&o){const t=a.$implicit,n=a.index,r=e.oxw();let i,l,s,u;e.xp6(1),e.Q6J("formGroupName",n),e.xp6(4),e.Q6J("ngIf",null==(i=t.get("collectedAmount"))?null:i.errors),e.xp6(3),e.Q6J("items",r.currencies),e.xp6(2),e.Q6J("ngIf",null==(l=t.get("currencyId"))?null:l.errors),e.xp6(2),e.Oqu((null==t||null==(s=t.get("rate"))?null:s.value)||0),e.xp6(2),e.hij(" ",(null==t||null==t.value?null:t.value.vjod)||0," "),e.xp6(4),e.Q6J("ngIf",null==t||null==(u=t.get("cashPayerName"))?null:u.errors),e.xp6(4),e.Q6J("ngIf",!(null!=r.otherData&&r.otherData.isMultiCollect||r.otherData.refund))}}function ce(o,a){1&o&&(e.TgZ(0,"div",38)(1,"p",39),e._UZ(2,"i",40),e._uU(3,"Press Tab to add payment in another currency "),e.qZA()())}function se(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",41)(1,"label",42),e._uU(2,"Cashier Notes"),e.qZA(),e.TgZ(3,"textarea",43),e.NdJ("change",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i._subjectService.cashierNote.next(r.target.value))}),e.qZA()()}}function ue(o,a){1&o&&e._UZ(0,"i",44)}function me(o,a){if(1&o&&(e.TgZ(0,"div",45)(1,"p",46),e._uU(2),e.qZA()()),2&o){const t=e.oxw();e.xp6(2),e.Oqu(null==t.otherData?null:t.otherData.remainingAmountMessage)}}let _e=(()=>{class o{onKeydownHandler(){this.handleTabKeyDown()}constructor(t,n,r,i){this.fb=t,this._activeModal=n,this._commonService=r,this._subjectService=i,this.curruncyAry=[],this.currenciesArray=[],this.subscription=new b.w0,this.currencies=[],this.amountEvent=new e.vpe,this.formValueEvent=new e.vpe,this.colllectedViaMachine=!1}ngOnInit(){if(this.colllectedViaMachine=JSON.parse(localStorage.getItem("pos_mc")),this.initForm(),this.cashForm.statusChanges.subscribe(t=>{let n;this.cashForm.markAllAsTouched(),n=this.otherData?.reverse?!("VALID"==t||"DISABLED"==t):"VALID"!=t,this.formValueEvent.emit({values:this.cashForm.getRawValue(),touched:n})}),this.recentFormValues?.cash?.cashArray?.length){let t=this.cashForm.controls.cashArray;t.removeAt(0);for(let n of this.recentFormValues?.cash?.cashArray)t.push(this.initCashForm(n)),this.currenciesArray.push(n.currencyId);this.otherData?.reverse&&this.disableReversedItems()}this.otherData?.refund&&this.cashArrControls.disable({emitEvent:!1})}disableReversedItems(){this.cashArrControls.controls.forEach(t=>{t.get("isNew").value||t.disable()})}ngOnDestroy(){this.subscription.unsubscribe(),this.recentFormValues?.cash?.cashArray[0]?.collectedAmount>0&&this.formValueEvent.emit({values:this.cashForm.getRawValue(),touched:!1})}closeModal(){this._activeModal?this._activeModal.close():this._commonService.NavigateToRoute(`/${this.otherData?.redirectRoute}`)}initForm(){this.cashForm=this.fb.group({cashArray:this.fb.array([this.initCashForm()])})}initCashForm(t){return this.fb.group(t?{currencyId:[t?.currencyId,[c.kI.required]],collectedAmount:[t?.collectedAmount,[c.kI.required,c.kI.min(1e-16)]],vjod:t?.vjod,sameCustomer:[t?.sameCustomer],cashPayerName:[t?.cashPayerName,7004!=this.otherData.collectionType&&[c.kI.required]],rate:[t?.rate],isReversed:[(t?.isReversed??t?.isReversed)||!1],isNew:[(t?.isNew??t?.isNew)||!1],lineNew:[(t?.lineNew??t?.lineNew)||!1]}:{currencyId:[9001,[c.kI.required]],collectedAmount:[null,[c.kI.required,c.kI.min(1e-16)]],vjod:null,sameCustomer:[!0],cashPayerName:[localStorage.getItem("pmcn")||"No Customer",7004!=this.otherData.collectionType&&[c.kI.required]],rate:[1],isReversed:[!1],isNew:!0,lineNew:!0})}handleTabKeyDown(){this.otherData?.refund||this.cashForm.invalid||this.otherData.amountExceeded||this.otherData?.isMultiCollect||this.addNewCurrency()}handleAmountFocus(){this.cashForm.markAllAsTouched()}chooseCurrency(t,n){this.cashForm.markAllAsTouched();let r=this.cashArrControls.at(n).get("vjod"),i=+this.cashArrControls.at(n).get("collectedAmount").value,s=(i*+t?.rate).toFixed(3);this.cashArrControls.at(n).get("rate").setValue(t?.rate),9001==t?.lookupId?r.setValue((1*i).toFixed(3)):(9002==t?.lookupId||9003==t?.lookupId)&&r.setValue(s),this.currenciesArray=[];for(let u of this.cashArrControls.controls)this.currenciesArray.push(u.controls.currencyId.value);this.calculateAmount()}handleAmountChange(t){let n=this.cashArrControls.at(t).get("vjod"),l=(+this.cashArrControls.at(t).get("collectedAmount").value*+this.cashArrControls.at(t).get("rate").value).toFixed(3);n.setValue(l),this.calculateAmount()}reverse(t,n){const r=this.cashArrControls.at(n);if(r.invalid)return;const i=this.fb.group({});Object.keys(r.controls).forEach(v=>{const Z=I.cloneDeep(r.get(v)?.value);i.addControl(v,new c.NI(Z))});let l=+r.get("vjod").value,s=-1*r.get("collectedAmount").value;i.patchValue({vjod:-1*l,collectedAmount:s,isReversed:!0,lineNew:!0}),r.get("isReversed").setValue(!0),r.get("lineNew").setValue(!1),this.cashArrControls.insert(n+1,i),this.cashArrControls.at(n).disable(),this.cashArrControls.at(n+1).disable(),this.calculateAmount()}calculateAmount(){let t=0;for(let n of this.cashArrControls.controls)t+=+n.controls.vjod.getRawValue();this.amountEvent.emit({amount:t})}removeItem(t){if(!this.otherData.refund){this.cashArrControls.removeAt(t),this.currenciesArray=[];for(let n of this.cashArrControls.controls)this.currenciesArray.push(n.controls.currencyId.value);this.calculateAmount()}}addNewCurrency(){let t=this.cashArrControls.length+1;this.otherData?.reverse&&(t-=this.getDisabledFormGroupCount()),t<=this.currencies.length&&this.cashArrControls.push(this.initCashForm()),this.cashForm.markAsUntouched()}getDisabledFormGroupCount(){let t=0;return this.cashArrControls.controls.forEach(n=>{n.disabled&&t++}),t}resetForm(){this.cashArrControls.clear(),this.cashArrControls.push(this.initCashForm()),this.cashForm.markAsUntouched(),this.formValueEvent.emit({values:this.cashForm.getRawValue(),touched:!1,reset:!0}),this.calculateAmount(),this.currenciesArray=[],this.amountEvent.emit({amount:0})}isSameCustomer(t,n){let r=this.cashArrControls.at(n);if(t.target.checked)if(7004==this.otherData.collectionType)r.controls.cashPayerName.setValue("No Customer");else{let i=localStorage.getItem("pmcn");r.controls.cashPayerName.setValue(i)}else r.controls.cashPayerName.setValue("")}get cashArrControls(){return this.cashForm?this.cashForm.get("cashArray"):null}get f(){return this.cashForm.controls}handleSubmit(){this.cashForm.invalid?this.cashForm.markAllAsTouched():this.formValueEvent.emit({values:this.cashForm.getRawValue(),submit:!0})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.qu),e.Y36(f.Kz,8),e.Y36(F.v),e.Y36(D._))},o.\u0275cmp=e.Xpm({type:o,selectors:[["paymentCashForm"]],hostBindings:function(t,n){1&t&&e.NdJ("keydown.tab",function(i){return n.onKeydownHandler(i)},!1,e.evT)},inputs:{currencies:"currencies",isPending:"isPending",recentFormValues:"recentFormValues",otherData:"otherData"},outputs:{amountEvent:"amountEvent",formValueEvent:"formValueEvent"},decls:37,vars:11,consts:[[1,"tab-item"],[1,"row"],[1,"col-md-12","text-end","my-2"],["type","button","class","btn btn-trash",3,"click",4,"ngIf"],[3,"formGroup","submit"],[1,"col-md-12"],[1,"card-table"],[1,""],[1,"table"],[4,"ngIf"],["formArrayName","cashArray",4,"ngFor","ngForOf"],["class","col-md-12 d-flex mt-2",4,"ngIf"],["class","col-12 mb-4",4,"ngIf"],[1,"btns-group","my-2","me-0"],["type","button",1,"btn","btn-cancel",3,"disabled","click"],["type","submit",1,"btn","btn-save",3,"disabled"],["class","fa-solid fa-circle-notch fa-spin",4,"ngIf"],["class","col-12 ng_validation",4,"ngIf"],["type","button",1,"btn","btn-trash",3,"click"],["src","assets/images/reload.png","alt","",2,"width","25px"],["formArrayName","cashArray"],[3,"formGroupName"],[1,"form-group"],["type","number","placeholder","Amount","formControlName","collectedAmount","appDecimalNumber","",1,"form-control",3,"input","change"],[1,"ngselect-curruncy","form-group"],["placeholder","Currency","bindLabel","name","bindValue","lookupId","formControlName","currencyId",3,"items","change"],["ng-option-tmp",""],["type","text","placeholder","","formControlName","cashPayerName","OnlyCharacter","",1,"form-control"],[1,"form-check"],["type","checkbox","formControlName","sameCustomer",1,"form-check-input",3,"change"],["class","error",4,"ngIf"],[1,"error"],[3,"hidden"],[4,"ngIf","ngIfElse"],["reverseCase",""],["src","assets/images/trash.png","alt","",1,"cursor-pointer",2,"width","25px",3,"click"],["reverseTemp",""],[1,"cursor-pointer","green-clr","fas","fa-rotate-left","font-20",3,"click"],[1,"col-md-12","d-flex","mt-2"],[1,"blue-clr","d-flex","align-items-center","fw-500","gap-1"],[1,"fa-solid","fa-circle-plus","primary-clr","fa-2x"],[1,"col-12","mb-4"],[1,"input-label"],[1,"form-control",3,"change"],[1,"fa-solid","fa-circle-notch","fa-spin"],[1,"col-12","ng_validation"],[1,"alert","alert-danger"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e.YNc(3,p,2,0,"button",3),e.qZA(),e.TgZ(4,"form",4),e.NdJ("submit",function(){return n.handleSubmit()}),e.TgZ(5,"div",1)(6,"div",5)(7,"div",6)(8,"div",7)(9,"table",8)(10,"thead")(11,"tr")(12,"th"),e._uU(13,"Amount To Pay"),e.qZA(),e.TgZ(14,"th"),e._uU(15,"Currency"),e.qZA(),e.TgZ(16,"th"),e._uU(17,"Rate"),e.qZA(),e.TgZ(18,"th"),e._uU(19,"Value in JOD"),e.qZA(),e.TgZ(20,"th"),e._uU(21,"Payer Name"),e.qZA(),e.TgZ(22,"th"),e._uU(23,"Same Customer"),e.qZA(),e.YNc(24,N,2,0,"th",9),e.qZA()(),e.TgZ(25,"tbody"),e.YNc(26,le,23,8,"ng-container",10),e.qZA()()()(),e.YNc(27,ce,4,0,"div",11),e.qZA()(),e.YNc(28,se,4,0,"div",12),e.TgZ(29,"div",5)(30,"div",13)(31,"button",14),e.NdJ("click",function(){return n.closeModal()}),e._uU(32,"Cancel"),e.qZA(),e.TgZ(33,"button",15),e._uU(34),e.YNc(35,ue,1,0,"i",16),e.qZA()()()(),e.YNc(36,me,3,1,"div",17),e.qZA()()),2&t&&(e.xp6(3),e.Q6J("ngIf",!(n.otherData.reverse||null!=n.otherData&&n.otherData.refund)),e.xp6(1),e.Q6J("formGroup",n.cashForm),e.xp6(20),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.isMultiCollect)),e.xp6(2),e.Q6J("ngForOf",null==n.cashArrControls?null:n.cashArrControls.controls),e.xp6(1),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.isMultiCollect||null!=n.otherData&&n.otherData.refund)),e.xp6(1),e.Q6J("ngIf",7001==n.otherData.collectionType||7004==n.otherData.collectionType||7005==n.otherData.collectionType||7008==n.otherData.collectionType||7009==n.otherData.collectionType||7002==n.otherData.collectionType&&n.otherData.refund),e.xp6(3),e.Q6J("disabled",n.colllectedViaMachine),e.xp6(2),e.Q6J("disabled",n.isPending),e.xp6(1),e.hij(" ",n.isPending?"Saving":"Confirm"," "),e.xp6(1),e.Q6J("ngIf",n.isPending),e.xp6(1),e.Q6J("ngIf",null==n.otherData?null:n.otherData.remainingAmountMessage))},dependencies:[m.sg,m.O5,c._Y,c.Fj,c.wV,c.Wl,c.JJ,c.JL,c.sg,c.u,c.x0,c.CE,x.w9,x.ir,h.Q,k.Q],styles:[".form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;margin-bottom:7px}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:46px}.form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:red;font-weight:500;font-size:14px}  .ng-dropdown-panel{z-index:9999999!important}.card-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 0 10px 15px!important}.form-check-input[_ngcontent-%COMP%]{width:20px!important;height:20px}.card-table[_ngcontent-%COMP%]{overflow:visible}.card-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:500}"]}),o})();var Q=_(32298),Y=_(72402);const de=["fileInput"],pe=["fileInput2"];function ge(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.resetForm())}),e._UZ(1,"img",20),e.qZA()}}function he(o,a){1&o&&(e.TgZ(0,"th"),e._uU(1,"Finance"),e._UZ(2,"br"),e._uU(3,"Approval"),e.qZA())}function fe(o,a){1&o&&(e.TgZ(0,"th"),e._uU(1,"Action"),e.qZA())}function Ce(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function ve(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Value must be greater than zero"),e.qZA())}function ye(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Ce,2,0,"span",36),e.YNc(2,ve,2,0,"span",36),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n,r;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("chequeCollectionJod"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t||null==(r=t.get("chequeCollectionJod"))?null:r.errors.min)}}function xe(o,a){if(1&o&&(e.ynx(0),e.YNc(1,ye,3,2,"ng-container",11),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("chequeCollectionJod"))?null:n.invalid)&&(null==t||null==(n=t.get("chequeCollectionJod"))?null:n.touched)||(null==t||null==(n=t.get("chequeCollectionJod"))?null:n.dirty))}}function Ae(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function Te(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Ae,2,0,"span",36),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("currencyId"))?null:n.errors.required)}}function be(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Te,2,1,"ng-container",11),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("currencyId"))?null:n.invalid)&&(null==t||null==(n=t.get("currencyId"))?null:n.touched)||(null==t||null==(n=t.get("currencyId"))?null:n.dirty))}}function Ie(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function ke(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Ie,2,0,"span",36),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("chequeDate"))?null:n.errors.required)}}function Ne(o,a){if(1&o&&(e.ynx(0),e.YNc(1,ke,2,1,"ng-container",11),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("chequeDate"))?null:n.invalid)&&(null==t||null==(n=t.get("chequeDate"))?null:n.touched)||(null==t||null==(n=t.get("chequeDate"))?null:n.dirty))}}function Ze(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function we(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input allows only digits"),e.qZA())}function qe(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Ze,2,0,"span",36),e.YNc(2,we,2,0,"span",36),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n,r;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("chequeNo"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t||null==(r=t.get("chequeNo"))?null:r.errors.pattern)}}function Fe(o,a){if(1&o&&(e.ynx(0),e.YNc(1,qe,3,2,"ng-container",11),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("chequeNo"))?null:n.invalid)&&(null==t||null==(n=t.get("chequeNo"))?null:n.touched)||(null==t||null==(n=t.get("chequeNo"))?null:n.dirty))}}function Pe(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function Me(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Pe,2,0,"span",36),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("bankId"))?null:n.errors.required)}}function De(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Me,2,1,"ng-container",11),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("bankId"))?null:n.invalid)&&(null==t||null==(n=t.get("bankId"))?null:n.touched)||(null==t||null==(n=t.get("bankId"))?null:n.dirty))}}function Je(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"input",38,39),e.NdJ("change",function(r){e.CHM(t);const i=e.oxw().index,l=e.oxw();return e.KtG(l.onFileChange(r,i,"chequeImage"))}),e.qZA()}if(2&o){const t=e.oxw().index;e.Q6J("id",t+"file-input")}}function Ve(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",40),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(),i=r.$implicit,l=r.index,s=e.oxw();return e.KtG(s.fileAction(null==i?null:i.value.attachment,l,"view","chequeImage"))}),e.qZA(),e.TgZ(2,"img",41),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(),i=r.$implicit,l=r.index,s=e.oxw();return e.KtG(s.fileAction(null==i?null:i.value.attachment,l,"delete","chequeImage"))}),e.qZA(),e.BQk()}}function Oe(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function Se(o,a){if(1&o&&(e.ynx(0),e.TgZ(1,"div",23),e.YNc(2,Oe,2,0,"span",36),e.qZA(),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(2),e.Q6J("ngIf",null==t||null==(n=t.get("attachment"))?null:n.errors.required)}}function Qe(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Se,3,1,"ng-container",11),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("attachment"))?null:n.invalid)&&(null==t||null==(n=t.get("attachment"))?null:n.touched)||(null==t||null==(n=t.get("attachment"))?null:n.dirty))}}function Re(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"input",38,42),e.NdJ("change",function(r){e.CHM(t);const i=e.oxw(2).index,l=e.oxw();return e.KtG(l.onFileChange(r,i,"financeApproval"))}),e.qZA()}if(2&o){const t=e.oxw(2).index;e.Q6J("id",t+"file-input2")}}function Ue(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",40),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2),i=r.$implicit,l=r.index,s=e.oxw();return e.KtG(s.fileAction(null==i?null:i.value.tempFinanceAttachment,l,"view","financeApproval"))}),e.qZA(),e.TgZ(2,"img",41),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2),i=r.$implicit,l=r.index,s=e.oxw();return e.KtG(s.fileAction(null==i?null:i.value.tempFinanceAttachment,l,"delete","financeApproval"))}),e.qZA(),e.BQk()}}function Ye(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function Be(o,a){if(1&o&&(e.ynx(0),e.TgZ(1,"div",23),e.YNc(2,Ye,2,0,"span",36),e.qZA(),e.BQk()),2&o){const t=e.oxw(3).$implicit;let n;e.xp6(2),e.Q6J("ngIf",null==t||null==(n=t.get("tempFinanceAttachment"))?null:n.errors.required)}}function Ee(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Be,3,1,"ng-container",11),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("tempFinanceAttachment"))?null:n.invalid)&&(null==t||null==(n=t.get("tempFinanceAttachment"))?null:n.touched)||(null==t||null==(n=t.get("tempFinanceAttachment"))?null:n.dirty))}}function Ge(o,a){if(1&o&&(e.TgZ(0,"td")(1,"div",30),e.YNc(2,Re,2,1,"input",31),e.TgZ(3,"label",32),e._uU(4),e.qZA(),e.YNc(5,Ue,3,0,"ng-container",11),e.qZA(),e.YNc(6,Ee,2,1,"ng-container",11),e.qZA()),2&o){const t=e.oxw(),n=t.$implicit,r=t.index;let i;e.xp6(2),e.Q6J("ngIf",n.get("isNew").value),e.xp6(1),e.ekj("text-success",null==n?null:n.value.tempFinanceAttachment),e.uIk("for",r+"file-input2"),e.xp6(1),e.hij(" ",(null==n?null:n.value.tempFinanceAttachment)&&(null==n?null:n.value.tempFinanceAttachment)||"Upload"," "),e.xp6(1),e.Q6J("ngIf",null==n?null:n.value.tempFinanceAttachment),e.xp6(1),e.Q6J("ngIf",null==n||null==(i=n.get("tempFinanceAttachment"))?null:i.errors)}}function Le(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function Ke(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Le,2,0,"span",36),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("chequeDrawerName"))?null:n.errors.required)}}function He(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Ke,2,1,"ng-container",11),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("chequeDrawerName"))?null:n.invalid)&&(null==t||null==(n=t.get("chequeDrawerName"))?null:n.touched)||(null==t||null==(n=t.get("chequeDrawerName"))?null:n.dirty))}}function je(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",45),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2).index,i=e.oxw();return e.KtG(i.removeItem(r))}),e.qZA(),e.BQk()}}function $e(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",45),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(3).index,i=e.oxw();return e.KtG(i.removeItem(r))}),e.qZA(),e.BQk()}}function ze(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"i",47),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(4),i=r.$implicit,l=r.index,s=e.oxw();return e.KtG(s.reverse(i,l))}),e.qZA(),e.BQk()}}function We(o,a){if(1&o&&e.YNc(0,ze,2,0,"ng-container",11),2&o){const t=e.oxw(3).$implicit;e.Q6J("ngIf",!t.get("isReversed").value)}}function Xe(o,a){if(1&o&&(e.YNc(0,$e,2,0,"ng-container",43),e.YNc(1,We,1,1,"ng-template",null,46,e.W1O)),2&o){const t=e.MAs(2),n=e.oxw(2).$implicit;e.Q6J("ngIf",n.get("isNew").value)("ngIfElse",t)}}function et(o,a){if(1&o&&(e.TgZ(0,"td"),e.YNc(1,je,2,0,"ng-container",43),e.YNc(2,Xe,3,2,"ng-template",null,44,e.W1O),e.qZA()),2&o){const t=e.MAs(3),n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.reverse))("ngIfElse",t)}}const tt=function(){return{containerClass:"theme-red",dateInputFormat:"DD-MM-YYYY"}};function nt(o,a){if(1&o){const t=e.EpF();e.ynx(0,21),e.TgZ(1,"tr",22)(2,"td")(3,"div",23)(4,"input",24),e.NdJ("input",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.handleAmountFocus())})("change",function(){const i=e.CHM(t).index,l=e.oxw();return e.KtG(l.convertCash(i))}),e.qZA(),e.YNc(5,xe,2,1,"ng-container",11),e.qZA()(),e.TgZ(6,"td")(7,"div",25)(8,"ng-select",26),e.NdJ("change",function(r){const l=e.CHM(t).index,s=e.oxw();return e.KtG(s.chooseCurrency(r,l))}),e.qZA(),e.YNc(9,be,2,1,"ng-container",11),e.qZA()(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td"),e._uU(13),e.qZA(),e.TgZ(14,"td")(15,"div",23)(16,"input",27),e.NdJ("bsValueChange",function(r){const l=e.CHM(t).index,s=e.oxw();return e.KtG(s.onDateValueChange(r,l))}),e.qZA(),e.YNc(17,Ne,2,1,"ng-container",11),e.qZA()(),e.TgZ(18,"td")(19,"div",23),e._UZ(20,"input",28),e.YNc(21,Fe,2,1,"ng-container",11),e.qZA()(),e.TgZ(22,"td")(23,"div",23),e._UZ(24,"ng-select",29),e.YNc(25,De,2,1,"ng-container",11),e.qZA()(),e.TgZ(26,"td")(27,"div",30),e.YNc(28,Je,2,1,"input",31),e.TgZ(29,"label",32),e._uU(30),e.qZA(),e.YNc(31,Ve,3,0,"ng-container",11),e.qZA(),e.YNc(32,Qe,2,1,"ng-container",11),e.qZA(),e.YNc(33,Ge,7,7,"td",11),e.TgZ(34,"td")(35,"div",23),e._UZ(36,"input",33),e.YNc(37,He,2,1,"ng-container",11),e.qZA()(),e.TgZ(38,"td")(39,"div",34)(40,"input",35),e.NdJ("change",function(r){const l=e.CHM(t).index,s=e.oxw();return e.KtG(s.isSameCustomer(r,l))}),e.qZA()()(),e.YNc(41,et,4,2,"td",11),e.qZA(),e.BQk()}if(2&o){const t=a.$implicit,n=a.index,r=e.oxw();let i,l,s,u,v,Z,w,V;e.xp6(1),e.Q6J("formGroupName",n),e.xp6(4),e.Q6J("ngIf",null==t||null==(i=t.get("chequeCollectionJod"))?null:i.errors),e.xp6(3),e.Q6J("items",r.currencies),e.xp6(1),e.Q6J("ngIf",null==(l=t.get("currencyId"))?null:l.errors),e.xp6(2),e.Oqu((null==t||null==(s=t.get("rate"))?null:s.value)||0),e.xp6(2),e.hij(" ",(null==t||null==t.value?null:t.value.vjod)||0," "),e.xp6(3),e.Q6J("minDate",r.minDate)("maxDate",r.maxDate)("bsConfig",e.DdM(25,tt)),e.xp6(1),e.Q6J("ngIf",null==t||null==(u=t.get("chequeDate"))?null:u.errors),e.xp6(4),e.Q6J("ngIf",null==t||null==(v=t.get("chequeNo"))?null:v.errors),e.xp6(3),e.Q6J("items",r.banks),e.xp6(1),e.Q6J("ngIf",null==t||null==(Z=t.get("bankId"))?null:Z.errors),e.xp6(2),e.ekj("disable-elm",r.otherData.refund),e.xp6(1),e.Q6J("ngIf",t.get("isNew").value),e.xp6(1),e.ekj("text-success",null==t?null:t.value.attachment),e.uIk("for",n+"file-input"),e.xp6(1),e.Oqu((null==t?null:t.value.attachment)&&(null==t?null:t.value.attachment)||"Upload"),e.xp6(1),e.Q6J("ngIf",null==t?null:t.value.attachment),e.xp6(1),e.Q6J("ngIf",null==t||null==(w=t.get("attachment"))?null:w.errors),e.xp6(1),e.Q6J("ngIf",7001==r.otherData.collectionType||7003==r.otherData.collectionType),e.xp6(4),e.Q6J("ngIf",null==t||null==(V=t.get("chequeDrawerName"))?null:V.errors),e.xp6(4),e.Q6J("ngIf",!(null!=r.otherData&&r.otherData.isMultiCollect||r.otherData.refund))}}function ot(o,a){1&o&&(e.TgZ(0,"div",48)(1,"p",49),e._UZ(2,"i",50),e._uU(3,"Press Tab to add payment in another currency "),e.qZA()())}function rt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",51)(1,"label",52),e._uU(2,"Cashier Notes"),e.qZA(),e.TgZ(3,"textarea",53),e.NdJ("change",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i._subjectService.cashierNote.next(r.target.value))}),e.qZA()()}}function it(o,a){1&o&&e._UZ(0,"i",54)}let at=(()=>{class o{onKeydownHandler(){this.handleTabKeyDown()}constructor(t,n,r,i,l,s,u){this.fb=t,this._activeModal=n,this._datePipe=r,this._commonService=i,this._modalService=l,this._collectService=s,this._subjectService=u,this.banks=[],this.amountEvent=new e.vpe,this.formValueEvent=new e.vpe,this.filesSubscription=new b.w0,this.filesArray=[],this.financeApprovalFiles=[],this.uploadedFiles=[],this.colllectedViaMachine=!1}ngOnInit(){if(this.colllectedViaMachine=JSON.parse(localStorage.getItem("pos_mc")),"cash"==(7002==this.otherData.collectionType&&this.otherData?.flag?.toLowerCase())){this.minDate=new Date;const i=new Date(this.minDate.getFullYear(),this.minDate.getMonth()-1,1);this.minDate=i,this.maxDate=new Date,this.maxDate.setDate(this.maxDate.getDate()+4)}this.initForm(),this.chequeForm.statusChanges.subscribe(i=>{let l;l=this.otherData?.reverse?!("VALID"==i||"DISABLED"==i):"VALID"!=i,this.chequeForm.markAllAsTouched(),this.formValueEvent.emit({values:this.chequeForm.getRawValue(),touched:l})});let n=this._subjectService.chequeFiles.subscribe(i=>{i?.length>0&&(this.filesArray=i)}),r=this._subjectService.chequeFinanceApprovalFiles.subscribe(i=>{i?.length>0&&(this.financeApprovalFiles=i)});this.filesSubscription.add(n),this.filesSubscription.add(r),this.otherData?.refund&&this.chequeArrControls.disable({emitEvent:!1}),this.otherData?.reverse&&this.disableReversedItems()}disableReversedItems(){this.chequeArrControls.controls.forEach(t=>{let n=t.get("attachment"),r=n.getRawValue();this.filesArray.push(r),r&&n.setValue("Attachment");let i=t.get("tempFinanceAttachment"),l=i.getRawValue();this.financeApprovalFiles.push(l),l&&i.setValue("Attachment"),t.get("isNew").value||t.disable()})}ngOnDestroy(){this.recentFormValues?.cheque?.chequeArray[0]?.chequeCollectionJod>0&&this.formValueEvent.emit({values:this.chequeForm.getRawValue(),touched:!1}),this._subjectService.chequeFiles.next(this.filesArray),this._subjectService.chequeFinanceApprovalFiles.next(this.financeApprovalFiles),this.filesSubscription.unsubscribe()}initForm(){if(this.chequeForm=this.fb.group({chequeArray:this.fb.array([this.chequeFormControls()])}),this.recentFormValues?.cheque?.chequeArray?.length){let t=this.recentFormValues.cheque.chequeArray,n=this.chequeForm.get("chequeArray");n.removeAt(0);for(let r of t)n.push(this.chequeFormControls(r))}}onDateValueChange(t,n){if(t){const r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()));let i=this.chequeArrControls.at(n);setTimeout(()=>{i.get("chequeDate").setValue(r,{emitEvent:!1})},1e3)}}chooseCurrency(t,n){this.chequeForm.markAllAsTouched();let r=this.chequeArrControls.at(n).get("vjod"),i=this.chequeArrControls.at(n).get("chequeCollectionJod").value;this.chequeArrControls.at(n).get("rate").setValue(t?.rate),9001==t?.lookupId?r.patchValue((1*i).toFixed(3)):(9002==t?.lookupId||9003==t?.lookupId)&&r.patchValue((i*+t?.rate).toFixed(3)),this.calculateAmount()}convertCash(t){let n=this.chequeArrControls.at(t).get("vjod"),r=this.chequeArrControls.at(t).get("chequeCollectionJod").value,i=this.chequeArrControls.at(t).get("currencyId").value;9001==i?n.patchValue((1*r).toFixed(3)):9002==i?n.patchValue((.71*r).toFixed(3)):9003==i&&n.patchValue((.76*r).toFixed(3)),this.calculateAmount()}fileAction(t,n,r,i){if("view"==r){const l=this._modalService.open(Q.g,{size:"md"});let s=this.chequeArrControls.at(n).get("isReversed").getRawValue(),u=this.chequeArrControls.at(n).get("isNew").getRawValue();if(this.otherData?.reverse&&!1!==s){if(null===s||s){let v;v="chequeImage"==i?this.filesArray[n]:this.financeApprovalFiles[n],l.componentInstance.imageUploadedView={viewOnly:!0,url:v}}}else{let v;v="chequeImage"==i?this.filesArray[n]:this.financeApprovalFiles[n],l.componentInstance.imageUploadedView=u?v:{viewOnly:!0,url:v}}}else{if(this.otherData?.reverse&&!this.chequeArrControls.at(n).get("isNew").getRawValue())return;if("chequeImage"==i){let l=this.inputRefList.toArray()[n];this.filesArray.splice(n,1,{}),this.chequeArrControls.at(n).get("attachment")?.setValue(""),this.chequeArrControls.at(n).get("chequeImage")?.setValue(""),l.nativeElement.value=null}else{let l=this.input2RefList.toArray()[n];this.financeApprovalFiles.splice(n,1,{}),this.chequeArrControls.at(n).get("financeApprovalAttachment")?.setValue(""),this.chequeArrControls.at(n).get("tempFinanceAttachment")?.setValue(""),l.nativeElement.value=null}}}onFileChange(t,n,r){let i=[...t.target.files];i.length>0&&(this._commonService.checkInvalidImageFormat(i)||i.forEach(s=>{this.uploadFile(s,n,r),this._commonService.fileToBase64(s).then(u=>{"chequeImage"==r?this.filesArray.splice(n,1,u):this.financeApprovalFiles.splice(n,1,u)})}))}uploadFile(t,n,r){const i=new FormData;i.append("Folder","Cheques"),i.append("File",t),this._collectService.uploadFile(i).subscribe(l=>{l.isSuccess&&("chequeImage"==r?(this.uploadedFiles.splice(n,1,l.data),this.chequeArrControls.at(n).get("chequeImage")?.setValue(l.data),this.chequeArrControls.at(n).get("attachment")?.setValue("Attachment")):(this.chequeArrControls.at(n).get("financeApprovalAttachment")?.setValue(l.data),this.chequeArrControls.at(n).get("tempFinanceAttachment")?.setValue("Attachment")))})}closeModal(){this._activeModal?this._activeModal.close():this._commonService.NavigateToRoute(`/${this.otherData?.redirectRoute}`)}chequeFormControls(t){return this.fb.group(t?{isChecked:[t?.isChecked],chequeCollectionJod:[t?.chequeCollectionJod,[c.kI.required,c.kI.min(1e-16)]],currencyId:[t?.currencyId,[c.kI.required]],chequeNo:[t?.chequeNo,[c.kI.required,c.kI.pattern("^[0-9]*$")]],chequeDate:[t?.chequeDate,[c.kI.required]],bankId:[t?.bankId,[c.kI.required]],chequeDrawerName:[t?.chequeDrawerName,7004!=this.otherData.collectionType&&[c.kI.required]],chequeImage:[t?.chequeImage],attachment:[t?.attachment,(7001==this.otherData.collectionType||7003==this.otherData.collectionType)&&[c.kI.required]],financeApprovalAttachment:[t?.financeApprovalAttachment],tempFinanceAttachment:[t?.tempFinanceAttachment,(7001==this.otherData.collectionType||7003==this.otherData.collectionType)&&[c.kI.required]],rate:[t?.rate],vjod:t?.vjod,isReversed:[(t?.isReversed??t?.isReversed)||!1],isNew:[(t?.isNew??t?.isNew)||!1],lineNew:[(t?.lineNew??t?.lineNew)||!1]}:{isChecked:[!0],chequeCollectionJod:["",[c.kI.required,c.kI.min(1e-16)]],currencyId:[9001,[c.kI.required]],chequeNo:["",[c.kI.required,c.kI.pattern("^[0-9]*$")]],chequeDate:["",[c.kI.required]],bankId:[null,[c.kI.required]],chequeDrawerName:[localStorage.getItem("pmcn")||"No Customer",7004!=this.otherData.collectionType&&[c.kI.required]],chequeImage:[""],attachment:["",(7001==this.otherData.collectionType||7003==this.otherData.collectionType)&&[c.kI.required]],financeApprovalAttachment:[""],tempFinanceAttachment:["",(7001==this.otherData.collectionType||7003==this.otherData.collectionType)&&[c.kI.required]],vjod:null,rate:[1],isReversed:[!1],isNew:[!0],lineNew:[!0]})}reverse(t,n){const r=this.chequeArrControls.at(n);if(r.invalid)return;const i=this.fb.group({});Object.keys(r.controls).forEach(Z=>{const w=y().cloneDeep(r.get(Z)?.value);i.addControl(Z,new c.NI(w))});let l=-1*r.get("vjod").value,s=-1*r.get("chequeCollectionJod").value;i.patchValue({vjod:l,chequeCollectionJod:s,isReversed:!0,lineNew:!0}),r.get("isReversed").setValue(!0),r.get("lineNew").setValue(!1),this.chequeArrControls.insert(n+1,i),this.chequeArrControls.at(n).disable(),this.chequeArrControls.at(n+1).disable();let v=this.financeApprovalFiles[n];this.filesArray.splice(n+1,0,this.filesArray[n]),this.financeApprovalFiles.splice(n+1,0,v),this.sendAmount()}removeItem(t){this.otherData?.refund||(this.chequeArrControls.removeAt(t),this.sendAmount())}get chequeArrControls(){return this.chequeForm?this.chequeForm.get("chequeArray"):null}handleTabKeyDown(){this.otherData?.refund||this.chequeForm.invalid||this.otherData.amountExceeded||this.otherData?.isMultiCollect||this.addNewRow()}addNewRow(){this.chequeArrControls.push(this.chequeFormControls());const t=this.chequeArrControls.at(this.chequeArrControls.length-2).getRawValue();this.chequeArrControls.at(this.chequeArrControls.length-1).patchValue({bankId:t.bankId,chequeDrawerName:t.chequeDrawerName,isChecked:t.isChecked}),this.chequeForm.markAsUntouched()}handleAmountFocus(){this.chequeForm.markAllAsTouched()}isSameCustomer(t,n){let r=this.chequeArrControls.at(n);if(t.target.checked)if(7004==this.otherData.collectionType)r.controls.chequeDrawerName.setValue("No Customer");else{let i=localStorage.getItem("pmcn");r.controls.chequeDrawerName.setValue(i)}else r.controls.chequeDrawerName.setValue("")}handleSubmit(){this.chequeForm.invalid?this.chequeForm.markAllAsTouched():this.formValueEvent.emit({values:this.chequeForm.getRawValue(),submit:!0})}get f(){return this.chequeForm.controls}sendAmount(){this.calculateAmount()}calculateAmount(){let t=0;for(let n of this.chequeArrControls.controls)t+=parseFloat(n.controls.vjod.getRawValue());this.amountEvent.emit({amount:t})}resetForm(){this.chequeArrControls.clear(),this.chequeArrControls.push(this.chequeFormControls()),this.chequeForm.markAsUntouched(),this.formValueEvent.emit({values:this.chequeForm.getRawValue(),touched:!1,reset:!0}),this.amountEvent.emit({amount:0})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.qu),e.Y36(f.Kz,8),e.Y36(m.uU),e.Y36(F.v),e.Y36(f.FF),e.Y36(C.k),e.Y36(D._))},o.\u0275cmp=e.Xpm({type:o,selectors:[["paymentChequeForm"]],viewQuery:function(t,n){if(1&t&&(e.Gf(de,5),e.Gf(pe,5)),2&t){let r;e.iGM(r=e.CRH())&&(n.inputRefList=r),e.iGM(r=e.CRH())&&(n.input2RefList=r)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown.tab",function(i){return n.onKeydownHandler(i)},!1,e.evT)},inputs:{banks:"banks",currencies:"currencies",recentFormValues:"recentFormValues",isPending:"isPending",otherData:"otherData"},outputs:{amountEvent:"amountEvent",formValueEvent:"formValueEvent"},decls:47,vars:11,consts:[[1,"tab-item"],[1,"row"],[1,"col-md-12","text-end","my-2"],["type","button","class","btn btn-trash",3,"click",4,"ngIf"],[3,"formGroup","submit"],[1,"col-md-12"],[1,"card-table"],[1,""],[1,"table"],["width","10%"],["width","15%"],[4,"ngIf"],["formArrayName","chequeArray",4,"ngFor","ngForOf"],["class","col-md-12 d-flex mt-2",4,"ngIf"],["class","col-12 mb-4",4,"ngIf"],[1,"btns-group","my-2","me-0"],["type","button",1,"btn","btn-cancel",3,"disabled","click"],["type","submit",1,"btn","btn-save",3,"disabled"],["class","fa-solid fa-circle-notch fa-spin",4,"ngIf"],["type","button",1,"btn","btn-trash",3,"click"],["src","assets/images/reload.png","alt","",2,"width","25px"],["formArrayName","chequeArray"],[3,"formGroupName"],[1,"form-group"],["type","number","placeholder","Amount","formControlName","chequeCollectionJod","appDecimalNumber","",1,"form-control",3,"input","change"],[1,"ngselect-curruncy","form-group"],["placeholder","Currency","bindLabel","name","bindValue","lookupId","formControlName","currencyId",3,"items","change"],["type","text","placeholder","Cheque Date","formControlName","chequeDate","placement","top","bsDatepicker","",1,"form-control",3,"minDate","maxDate","bsConfig","bsValueChange"],["type","text","placeholder","","formControlName","chequeNo","name","chequeNo",1,"form-control"],["placeholder"," Select Bank ","bindLabel","name","bindValue","id","formControlName","bankId",3,"items"],[1,"custom-file","align-items-center"],["type","file","class","file-input__input",3,"id","change",4,"ngIf"],[1,"file-input__label"],["type","text","placeholder","","formControlName","chequeDrawerName","OnlyCharacter","",1,"form-control"],[1,"form-check"],["type","checkbox","formControlName","isChecked",1,"form-check-input",3,"change"],["class","error",4,"ngIf"],[1,"error"],["type","file",1,"file-input__input",3,"id","change"],["fileInput",""],["height","20","src","assets/images/eye.png",1,"cursor-pointer",3,"click"],["height","20","src","assets/images/trash.png",1,"cursor-pointer",3,"click"],["fileInput2",""],[4,"ngIf","ngIfElse"],["reverseCase",""],["src","assets/images/trash.png","alt","",1,"cursor-pointer",2,"width","25px",3,"click"],["reverseTemp",""],[1,"cursor-pointer","green-clr","fas","fa-rotate-left","font-20",3,"click"],[1,"col-md-12","d-flex","mt-2"],[1,"blue-clr","d-flex","align-items-center","fw-500","gap-1"],[1,"fa-solid","fa-circle-plus","primary-clr","fa-2x"],[1,"col-12","mb-4"],[1,"input-label"],[1,"form-control",3,"change"],[1,"fa-solid","fa-circle-notch","fa-spin"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e.YNc(3,ge,2,0,"button",3),e.qZA(),e.TgZ(4,"form",4),e.NdJ("submit",function(){return n.handleSubmit()}),e.TgZ(5,"div",1)(6,"div",5)(7,"div",6)(8,"div",7)(9,"table",8)(10,"thead")(11,"tr")(12,"th",9),e._uU(13,"Cheque Amount"),e.qZA(),e.TgZ(14,"th"),e._uU(15,"Currency"),e.qZA(),e.TgZ(16,"th"),e._uU(17,"Rate"),e.qZA(),e.TgZ(18,"th"),e._uU(19,"Value in JOD"),e.qZA(),e.TgZ(20,"th"),e._uU(21,"Due Date"),e.qZA(),e.TgZ(22,"th"),e._uU(23,"Cheque No"),e.qZA(),e.TgZ(24,"th",10),e._uU(25,"Cheque Bank"),e.qZA(),e.TgZ(26,"th"),e._uU(27,"Cheque"),e._UZ(28,"br"),e._uU(29,"Image"),e.qZA(),e.YNc(30,he,4,0,"th",11),e.TgZ(31,"th"),e._uU(32,"Drawer Name"),e.qZA(),e.TgZ(33,"th"),e._uU(34,"Same Customer"),e.qZA(),e.YNc(35,fe,2,0,"th",11),e.qZA()(),e.TgZ(36,"tbody"),e.YNc(37,nt,42,26,"ng-container",12),e.qZA()()()(),e.YNc(38,ot,4,0,"div",13),e.qZA()(),e.YNc(39,rt,4,0,"div",14),e.TgZ(40,"div",5)(41,"div",15)(42,"button",16),e.NdJ("click",function(){return n.closeModal()}),e._uU(43,"Cancel"),e.qZA(),e.TgZ(44,"button",17),e._uU(45),e.YNc(46,it,1,0,"i",18),e.qZA()()()()()()),2&t&&(e.xp6(3),e.Q6J("ngIf",!(n.otherData.reverse||null!=n.otherData&&n.otherData.refund)),e.xp6(1),e.Q6J("formGroup",n.chequeForm),e.xp6(26),e.Q6J("ngIf",7001==n.otherData.collectionType||7003==n.otherData.collectionType),e.xp6(5),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.isMultiCollect)),e.xp6(2),e.Q6J("ngForOf",null==n.chequeArrControls?null:n.chequeArrControls.controls),e.xp6(1),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.isMultiCollect||null!=n.otherData&&n.otherData.refund)),e.xp6(1),e.Q6J("ngIf",7001==n.otherData.collectionType||7004==n.otherData.collectionType||7005==n.otherData.collectionType||7008==n.otherData.collectionType||7009==n.otherData.collectionType||7002==n.otherData.collectionType&&n.otherData.refund),e.xp6(3),e.Q6J("disabled",n.colllectedViaMachine),e.xp6(2),e.Q6J("disabled",n.isPending),e.xp6(1),e.hij(" ",n.isPending?"Saving":"Confirm"," "),e.xp6(1),e.Q6J("ngIf",n.isPending))},dependencies:[m.sg,m.O5,Y.Np,Y.Y5,c._Y,c.Fj,c.wV,c.Wl,c.JJ,c.JL,c.sg,c.u,c.x0,c.CE,x.w9,h.Q,k.Q],styles:[".form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;margin-bottom:7px}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:46px}.form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:red;font-weight:500;font-size:14px}  .ng-dropdown-panel{z-index:9999999!important}.card-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 0 10px 15px!important;font-weight:500}.form-check-input[_ngcontent-%COMP%]{width:20px!important;height:20px}.card-table[_ngcontent-%COMP%]{overflow:visible}.custom-file[_ngcontent-%COMP%]{border:1px solid #dadada;display:flex;height:46px;border-radius:.375rem;justify-content:center;gap:5px;background:#fff}.file-input__input[_ngcontent-%COMP%]{width:.1px;height:.1px;opacity:0;overflow:hidden;position:absolute;z-index:-1}.file-input__label[_ngcontent-%COMP%]{cursor:pointer;display:inline-flex;align-items:center;border-radius:4px;font-weight:600;color:var(--gray-500);font-size:14px}"]}),o})();var R=_(77579),U=_(78372),lt=_(71884),ct=_(63900),st=_(82757);function ut(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"tr",24),e.NdJ("click",function(){const i=e.CHM(t).$implicit,l=e.oxw(3);return e.KtG(l.selectCustomer(i))}),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._UZ(10,"i",25),e.qZA(),e.TgZ(11,"td"),e._UZ(12,"i",25),e.qZA()()}if(2&o){const t=a.$implicit,n=e.oxw(3);e.ekj("selectedRow",(null==t?null:t.customerNo)==n.selectedCustomer),e.xp6(2),e.Oqu(null==t?null:t.customerNo),e.xp6(2),e.Oqu(null==t?null:t.customerName),e.xp6(2),e.Oqu(null==t?null:t.customerPhone),e.xp6(2),e.Oqu(1==(null==t?null:t.customerCategory)?"Individual":"Corporate"),e.xp6(2),e.Q6J("ngClass",1==(null==t?null:t.customerCredit)?"fa-check green-clr":"fa-times primary-clr"),e.xp6(2),e.Q6J("ngClass",null!=t&&t.confirmed?"fa-check green-clr":"fa-times primary-clr")}}function mt(o,a){if(1&o&&(e.ynx(0),e.YNc(1,ut,13,8,"tr",23),e.BQk()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.customerList)}}function _t(o,a){1&o&&(e.TgZ(0,"tr")(1,"td",26),e._uU(2,"No records to display"),e.qZA()())}function dt(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",6)(2,"p",7),e._uU(3,"Search (Account No. | Name | Mobile)"),e.qZA(),e.TgZ(4,"div",8)(5,"div",9)(6,"input",10,11),e.NdJ("input",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.handleSearch(r))}),e.qZA(),e.TgZ(8,"span",12),e._UZ(9,"i",13),e.qZA()()()(),e.TgZ(10,"div",14)(11,"label",15),e._uU(12,"Credit Customers Only"),e.qZA(),e.TgZ(13,"input",16),e.NdJ("ngModelChange",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.isCreditCustomer=r)})("change",function(r){e.CHM(t);const i=e.MAs(7),l=e.oxw();return e.KtG(l.handleCreditCustomerChange(r,i.value))}),e.qZA()(),e.TgZ(14,"div",17)(15,"table",18)(16,"thead")(17,"tr")(18,"th"),e._uU(19,"Account No"),e.qZA(),e.TgZ(20,"th"),e._uU(21,"Account Name"),e.qZA(),e.TgZ(22,"th"),e._uU(23,"Phone 1"),e.qZA(),e.TgZ(24,"th"),e._uU(25,"Customer Category"),e.qZA(),e.TgZ(26,"th"),e._uU(27,"Credit Customer"),e.qZA(),e.TgZ(28,"th"),e._uU(29,"Confirmed Customer"),e.qZA()()(),e.TgZ(30,"tbody"),e.YNc(31,mt,2,1,"ng-container",4),e.YNc(32,_t,3,0,"ng-template",null,19,e.W1O),e.qZA()()(),e.TgZ(34,"div",20)(35,"button",21),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.handleSelect())}),e._uU(36,"Select"),e.qZA(),e.TgZ(37,"button",22),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.addNewCustomer())}),e._uU(38,"Add New"),e.qZA()(),e.BQk()}if(2&o){const t=e.MAs(33),n=e.oxw();e.xp6(13),e.Q6J("ngModel",n.isCreditCustomer),e.xp6(18),e.Q6J("ngIf",null==n.customerList?null:n.customerList.length)("ngIfElse",t),e.xp6(4),e.Q6J("disabled",n.selectedCustomer<=0)}}function pt(o,a){if(1&o&&(e.TgZ(0,"option",47),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",null==t?null:t.value),e.xp6(1),e.Oqu(null==t?null:t.text)}}function gt(o,a){1&o&&(e.TgZ(0,"span",49),e._uU(1,"Input is required"),e.qZA())}function ht(o,a){if(1&o&&(e.ynx(0),e.YNc(1,gt,2,0,"span",48),e.BQk()),2&o){const t=e.oxw(4);let n;e.xp6(1),e.Q6J("ngIf",null==t.f||null==(n=t.f.get("title"))?null:n.errors.required)}}function ft(o,a){if(1&o&&(e.ynx(0),e.YNc(1,ht,2,1,"ng-container",36),e.BQk()),2&o){const t=e.oxw(3);let n;e.xp6(1),e.Q6J("ngIf",(null==t.f||null==(n=t.f.get("title"))?null:n.invalid)&&(null==t.f||null==(n=t.f.get("title"))?null:n.touched)||(null==t.f||null==(n=t.f.get("title"))?null:n.dirty))}}function Ct(o,a){if(1&o&&(e.ynx(0),e.TgZ(1,"div",28)(2,"div",29)(3,"label"),e._uU(4,"Title"),e.qZA()(),e.TgZ(5,"div",37)(6,"select",44)(7,"option",45),e._uU(8,"---Select Title---"),e.qZA(),e.YNc(9,pt,2,2,"option",46),e.qZA(),e.YNc(10,ft,2,1,"ng-container",36),e.qZA()(),e._UZ(11,"hr"),e.BQk()),2&o){const t=e.oxw(2);let n;e.xp6(9),e.Q6J("ngForOf",t.titleList),e.xp6(1),e.Q6J("ngIf",null==t.f||null==(n=t.f.get("title"))?null:n.errors)}}function vt(o,a){1&o&&(e.TgZ(0,"span",49),e._uU(1,"Input is required"),e.qZA())}function yt(o,a){1&o&&(e.TgZ(0,"span",49),e._uU(1,"Input allows only characters."),e.qZA())}function xt(o,a){if(1&o&&(e.ynx(0),e.YNc(1,vt,2,0,"span",48),e.YNc(2,yt,2,0,"span",48),e.BQk()),2&o){const t=e.oxw(3);let n,r;e.xp6(1),e.Q6J("ngIf",null==t.f||null==(n=t.f.get("fname"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t.f||null==(r=t.f.get("fname"))?null:r.errors.pattern)}}function At(o,a){if(1&o&&(e.ynx(0),e.YNc(1,xt,3,2,"ng-container",36),e.BQk()),2&o){const t=e.oxw(2);let n;e.xp6(1),e.Q6J("ngIf",(null==t.f||null==(n=t.f.get("fname"))?null:n.invalid)&&(null==t.f||null==(n=t.f.get("fname"))?null:n.touched)||(null==t.f||null==(n=t.f.get("fname"))?null:n.dirty))}}function Tt(o,a){1&o&&(e.TgZ(0,"span",49),e._uU(1,"Input is required"),e.qZA())}function bt(o,a){1&o&&(e.TgZ(0,"span",49),e._uU(1,"Input allows only characters."),e.qZA())}function It(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Tt,2,0,"span",48),e.YNc(2,bt,2,0,"span",48),e.BQk()),2&o){const t=e.oxw(4);let n,r;e.xp6(1),e.Q6J("ngIf",null==t.f||null==(n=t.f.get("sname"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t.f||null==(r=t.f.get("sname"))?null:r.errors.pattern)}}function kt(o,a){if(1&o&&(e.ynx(0),e.YNc(1,It,3,2,"ng-container",36),e.BQk()),2&o){const t=e.oxw(3);let n;e.xp6(1),e.Q6J("ngIf",(null==t.f||null==(n=t.f.get("sname"))?null:n.invalid)&&(null==t.f||null==(n=t.f.get("sname"))?null:n.touched)||(null==t.f||null==(n=t.f.get("sname"))?null:n.dirty))}}function Nt(o,a){1&o&&(e.TgZ(0,"span",49),e._uU(1,"Input is required"),e.qZA())}function Zt(o,a){1&o&&(e.TgZ(0,"span",49),e._uU(1,"Input allows only characters."),e.qZA())}function wt(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Nt,2,0,"span",48),e.YNc(2,Zt,2,0,"span",48),e.BQk()),2&o){const t=e.oxw(4);let n,r;e.xp6(1),e.Q6J("ngIf",null==t.f||null==(n=t.f.get("thName"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t.f||null==(r=t.f.get("thName"))?null:r.errors.pattern)}}function qt(o,a){if(1&o&&(e.ynx(0),e.YNc(1,wt,3,2,"ng-container",36),e.BQk()),2&o){const t=e.oxw(3);let n;e.xp6(1),e.Q6J("ngIf",(null==t.f||null==(n=t.f.get("thName"))?null:n.invalid)&&(null==t.f||null==(n=t.f.get("thName"))?null:n.touched)||(null==t.f||null==(n=t.f.get("thName"))?null:n.dirty))}}function Ft(o,a){1&o&&(e.TgZ(0,"span",49),e._uU(1,"Input is required"),e.qZA())}function Pt(o,a){1&o&&(e.TgZ(0,"span",49),e._uU(1,"Input allows only characters."),e.qZA())}function Mt(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Ft,2,0,"span",48),e.YNc(2,Pt,2,0,"span",48),e.BQk()),2&o){const t=e.oxw(4);let n,r;e.xp6(1),e.Q6J("ngIf",null==t.f||null==(n=t.f.get("fourthName"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t.f||null==(r=t.f.get("fourthName"))?null:r.errors.pattern)}}function Dt(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Mt,3,2,"ng-container",36),e.BQk()),2&o){const t=e.oxw(3);let n;e.xp6(1),e.Q6J("ngIf",(null==t.f||null==(n=t.f.get("fourthName"))?null:n.invalid)&&(null==t.f||null==(n=t.f.get("fourthName"))?null:n.touched)||(null==t.f||null==(n=t.f.get("fourthName"))?null:n.dirty))}}function Jt(o,a){if(1&o&&(e.ynx(0),e.TgZ(1,"div",38),e._UZ(2,"input",50),e.YNc(3,kt,2,1,"ng-container",36),e.qZA(),e.TgZ(4,"div",38),e._UZ(5,"input",51),e.YNc(6,qt,2,1,"ng-container",36),e.qZA(),e.TgZ(7,"div",38),e._UZ(8,"input",52),e.YNc(9,Dt,2,1,"ng-container",36),e.qZA(),e.BQk()),2&o){const t=e.oxw(2);let n,r,i;e.xp6(3),e.Q6J("ngIf",null==t.f||null==(n=t.f.get("sname"))?null:n.errors),e.xp6(3),e.Q6J("ngIf",null==t.f||null==(r=t.f.get("thName"))?null:r.errors),e.xp6(3),e.Q6J("ngIf",null==t.f||null==(i=t.f.get("fourthName"))?null:i.errors)}}function Vt(o,a){1&o&&(e.ynx(0),e.TgZ(1,"div",28)(2,"div",29)(3,"label"),e._uU(4,"Gender"),e.qZA()(),e.TgZ(5,"div",30)(6,"div",31),e._UZ(7,"input",53),e.TgZ(8,"label",54),e._uU(9,"Male"),e.qZA()(),e.TgZ(10,"div",31),e._UZ(11,"input",55),e.TgZ(12,"label",56),e._uU(13,"Female"),e.qZA()()()(),e._UZ(14,"hr"),e.BQk())}function Ot(o,a){1&o&&(e.TgZ(0,"span",49),e._uU(1,"Input is required"),e.qZA())}function St(o,a){1&o&&(e.TgZ(0,"span",49),e._uU(1,"Minimum 9 digits required"),e.qZA())}function Qt(o,a){1&o&&(e.TgZ(0,"span",49),e._uU(1,"Maximum 10 digits allowed"),e.qZA())}function Rt(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Ot,2,0,"span",48),e.YNc(2,St,2,0,"span",48),e.YNc(3,Qt,2,0,"span",48),e.BQk()),2&o){const t=e.oxw(3);let n,r,i;e.xp6(1),e.Q6J("ngIf",null==t.f||null==(n=t.f.get("mobile"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t.f||null==(r=t.f.get("mobile"))?null:r.errors.minlength),e.xp6(1),e.Q6J("ngIf",null==t.f||null==(i=t.f.get("mobile"))?null:i.errors.maxlength)}}function Ut(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Rt,4,3,"ng-container",36),e.BQk()),2&o){const t=e.oxw(2);let n;e.xp6(1),e.Q6J("ngIf",(null==t.f||null==(n=t.f.get("mobile"))?null:n.invalid)&&(null==t.f||null==(n=t.f.get("mobile"))?null:n.touched)||(null==t.f||null==(n=t.f.get("mobile"))?null:n.dirty))}}function Yt(o,a){if(1&o&&(e.TgZ(0,"p",57),e._uU(1),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Oqu(t.responseMessage)}}function Bt(o,a){1&o&&e._UZ(0,"i",58)}function Et(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"form",27),e.NdJ("submit",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.saveCustomer())}),e.TgZ(1,"div",28)(2,"div",29)(3,"label"),e._uU(4,"Customer Category"),e.qZA()(),e.TgZ(5,"div",30)(6,"div",31)(7,"input",32),e.NdJ("change",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.handleCetegoryChange(1))}),e.qZA(),e.TgZ(8,"label",33),e._uU(9,"Individual"),e.qZA()(),e.TgZ(10,"div",31)(11,"input",34),e.NdJ("change",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.handleCetegoryChange(2))}),e.qZA(),e.TgZ(12,"label",35),e._uU(13,"Corporate"),e.qZA()()()(),e._UZ(14,"hr"),e.YNc(15,Ct,12,2,"ng-container",36),e.TgZ(16,"div",28)(17,"div",29)(18,"label"),e._uU(19,"Name"),e.qZA()(),e.TgZ(20,"div",37)(21,"div",28)(22,"div",38),e._UZ(23,"input",39),e.YNc(24,At,2,1,"ng-container",36),e.qZA(),e.YNc(25,Jt,10,3,"ng-container",36),e.qZA()()(),e._UZ(26,"hr"),e.YNc(27,Vt,15,0,"ng-container",36),e.TgZ(28,"div",28)(29,"div",29)(30,"label"),e._uU(31,"Mobile"),e.qZA()(),e.TgZ(32,"div",37)(33,"div",9)(34,"span",12),e._uU(35,"962"),e.qZA(),e._UZ(36,"input",40),e.qZA(),e.YNc(37,Ut,2,1,"ng-container",36),e.qZA()(),e._UZ(38,"hr"),e.YNc(39,Yt,2,1,"p",41),e.TgZ(40,"div",20)(41,"button",22),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.goBack())}),e._uU(42,"Back"),e.qZA(),e.TgZ(43,"button",42),e._uU(44),e.YNc(45,Bt,1,0,"i",43),e.qZA()()()}if(2&o){const t=e.oxw();let n,r;e.Q6J("formGroup",t.formGroup),e.xp6(15),e.Q6J("ngIf",t.isIndividual),e.xp6(7),e.ekj("col-12",!t.isIndividual),e.xp6(1),e.s9C("placeholder",t.isIndividual?"First Name":"Full Name"),e.xp6(1),e.Q6J("ngIf",null==t.f||null==(n=t.f.get("fname"))?null:n.errors),e.xp6(1),e.Q6J("ngIf",t.isIndividual),e.xp6(2),e.Q6J("ngIf",t.isIndividual),e.xp6(10),e.Q6J("ngIf",null==t.f||null==(r=t.f.get("mobile"))?null:r.errors),e.xp6(2),e.Q6J("ngIf",t.responseMessage),e.xp6(5),e.hij(" ",t.isSubmitted?"Saving":"Save"," "),e.xp6(1),e.Q6J("ngIf",t.isSubmitted)}}let Gt=(()=>{class o{constructor(t,n,r){this._collectService=t,this.fb=n,this._activeModal=r,this.isSubmitted=!1,this.isNewCustomer=!1,this.isIndividual=!0,this.customerList=[],this.selectedCustomer=0,this.isCreditCustomer=!1,this.titleList=[{value:1,text:"Mr."},{value:2,text:"Ms."},{value:11,text:"Dr."},{value:12,text:"Eng."}],this.sendData=new e.vpe,this.searchSubject=new R.x,this.searchSubscription=new b.w0}ngOnInit(){this.initCustomerForm(),this.searchSubscription=this.searchSubject.pipe((0,U.b)(500),(0,lt.x)(),(0,ct.w)(t=>this._collectService.getMarkaziaCustomers(t,Number(this.isCreditCustomer)))).subscribe(t=>{this.customerList=t.data})}initCustomerForm(){this.formGroup=this.fb.group({title:[null,[c.kI.required]],fname:["",[c.kI.required,c.kI.pattern("^[a-zA-Z]*$")]],sname:["",[c.kI.required,c.kI.pattern("^[a-zA-Z]*$")]],thName:["",[c.kI.required,c.kI.pattern("^[a-zA-Z]*$")]],fourthName:["",[c.kI.required,c.kI.pattern("^[a-zA-Z]*$")]],gender:["0"],customerCategory:["1"],mobile:["",[c.kI.required,c.kI.minLength(9),c.kI.maxLength(10)]]})}ngOnDestroy(){this.searchSubscription.unsubscribe()}handleCreditCustomerChange(t,n){n&&this._collectService.getMarkaziaCustomers(n,Number(this.isCreditCustomer)).subscribe(r=>{this.customerList=r.data})}handleSearch(t){this.searchSubject.next(t.target.value)}handleCetegoryChange(t){this.isIndividual=1==t,this.isIndividual?(this.f.get("title").setValidators([c.kI.required]),this.f.get("title").updateValueAndValidity(),this.f.get("sname").setValidators([c.kI.required,c.kI.pattern("^[a-zA-Z]*$")]),this.f.get("sname").updateValueAndValidity(),this.f.get("thName").setValidators([c.kI.required,c.kI.pattern("^[a-zA-Z]*$")]),this.f.get("thName").updateValueAndValidity(),this.f.get("fourthName").setValidators([c.kI.required,c.kI.pattern("^[a-zA-Z]*$")]),this.f.get("fourthName").updateValueAndValidity()):(this.f.get("title").clearValidators(),this.f.get("title").updateValueAndValidity(),this.f.get("sname").clearValidators(),this.f.get("sname").updateValueAndValidity(),this.f.get("thName").clearValidators(),this.f.get("thName").updateValueAndValidity(),this.f.get("fourthName").clearValidators(),this.f.get("fourthName").updateValueAndValidity())}removeByIndex(t,n){return t.slice(0,n)+t.slice(n+1)}saveCustomer(){if(this.formGroup.invalid)this.formGroup.markAllAsTouched();else{this.isSubmitted=!0;let t,n=this.formGroup.value,r=n?.mobile;0==r.charAt(0)&&(r=this.removeByIndex(n?.mobile,0)),n={...n,customerCategory:+n?.customerCategory,gender:+n?.customerCategory,mobile:`962${r}`},t=this.isIndividual?n:{corporateName:n?.fname,customerCategory:n?.customerCategory,mobile:n?.mobile},this._collectService.addMarkaziaCustomer(t).subscribe(i=>{this.isSubmitted=!1,console.log(i),i.isSuccess&&(this.sendData.emit(i.data),this._activeModal.close())},i=>{this.isSubmitted=!1,this.responseMessage=i.error?.errors[0]?.ErrorMessageEn,setTimeout(()=>{this.responseMessage=""},5e3)})}}selectCustomer(t){this.selectedItem=t,this.selectedCustomer=t?.customerNo}handleSelect(){this.sendData.emit({customerNo:this.selectedItem?.customerNo,corporateName:this.selectedItem?.customerName,mobile:this.selectedItem?.customerPhone}),this._activeModal.close()}addNewCustomer(){this.isNewCustomer=!0}goBack(){this.isNewCustomer=!1}get f(){return this.formGroup}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.k),e.Y36(c.qu),e.Y36(f.Kz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-add-new-customer"]],outputs:{sendData:"sendData"},decls:8,vars:3,consts:[[1,"modal-body"],[1,"d-flex","mb-4","justify-content-between"],[1,"fw-500","mb-0"],[1,"fas","fa-times-circle","fa-2x","primary-clr","cursor-pointer",3,"click"],[4,"ngIf","ngIfElse"],["newCustomer",""],[1,"d-flex","align-items-center"],[1,"flex-grow-1","m-0"],[1,"flex-grow-1"],[1,"input-group"],["type","text","placeholder","Search",1,"form-control",3,"input"],["inputSearch",""],[1,"input-group-text"],[1,"fas","fa-search"],[1,"d-flex","align-items-center","gap-1"],["for","check",1,"font-13"],["id","check","type","checkbox",1,"ms-1","m-0","form-check-input","input-checkbox",3,"ngModel","ngModelChange","change"],[1,"scrollable-table-wrapper"],[1,"table","table-striped","my-4","table-bordered"],["noCustomers",""],[1,"d-flex","gap-2"],["type","button",1,"redBtn",3,"disabled","click"],["type","button",1,"redBtn",3,"click"],["class","cursor-pointer",3,"selectedRow","click",4,"ngFor","ngForOf"],[1,"cursor-pointer",3,"click"],[1,"fas","cursor-pointer",3,"ngClass"],["colspan","6"],[1,"add-cutsomer",3,"formGroup","submit"],[1,"row"],[1,"col-2"],[1,"col-10","d-flex","gap-2"],[1,"form-check"],["value","1","type","radio","id","individual","formControlName","customerCategory",1,"form-check-input",3,"change"],["for","individual",1,"form-check-label"],["value","2","type","radio","id","corporate","formControlName","customerCategory",1,"form-check-input",3,"change"],["for","corporate",1,"form-check-label"],[4,"ngIf"],[1,"col-10"],[1,"col-3"],["type","text","formControlName","fname",1,"form-control",3,"placeholder"],["type","text","placeholder","e.g (7xxxxxxxx) or (07xxxxxxxx)","numbersOnly","","formControlName","mobile",1,"form-control"],["class","alert alert-danger",4,"ngIf"],["type","submit",1,"redBtn"],["class","fa-solid fa-circle-notch fa-spin",4,"ngIf"],["formControlName","title",1,"form-control"],["selected","","disabled","","value","null"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["class","error",4,"ngIf"],[1,"error"],["type","text","placeholder","Last Name","formControlName","sname",1,"form-control"],["type","text","placeholder","Third Name","formControlName","thName",1,"form-control"],["type","text","placeholder","Fourth Name","formControlName","fourthName",1,"form-control"],["value","0","type","radio","id","flexRadioDefault1","formControlName","gender",1,"form-check-input"],["for","flexRadioDefault1",1,"form-check-label"],["value","1","type","radio","id","flexRadioDefault2","formControlName","gender",1,"form-check-input"],["for","flexRadioDefault2",1,"form-check-label"],[1,"alert","alert-danger"],[1,"fa-solid","fa-circle-notch","fa-spin"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),e._uU(3),e.qZA(),e.TgZ(4,"i",3),e.NdJ("click",function(){return n._activeModal.close("")}),e.qZA()(),e.YNc(5,dt,39,4,"ng-container",4),e.YNc(6,Et,46,12,"ng-template",null,5,e.W1O),e.qZA()),2&t){const r=e.MAs(7);e.xp6(3),e.Oqu(n.isNewCustomer?"New Account":"Search Customer Account"),e.xp6(2),e.Q6J("ngIf",!n.isNewCustomer)("ngIfElse",r)}},dependencies:[m.mk,m.sg,m.O5,c._Y,c.YN,c.Kr,c.Fj,c.Wl,c.EJ,c._,c.JJ,c.JL,c.sg,c.u,c.On,st.N],styles:["div.scrollable-table-wrapper[_ngcontent-%COMP%]{height:400px;overflow-y:auto;margin-bottom:30px}div.scrollable-table-wrapper[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{font-size:14px}div.scrollable-table-wrapper[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:#F6F6F6}div.scrollable-table-wrapper[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:400;position:sticky;top:0;background:#cfcfcf}div.scrollable-table-wrapper[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .selectedRow[_ngcontent-%COMP%]{background:#ffe2e4;font-weight:600}.add-cutsomer[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px}.add-cutsomer[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:red;font-weight:500;font-size:14px}"]}),o})();var Lt=_(70262),Kt=_(39646),Ht=_(4128),jt=_(86260),B=_(81181),$t=_(21864),E=_(67711);function zt(o,a){1&o&&(e.TgZ(0,"span",25),e._uU(1,"Customer info is required"),e.qZA())}function Wt(o,a){if(1&o&&(e.ynx(0),e.YNc(1,zt,2,0,"span",24),e.BQk()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",null==t.f.customerName||null==t.f.customerName.errors?null:t.f.customerName.errors.required)}}function Xt(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Wt,2,1,"ng-container",5),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",(null==t.f.customerName?null:t.f.customerName.invalid)&&(null==t.f.customerName?null:t.f.customerName.touched)||(null==t.f.customerName?null:t.f.customerName.dirty))}}function en(o,a){1&o&&(e.TgZ(0,"span",27),e._uU(1,"Input is required"),e.qZA())}function tn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,en,2,0,"span",26),e.BQk()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",null==t.f.revenueCategoryId||null==t.f.revenueCategoryId.errors?null:t.f.revenueCategoryId.errors.required)}}function nn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,tn,2,1,"ng-container",5),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",(null==t.f.revenueCategoryId?null:t.f.revenueCategoryId.invalid)&&(null==t.f.revenueCategoryId?null:t.f.revenueCategoryId.touched)||(null==t.f.revenueCategoryId?null:t.f.revenueCategoryId.dirty))}}function on(o,a){1&o&&(e.TgZ(0,"span",30),e._uU(1,"Input is required"),e.qZA())}function rn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,on,2,0,"span",29),e.BQk()),2&o){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",null==t.f.costCenterId?null:t.f.costCenterId.errors.required)}}function an(o,a){if(1&o&&(e.ynx(0),e.YNc(1,rn,2,1,"ng-container",5),e.BQk()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",(null==t.f.costCenterId?null:t.f.costCenterId.invalid)&&(null==t.f.costCenterId?null:t.f.costCenterId.touched)||(null==t.f.costCenterId?null:t.f.costCenterId.dirty))}}function ln(o,a){if(1&o&&(e.TgZ(0,"div",8)(1,"label",15),e._uU(2,"Cost Center"),e.qZA(),e._UZ(3,"ng-select",28),e.YNc(4,an,2,1,"ng-container",5),e.qZA()),2&o){const t=e.oxw();e.xp6(3),e.Q6J("items",t.costCenterList),e.xp6(1),e.Q6J("ngIf",null==t.f.costCenterId?null:t.f.costCenterId.errors)}}function cn(o,a){1&o&&(e.TgZ(0,"span",27),e._uU(1,"Input is required"),e.qZA())}function sn(o,a){1&o&&(e.TgZ(0,"span",32),e._uU(1,"Select payment category first"),e.qZA())}function un(o,a){1&o&&(e.TgZ(0,"span",27),e._uU(1,"Can't be zero or negative"),e.qZA())}function mn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,cn,2,0,"span",26),e.YNc(2,sn,2,0,"span",31),e.YNc(3,un,2,0,"span",26),e.BQk()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",null==t.f.amount||null==t.f.amount.errors?null:t.f.amount.errors.required),e.xp6(1),e.Q6J("ngIf",!t.revenueForm.get("revenueCategoryId").value),e.xp6(1),e.Q6J("ngIf",null==t.f.amount||null==t.f.amount.errors?null:t.f.amount.errors.min)}}function _n(o,a){if(1&o&&(e.ynx(0),e.YNc(1,mn,4,3,"ng-container",5),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",(null==t.f.amount?null:t.f.amount.invalid)&&(null==t.f.amount?null:t.f.amount.touched)||(null==t.f.amount?null:t.f.amount.dirty))}}function dn(o,a){1&o&&e._uU(0),2&o&&e.hij(" ",a.item.text,"% ")}function pn(o,a){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const t=e.oxw().item;e.xp6(1),e.hij(" ",t.text,"% ")}}function gn(o,a){if(1&o&&e.YNc(0,pn,2,1,"ng-container",5),2&o){const t=a.item;e.Q6J("ngIf",null==t?null:t.text)}}const hn=function(){return{standalone:!0}};function fn(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"div",33)(2,"input",34),e.NdJ("change",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.handleNoAmountChange(r))})("ngModelChange",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.noTotalAmount=r)}),e.qZA(),e.TgZ(3,"label",35),e._uU(4,"No Total Amount"),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("ngModel",t.noTotalAmount)("ngModelOptions",e.DdM(2,hn))}}const Cn=function(){return{required:"Input is required"}};let vn=(()=>{class o{constructor(t,n,r,i,l,s,u,v,Z){this.fb=t,this._vocuherService=n,this.collectService=r,this._subjectService=i,this._generalService=l,this.cdRef=s,this.sharedService=u,this._commonService=v,this._modalService=Z,this.costCenterList=[],this.taxesList=[],this.noTotalAmount=!1,this.calcRevenueRemainingAmount=new e.vpe}ngOnInit(){this.initRevenuForm(),this.getCategories(),this.getLookups()}ngOnChanges(t){if(console.log(t),t.data){let n=t.data.currentValue?.totalCollectedAmount;n>0&&this.calcuateTaxAndAmountFromTotalAmount(n)}}initRevenuForm(){this.revenueForm=this.fb.group({customerId:[null],customerName:["",7005==this.data.collectionType&&[c.kI.required]],revenueCategoryId:[null,[c.kI.required]],costCenterId:[null,7004==this.data.collectionType&&[c.kI.required]],amount:[null,[c.kI.min(1e-16),c.kI.required]],tax:[null,c.kI.required],taxPercent:"",taxAmount:"",totalAmount:"",mobile:"",note:[""]})}calcuateTaxAndAmountFromTotalAmount(t){const r=(+t*+this.f.taxPercent.value/100).toFixed(3),i=(t-+r).toFixed(3);this.f.taxAmount.setValue(r),this.f.amount.setValue(i),this.f.totalAmount.setValue(t);let l=this.revenueForm.value;l={...l,totalAmount:+t,amount:+l.amount},this.calcRevenueRemainingAmount.emit({formValue:l,noTotalAmount:!0})}handleNoAmountChange(t){this.noTotalAmount=t.target.checked;let n={...this.revenueForm.value};if(this.noTotalAmount){let r={revenueCategoryId:n.revenueCategoryId,tax:n.tax,taxPercent:n.taxPercent};(7004==this.data.collectionType||7005==this.data.collectionType)&&(r.customerId=n.customerId,r.customerName=n.customerName),this.revenueForm.reset(r),this.calcRevenueRemainingAmount.emit({noTotalAmount:!0})}else this.calcRevenueRemainingAmount.emit({formValue:{},amount:0});this.toggleValidation()}toggleValidation(){let t=this.f.amount;this.noTotalAmount?t.removeValidators([c.kI.required]):t.addValidators([c.kI.required]),t.updateValueAndValidity()}responseModal(t,n){const r=this._modalService.open(jt.i);r.componentInstance.type=t,r.componentInstance.message=n}getLookups(){const t=this._vocuherService.getCostCenter("?StatusId=2001&PageSize=1000").pipe((0,Lt.K)(i=>(0,Kt.of)(i))),r=this._generalService.getLookupsWithParams("?lookupTypeId=23&status=2001&pageSize=1000");(0,Ht.D)([t,r]).subscribe(i=>{this.costCenterList=i[0].data,this.taxesList=i[1].data.map(l=>({...l,text:l.name[0].lookupName}))})}handleTaxChange(t){t?(this.revenueForm.get("taxPercent").setValue(t.text),this.calcTotalAmount()):(this.noTotalAmount=!1,this.toggleValidation(),this.calcRevenueRemainingAmount.emit({formValue:{},amount:0}))}searchForCustomer(){this._modalService.open(Gt,{size:"lg"}).componentInstance.sendData.subscribe(n=>{let r=n?.corporateName,l={customerId:n?.customerNo,customerName:r||`${n?.fname} ${n?.sname} ${n?.thName} ${n?.fourthName}`,mobile:n?.mobile};if(localStorage.setItem("pmcn",l?.customerName),this.revenueForm.patchValue(l),this.emittedValues){let s={...this.emittedValues?.formValue,...l};this.emittedValues={...this.emittedValues,formValue:s},this.emittedValues?.formValue.revenueCategoryId&&this.calcRevenueRemainingAmount.emit({...this.emittedValues,fromCustomer:!0})}})}calcTotalAmount(){let t=this.revenueForm.get("amount").value;if(t>0){let n=+this.revenueForm.get("taxPercent").value*t/100;this.revenueForm.get("taxAmount").patchValue(this._commonService.transformDecimal(n));let r=+this.revenueForm.get("amount").value+ +n;this.revenueForm.get("totalAmount").setValue(this._commonService.transformDecimal(r));let i=this.revenueForm.value;i={...i,totalAmount:+r,amount:i.amount},this.noTotalAmount=!1,this.emittedValues={formValue:i,amount:+r,noTotalAmount:!1},7004==this.data.collectionType?i.revenueCategoryId&&this.calcRevenueRemainingAmount.emit(this.emittedValues):i.customerId&&i.revenueCategoryId&&this.calcRevenueRemainingAmount.emit(this.emittedValues)}else this.revenueForm.get("totalAmount").patchValue(""),this.calcRevenueRemainingAmount.emit({formValue:{},amount:0})}chooseCategory(t){this.revenueForm.markAllAsTouched(),this.revenueForm.get("taxPercent").patchValue(t?.taxPercent),this.revenueForm.get("tax").setValue(t?.taxPercentId),this.revenueForm.get("note").patchValue(t?.note);let n=+this.revenueForm.get("tax").value,r=+this.taxesList.find(v=>v.id==n)?.name[0]?.lookupName,i=+this.revenueForm.get("amount").value,l=r/100*i;this.revenueForm.get("taxAmount").patchValue(this._commonService.transformDecimal(l));let s=i+l;this.revenueForm.get("totalAmount").patchValue(this._commonService.transformDecimal(s));let u=this.revenueForm.value;u={...u,totalAmount:+s,amount:u.amount},this.emittedValues={formValue:u,amount:+s},this.noTotalAmount||(7004==this.data.collectionType?u.revenueCategoryId&&this.calcRevenueRemainingAmount.emit(this.emittedValues):u.customerId&&u.revenueCategoryId&&this.calcRevenueRemainingAmount.emit(this.emittedValues))}clearCategory(t){t||(this.noTotalAmount=!1,this.toggleValidation()),this.revenueForm.get("taxPercent").patchValue(0),this.revenueForm.get("tax").patchValue(null),this.revenueForm.get("totalAmount").patchValue(0),this.emittedValues={formValue:{...this.revenueForm.value,revenueCategoryId:null},amount:0},this.calcRevenueRemainingAmount.emit(this.emittedValues)}get f(){return this.revenueForm.controls}getCustomers(){return this.collectService.customersList("").subscribe(t=>{t&&(this.customers=t.data)})}getCategories(){7004==this.data.collectionType?this.collectService.GetCategories().subscribe(t=>{t&&(this.categories=t.data,console.log(this.categories))}):this.collectService.getCustomerPaymentCategories().subscribe(t=>{t&&(this.categories=t.data)})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.qu),e.Y36(B.n),e.Y36(C.k),e.Y36(D._),e.Y36($t.m),e.Y36(e.sBO),e.Y36(q.F),e.Y36(F.v),e.Y36(f.FF))},o.\u0275cmp=e.Xpm({type:o,selectors:[["otherRevenueForm"]],inputs:{data:"data"},outputs:{calcRevenueRemainingAmount:"calcRevenueRemainingAmount"},features:[e.TTD],decls:49,vars:14,consts:[[1,"add-customer-container","mb-5"],[1,"d-flex","align-items-center","gap-5"],["ngbAutoFocus","",1,"font-18","fw-700","m-0"],[1,"text-decoration-underline","blue-clr","cursor-pointer",3,"click"],[1,"customer-info"],[4,"ngIf"],[3,"formGroup"],[1,"row"],[1,"col"],[1,"form-group"],["id","categoryId","placeholder","Select category","bindLabel","categoryName","bindValue","categoryId","formControlName","revenueCategoryId",3,"items","change","clear"],["class","col",4,"ngIf"],["type","text","formControlName","amount","name","amount","placeholder","","appDecimalNumber","",1,"form-control",3,"readOnly","change"],[1,"form-group","position-relative"],["type","text","formControlName","taxAmount","placeholder","","readonly","",1,"form-control","bg-gray"],[1,"input-label"],["formControlName","tax","placeholder","Tax Percentage","bindLabel","text","bindValue","id",1,"flex-grow-1","mt-3","mt-md-0",3,"items","change"],["ng-option-tmp",""],["ng-label-tmp",""],[3,"control","errorMessages"],["type","text","formControlName","totalAmount","name","totalAmount","placeholder","","readonly","",1,"form-control","bg-gray"],[1,"col-12","mt-2"],["type","text","placeholder","Note","readonly","","formControlName","note","name","note",1,"form-control","bg-gray"],["class","col-12 mt-2",4,"ngIf"],["class","text-danger font-14 fw-500",4,"ngIf"],[1,"text-danger","font-14","fw-500"],["class","error",4,"ngIf"],[1,"error"],["placeholder","Cost Center","bindLabel","costCenterName","bindValue","costCenterId","formControlName","costCenterId",3,"items"],["class","validation-error",4,"ngIf"],[1,"validation-error"],["class","error d-block",4,"ngIf"],[1,"error","d-block"],[1,"d-flex","align-items-center","gap-2"],["type","checkbox","id","nta",1,"checkbox",3,"ngModel","ngModelOptions","change","ngModelChange"],["for","nta"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h6",2),e._uU(3,"Customer"),e.qZA(),e.TgZ(4,"p",3),e.NdJ("click",function(){return n.searchForCustomer()}),e._uU(5,"Search for a Customer"),e.qZA(),e.TgZ(6,"div",4),e._uU(7),e.qZA(),e.TgZ(8,"div",4),e._uU(9),e.qZA()(),e.YNc(10,Xt,2,1,"ng-container",5),e.qZA(),e.TgZ(11,"form",6)(12,"div",7)(13,"div",8)(14,"div",9)(15,"label"),e._uU(16,"Payment Category * "),e.qZA(),e.TgZ(17,"ng-select",10),e.NdJ("change",function(i){return n.chooseCategory(i)})("clear",function(i){return n.clearCategory(i)}),e.qZA(),e.YNc(18,nn,2,1,"ng-container",5),e.qZA()(),e.YNc(19,ln,5,2,"div",11),e.TgZ(20,"div",8)(21,"div",9)(22,"label"),e._uU(23,"Amount JOD"),e.qZA(),e.TgZ(24,"input",12),e.NdJ("change",function(){return n.calcTotalAmount()}),e.qZA(),e.YNc(25,_n,2,1,"ng-container",5),e.qZA()(),e.TgZ(26,"div",8)(27,"div",13)(28,"label"),e._uU(29,"Tax Amount JOD"),e.qZA(),e._UZ(30,"input",14),e.qZA()(),e.TgZ(31,"div",8)(32,"label",15),e._uU(33,"Tax Percentage %"),e.qZA(),e.TgZ(34,"ng-select",16),e.NdJ("change",function(i){return n.handleTaxChange(i)}),e.YNc(35,dn,1,1,"ng-template",17),e.YNc(36,gn,1,1,"ng-template",18),e.qZA(),e._UZ(37,"validation-error",19),e.qZA(),e.TgZ(38,"div",8)(39,"div",9)(40,"label"),e._uU(41,"Total Amount JOD"),e.qZA(),e._UZ(42,"input",20),e.qZA()(),e.TgZ(43,"div",21)(44,"div",9)(45,"label"),e._uU(46,"Note "),e.qZA(),e._UZ(47,"input",22),e.qZA()(),e.YNc(48,fn,5,3,"div",23),e.qZA()()),2&t){let r,i;e.xp6(7),e.Oqu((null==(r=n.revenueForm.get("customerName"))?null:r.value)||"Customer Name"),e.xp6(2),e.Oqu((null==(i=n.revenueForm.get("mobile"))?null:i.value)||"Mobile"),e.xp6(1),e.Q6J("ngIf",null==n.f.customerName?null:n.f.customerName.errors),e.xp6(1),e.Q6J("formGroup",n.revenueForm),e.xp6(6),e.Q6J("items",n.categories),e.xp6(1),e.Q6J("ngIf",null==n.f.revenueCategoryId?null:n.f.revenueCategoryId.errors),e.xp6(1),e.Q6J("ngIf",7004==n.data.collectionType),e.xp6(5),e.Q6J("readOnly",!n.revenueForm.get("revenueCategoryId").value),e.xp6(1),e.Q6J("ngIf",null==n.f.amount?null:n.f.amount.errors),e.xp6(9),e.Q6J("items",n.taxesList),e.xp6(3),e.Q6J("control",n.revenueForm.get("tax"))("errorMessages",e.DdM(13,Cn)),e.xp6(11),e.Q6J("ngIf",n.f.revenueCategoryId.value&&n.f.tax.value)}},dependencies:[m.O5,c._Y,c.Fj,c.Wl,c.JJ,c.JL,c.sg,c.u,c.On,x.w9,x.ir,x.mR,h.Q,E.L],styles:[".card-form[_ngcontent-%COMP%]{background:transparent;border:0px solid #c4cdd5;box-shadow:none;border-radius:8px;margin:0;padding:10px 0 30px}.card-sm[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:16px;color:#1b212d}.card-sm[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#929eae}.bg-gray[_ngcontent-%COMP%]{background:#f9f9f9}.tax-percent[_ngcontent-%COMP%]{position:absolute;right:20px;bottom:10px}.card-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{position:relative}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;margin-bottom:7px}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:46px}.form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:red;font-weight:500;font-size:14px}.total2[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ccc;font-size:14px;font-weight:600;padding:10px 30px;display:block;border-radius:9px}p[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#000;margin:0}.add-customer-container[_ngcontent-%COMP%]{height:91px;border-radius:8px;border:1px solid #F2F2F2;box-shadow:0 4px 4px #00000040;padding:0 20px}.add-customer-container[_ngcontent-%COMP%]   .customer-info[_ngcontent-%COMP%]{background:#D3D3D3;width:207px;height:48px;display:flex;align-items:center;padding-left:10px;border-radius:8px;font-size:14px}.checkbox[_ngcontent-%COMP%]{accent-color:var(--primary);height:20px;width:20px}"]}),o})();const yn=["fileInput"];function xn(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.resetForm())}),e._UZ(1,"img",19),e.qZA()}}function An(o,a){1&o&&(e.TgZ(0,"th"),e._uU(1,"Action"),e.qZA())}function Tn(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function bn(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Value must be greater than zero"),e.qZA())}function In(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Tn,2,0,"span",36),e.YNc(2,bn,2,0,"span",36),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n,r;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("paidAmountJod"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t||null==(r=t.get("paidAmountJod"))?null:r.errors.min)}}function kn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,In,3,2,"ng-container",10),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("paidAmountJod"))?null:n.invalid)&&(null==t||null==(n=t.get("paidAmountJod"))?null:n.touched)||(null==t||null==(n=t.get("paidAmountJod"))?null:n.dirty))}}function Nn(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function Zn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Nn,2,0,"span",36),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("currencyId"))?null:n.errors.required)}}function wn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Zn,2,1,"ng-container",10),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("currencyId"))?null:n.invalid)&&(null==t||null==(n=t.get("currencyId"))?null:n.touched)||(null==t||null==(n=t.get("currencyId"))?null:n.dirty))}}function qn(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function Fn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,qn,2,0,"span",36),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("transfereDate"))?null:n.errors.required)}}function Pn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Fn,2,1,"ng-container",10),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("transfereDate"))?null:n.invalid)&&(null==t||null==(n=t.get("transfereDate"))?null:n.touched)||(null==t||null==(n=t.get("transfereDate"))?null:n.dirty))}}function Mn(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=a.item;e.xp6(1),e.Oqu((null==t?null:t.name)+" - "+(null==t?null:t.accountNumber))}}function Dn(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function Jn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Dn,2,0,"span",36),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("markaziaBankAccountId"))?null:n.errors.required)}}function Vn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Jn,2,1,"ng-container",10),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("markaziaBankAccountId"))?null:n.invalid)&&(null==t||null==(n=t.get("markaziaBankAccountId"))?null:n.touched)||(null==t||null==(n=t.get("markaziaBankAccountId"))?null:n.dirty))}}function On(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function Sn(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input allows only digits"),e.qZA())}function Qn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,On,2,0,"span",36),e.YNc(2,Sn,2,0,"span",36),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n,r;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("transfereReference"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t||null==(r=t.get("transfereReference"))?null:r.errors.pattern)}}function Rn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Qn,3,2,"ng-container",10),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("transfereReference"))?null:n.invalid)&&(null==t||null==(n=t.get("transfereReference"))?null:n.touched)||(null==t||null==(n=t.get("transfereReference"))?null:n.dirty))}}function Un(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"input",38),e.NdJ("change",function(r){e.CHM(t);const i=e.oxw().index,l=e.oxw();return e.KtG(l.onFileChange(r,i))}),e.qZA()}if(2&o){const t=e.oxw().index;e.Q6J("id",t+"file-input")}}function Yn(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",39),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(),i=r.$implicit,l=r.index,s=e.oxw();return e.KtG(s.fileAction(null==i?null:i.value.attachment,l,"view"))}),e.qZA(),e.TgZ(2,"img",40),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(),i=r.$implicit,l=r.index,s=e.oxw();return e.KtG(s.fileAction(null==i?null:i.value.attachment,l,"delete"))}),e.qZA(),e.BQk()}}function Bn(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function En(o,a){if(1&o&&(e.ynx(0),e.TgZ(1,"div",22),e.YNc(2,Bn,2,0,"span",36),e.qZA(),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(2),e.Q6J("ngIf",null==t||null==(n=t.get("attachment"))?null:n.errors.required)}}function Gn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,En,3,1,"ng-container",10),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("attachment"))?null:n.invalid)&&(null==t||null==(n=t.get("attachment"))?null:n.touched)||(null==t||null==(n=t.get("attachment"))?null:n.dirty))}}function Ln(o,a){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Input is required"),e.qZA())}function Kn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Ln,2,0,"span",36),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("cardPayerName"))?null:n.errors.required)}}function Hn(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Kn,2,1,"ng-container",10),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("cardPayerName"))?null:n.invalid)&&(null==t||null==(n=t.get("cardPayerName"))?null:n.touched)||(null==t||null==(n=t.get("cardPayerName"))?null:n.dirty))}}function jn(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",43),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2).index,i=e.oxw();return e.KtG(i.removeItem(r))}),e.qZA(),e.BQk()}}function $n(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",43),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(3).index,i=e.oxw();return e.KtG(i.removeItem(r))}),e.qZA(),e.BQk()}}function zn(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"i",45),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(4),i=r.$implicit,l=r.index,s=e.oxw();return e.KtG(s.reverse(i,l))}),e.qZA(),e.BQk()}}function Wn(o,a){if(1&o&&e.YNc(0,zn,2,0,"ng-container",10),2&o){const t=e.oxw(3).$implicit;e.Q6J("ngIf",!t.get("isReversed").value)}}function Xn(o,a){if(1&o&&(e.YNc(0,$n,2,0,"ng-container",41),e.YNc(1,Wn,1,1,"ng-template",null,44,e.W1O)),2&o){const t=e.MAs(2),n=e.oxw(2).$implicit;e.Q6J("ngIf",n.get("isNew").value)("ngIfElse",t)}}function eo(o,a){if(1&o&&(e.TgZ(0,"td"),e.YNc(1,jn,2,0,"ng-container",41),e.YNc(2,Xn,3,2,"ng-template",null,42,e.W1O),e.qZA()),2&o){const t=e.MAs(3),n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.reverse))("ngIfElse",t)}}function to(o,a){if(1&o){const t=e.EpF();e.ynx(0,20),e.TgZ(1,"tr",21)(2,"td")(3,"div",22)(4,"input",23),e.NdJ("change",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.sendAmount())})("input",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.handleAmountFocus())}),e.qZA(),e.YNc(5,kn,2,1,"ng-container",10),e.qZA()(),e.TgZ(6,"td")(7,"div",24),e._UZ(8,"ng-select",25),e.YNc(9,wn,2,1,"ng-container",10),e.qZA()(),e.TgZ(10,"td")(11,"div",22),e._UZ(12,"input",26),e.YNc(13,Pn,2,1,"ng-container",10),e.qZA()(),e.TgZ(14,"td")(15,"div",22)(16,"ng-select",27),e.YNc(17,Mn,2,1,"ng-template",28),e.qZA(),e.YNc(18,Vn,2,1,"ng-container",10),e.qZA()(),e.TgZ(19,"td")(20,"div",22),e._UZ(21,"input",29),e.YNc(22,Rn,2,1,"ng-container",10),e.qZA()(),e.TgZ(23,"td")(24,"div",30),e.YNc(25,Un,1,1,"input",31),e.TgZ(26,"label",32),e._uU(27),e.qZA(),e.YNc(28,Yn,3,0,"ng-container",10),e.qZA(),e.YNc(29,Gn,2,1,"ng-container",10),e.qZA(),e.TgZ(30,"td")(31,"div",22),e._UZ(32,"input",33),e.YNc(33,Hn,2,1,"ng-container",10),e.qZA()(),e.TgZ(34,"td")(35,"div",34)(36,"input",35),e.NdJ("change",function(r){const l=e.CHM(t).index,s=e.oxw();return e.KtG(s.isSameCustomer(r,l))}),e.qZA()()(),e.YNc(37,eo,4,2,"td",10),e.qZA(),e.BQk()}if(2&o){const t=a.$implicit,n=a.index,r=e.oxw();let i,l,s,u,v,Z,w;e.xp6(1),e.Q6J("formGroupName",n),e.xp6(4),e.Q6J("ngIf",null==t||null==(i=t.get("paidAmountJod"))?null:i.errors),e.xp6(3),e.Q6J("items",r.currencies),e.xp6(1),e.Q6J("ngIf",null==(l=t.get("currencyId"))?null:l.errors),e.xp6(4),e.Q6J("ngIf",null==t||null==(s=t.get("transfereDate"))?null:s.errors),e.xp6(3),e.Q6J("items",r.accounts),e.xp6(2),e.Q6J("ngIf",null==t||null==(u=t.get("markaziaBankAccountId"))?null:u.errors),e.xp6(4),e.Q6J("ngIf",null==t||null==(v=t.get("transfereReference"))?null:v.errors),e.xp6(2),e.ekj("disable-elm",r.otherData.refund),e.xp6(1),e.Q6J("ngIf",t.get("isNew").value),e.xp6(1),e.ekj("text-success",null==t?null:t.value.attachment),e.uIk("for",n+"file-input"),e.xp6(1),e.Oqu((null==t?null:t.value.attachment)&&(null==t?null:t.value.attachment)||"Upload file"),e.xp6(1),e.Q6J("ngIf",null==t?null:t.value.attachment),e.xp6(1),e.Q6J("ngIf",null==t||null==(Z=t.get("attachment"))?null:Z.errors),e.xp6(4),e.Q6J("ngIf",null==t||null==(w=t.get("cardPayerName"))?null:w.errors),e.xp6(4),e.Q6J("ngIf",!(null!=r.otherData&&r.otherData.isMultiCollect||r.otherData.refund))}}function no(o,a){1&o&&(e.TgZ(0,"div",46)(1,"p",47),e._UZ(2,"i",48),e._uU(3,"Press Tab to add payment in another currency "),e.qZA()())}function oo(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",49)(1,"label",50),e._uU(2,"Cashier Notes"),e.qZA(),e.TgZ(3,"textarea",51),e.NdJ("change",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i._subjectService.cashierNote.next(r.target.value))}),e.qZA()()}}function ro(o,a){1&o&&e._UZ(0,"i",52)}let io=(()=>{class o{onKeydownHandler(){this.handleTabKeyDown()}constructor(t,n,r,i,l,s){this.fb=t,this._modalService=n,this._activeModal=r,this._commonService=i,this._subjectService=l,this._collectService=s,this.invalidFileType="",this.fileTypes=["image/jpeg","image/jpg","image/png","application/pdf"],this.accounts=[],this.filesArray=[],this.uploadedFiles=[],this.filesSubscription=new b.w0,this.amountEvent=new e.vpe,this.formValueEvent=new e.vpe,this.colllectedViaMachine=!1}ngOnInit(){this.colllectedViaMachine=JSON.parse(localStorage.getItem("pos_mc")),this.getBankAccounts(),this.accounts=[{id:1,name:78954},{id:1,name:78954}],this.initForm(),this.bankTransferForm.statusChanges.subscribe(t=>{let n;n=this.otherData?.reverse?!("VALID"==t||"DISABLED"==t):"VALID"!=t,this.bankTransferForm.markAllAsTouched(),this.formValueEvent.emit({values:this.bankTransferForm.getRawValue(),touched:n})}),this.otherData?.refund&&this.bankArrControls.disable({emitEvent:!1}),this.otherData?.reverse&&this.disableReversedItems()}disableReversedItems(){this.bankArrControls.controls.forEach(t=>{let n=t.get("attachment"),r=n.getRawValue();this.filesArray.push(r),r&&n.setValue("Attachment"),t.get("isNew").value||t.disable()})}getBankAccounts(){this._collectService.getBankAccounts("?AccountType=15001&currencyId=9001&Status=2001&PageNo=0&PageSize=1000").subscribe(n=>{n.isSuccess&&(this.accounts=n.data.map(r=>({id:r.accountId,name:r.bankNameEnglish,accountNumber:r.accountNumber})),console.log(n))})}initForm(){if(this.bankTransferForm=this.fb.group({bankArray:this.fb.array([this.bankFormControls()])}),this.recentFormValues?.bankTransfer?.bankArray?.length){let t=this.recentFormValues.bankTransfer.bankArray,n=this.bankTransferForm.get("bankArray");n.removeAt(0);for(let i of t)n.push(this.bankFormControls(i));let r=this._subjectService.bankTransferFiles.subscribe(i=>{i?.length>0&&(this.filesArray=i)});this.filesSubscription.add(r)}}ngOnDestroy(){this.recentFormValues?.bankTransfer?.bankArray[0]?.paidAmountJod>0&&(this.formValueEvent.emit({values:this.bankTransferForm.getRawValue(),touched:!1}),this._subjectService.bankTransferFiles.next(this.filesArray),this.filesSubscription.unsubscribe())}handleAmountFocus(){this.bankTransferForm.markAllAsTouched()}bankFormControls(t){return this.fb.group(t?{sameCustomer:[t?.sameCustomer],paidAmountJod:[t?.paidAmountJod,[c.kI.min(1e-16),c.kI.required]],transfereDate:[t?.transfereDate,[c.kI.required]],markaziaBankAccountId:[t?.markaziaBankAccountId,[c.kI.required]],transfereReference:[t?.transfereReference,[c.kI.required,c.kI.pattern("^[0-9]*$")]],transfereAttachment:[t?.transfereAttachment],attachment:[t?.attachment],cardPayerName:[t?.cardPayerName,7004!=this.otherData.collectionType&&[c.kI.required]],currencyId:[t?.currencyId,[c.kI.required]],isReversed:[(t?.isReversed??t?.isReversed)||!1],isNew:[(t?.isNew??t?.isNew)||!1],lineNew:[(t?.lineNew??t?.lineNew)||!1]}:{sameCustomer:[!0],paidAmountJod:["",[c.kI.min(1e-16),c.kI.required]],transfereDate:[(new Date).toISOString().substring(0,10),[c.kI.required]],markaziaBankAccountId:[null,[c.kI.required]],transfereReference:["",[c.kI.required,c.kI.pattern("^[0-9]*$")]],transfereAttachment:[""],attachment:[""],cardPayerName:[localStorage.getItem("pmcn")||"No Customer",7004!=this.otherData.collectionType&&[c.kI.required]],currencyId:[9001,[c.kI.required]],isReversed:[!1],isNew:[!0],lineNew:[!0]})}fileAction(t,n,r){if("view"==r){const i=this._modalService.open(Q.g,{size:"md"});let l=this.bankArrControls.at(n).get("isReversed").getRawValue(),s=this.bankArrControls.at(n).get("isNew").getRawValue();if(this.otherData?.reverse&&!1!==l)(null===l||l)&&(i.componentInstance.imageUploadedView={viewOnly:!0,url:this.filesArray[n]});else{let u=this.filesArray[n];i.componentInstance.imageUploadedView=s?u:{viewOnly:!0,url:u}}}else{if(this.otherData?.reverse&&!this.bankArrControls.at(n).get("isNew").getRawValue())return;this.filesArray.splice(n,1,{});let i=this.inputRefList.toArray()[n];this.bankTransferForm.get("bankArray").at(n).get("attachment")?.setValue(""),this.bankTransferForm.get("bankArray").at(n).get("transfereAttachment")?.setValue(""),i.nativeElement.value=null,this.removeFileFromLocalStorage(n)}}removeFileFromLocalStorage(t){localStorage.getItem("bpUploadedFiles")&&(this.uploadedFiles=[...JSON.parse(localStorage.getItem("btUploadedFiles"))],this.uploadedFiles.splice(t,1,"noFile"),localStorage.setItem("btUploadedFiles",JSON.stringify(this.uploadedFiles)))}onFileChange(t,n){let r=[...t.target.files],i=this.bankTransferForm.get("bankArray");r.length>0&&(this.checkInvalidImageFormat(r)||r.forEach(s=>{this.uploadFile(s,n),this._commonService.fileToBase64(s).then(u=>{this.filesArray.splice(n,1,u),i.at(n).get("attachment")?.setValue("Attachment")})}))}uploadFile(t,n){const r=new FormData;r.append("Folder","BankTransfer"),r.append("File",t),this._collectService.uploadFile(r).subscribe(i=>{i.isSuccess&&(this.uploadedFiles.splice(n,1,i.data),this.bankTransferForm.get("bankArray").at(n).get("transfereAttachment")?.setValue(i.data),localStorage.setItem("btUploadedFiles",JSON.stringify(this.uploadedFiles)))})}checkInvalidImageFormat(t){let n,r=t.map(l=>l.file);n=void 0!==r[0]?r:t;let i=!1;for(let l of n)if(!this.fileTypes.includes(l.type)){i=!0,this.invalidFileType="This file not support, supported formates: JPEG, JPG, PNG, PDF",this.bankTransferForm.get("attachment")?.patchValue(""),setTimeout(()=>this.invalidFileType="",3e3);break}return i}removeItem(t){this.otherData.refund||(this.filesArray.splice(t,1),this.bankArrControls.removeAt(t),this.removeFileFromLocalStorage(t),this.sendAmount())}get bankArrControls(){return this.bankTransferForm?this.bankTransferForm.get("bankArray"):null}handleTabKeyDown(){this.otherData.refund||this.bankTransferForm.invalid||this.otherData.amountExceeded||this.otherData?.isMultiCollect||this.addNewRow()}addNewRow(){this.bankArrControls.push(this.bankFormControls()),this.bankTransferForm.markAsUntouched()}isSameCustomer(t,n){let r=this.bankArrControls.at(n);if(t.target.checked)if(7004==this.otherData.collectionType)r.controls.cardPayerName.setValue("No Customer");else{let i=localStorage.getItem("pmcn");r.controls.cardPayerName.setValue(i)}else r.controls.cardPayerName.setValue("")}handleSubmit(){this.bankTransferForm.invalid?this.bankTransferForm.markAllAsTouched():(console.log(this.bankTransferForm.getRawValue()),this.formValueEvent.emit({values:this.bankTransferForm.getRawValue(),submit:!0}))}get f(){return this.bankTransferForm.controls}sendAmount(){this.calculateAmount()}calculateAmount(){let t=0;for(let n of this.bankArrControls.controls)t+=+n.controls.paidAmountJod.getRawValue();this.amountEvent.emit({amount:t})}reverse(t,n){const r=this.bankArrControls.at(n),i=this.fb.group({});Object.keys(r.controls).forEach(u=>{const v=I.cloneDeep(r.get(u)?.value);i.addControl(u,new c.NI(v))});let l=-1*r.get("paidAmountJod").value;i.patchValue({paidAmountJod:l,isReversed:!0,lineNew:!0}),r.get("isReversed").setValue(!0),r.get("lineNew").setValue(!1),this.bankArrControls.insert(n+1,i),this.filesArray.splice(n+1,0,this.filesArray[n]),this.bankArrControls.at(n).disable(),this.bankArrControls.at(n+1).disable(),this.sendAmount()}resetForm(){this.bankArrControls.clear(),this.bankArrControls.push(this.bankFormControls()),this.bankTransferForm.markAsUntouched(),this.formValueEvent.emit({values:this.bankTransferForm.getRawValue(),touched:!1,reset:!0}),this.amountEvent.emit({amount:0})}closeModal(){this._activeModal?this._activeModal.close():this._commonService.NavigateToRoute(`/${this.otherData?.redirectRoute}`)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.qu),e.Y36(f.FF),e.Y36(f.Kz,8),e.Y36(F.v),e.Y36(D._),e.Y36(C.k))},o.\u0275cmp=e.Xpm({type:o,selectors:[["bankTransfer"]],viewQuery:function(t,n){if(1&t&&e.Gf(yn,5),2&t){let r;e.iGM(r=e.CRH())&&(n.inputRefList=r)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown.tab",function(i){return n.onKeydownHandler(i)},!1,e.evT)},inputs:{accounts:"accounts",currencies:"currencies",recentFormValues:"recentFormValues",isPending:"isPending",otherData:"otherData"},outputs:{amountEvent:"amountEvent",formValueEvent:"formValueEvent"},decls:42,vars:10,consts:[[1,"tab-item"],[1,"row"],[1,"col-md-12","text-end","my-2"],["type","button","class","btn btn-trash",3,"click",4,"ngIf"],[3,"formGroup","submit"],[1,"col-md-12"],[1,"card-table"],[1,""],[1,"table"],["width","15%"],[4,"ngIf"],["formArrayName","bankArray",4,"ngFor","ngForOf"],["class","col-md-12 d-flex mt-2",4,"ngIf"],["class","col-12 mb-4",4,"ngIf"],[1,"btns-group","my-2","me-0"],["type","button",1,"btn","btn-cancel",3,"disabled","click"],["type","submit",1,"btn","btn-save",3,"disabled"],["class","fa-solid fa-circle-notch fa-spin",4,"ngIf"],["type","button",1,"btn","btn-trash",3,"click"],["src","assets/images/reload.png","alt","",2,"width","25px"],["formArrayName","bankArray"],[3,"formGroupName"],[1,"form-group"],["type","number","placeholder","Amount","formControlName","paidAmountJod","appDecimalNumber","",1,"form-control",3,"change","input"],[1,"ngselect-curruncy","form-group"],["placeholder","Currency","bindLabel","name","bindValue","lookupId","formControlName","currencyId",3,"items"],["type","date","formControlName","transfereDate",1,"form-control"],["id","accountNo","placeholder"," Select Bank Account ","bindLabel","name","bindValue","id","formControlName","markaziaBankAccountId",3,"items"],["ng-option-tmp",""],["type","text","formControlName","transfereReference",1,"form-control"],[1,"custom-file","align-items-center"],["type","file","class","file-input__input",3,"id","change",4,"ngIf"],[1,"file-input__label"],["type","text","placeholder","","formControlName","cardPayerName","OnlyCharacter","",1,"form-control"],[1,"form-check"],["type","checkbox","formControlName","sameCustomer",1,"form-check-input",3,"change"],["class","error",4,"ngIf"],[1,"error"],["type","file",1,"file-input__input",3,"id","change"],["height","20","src","assets/images/eye.png",1,"cursor-pointer",3,"click"],["height","20","src","assets/images/trash.png",1,"cursor-pointer",3,"click"],[4,"ngIf","ngIfElse"],["reverseCase",""],["src","assets/images/trash.png","alt","",1,"cursor-pointer",2,"width","25px",3,"click"],["reverseTemp",""],[1,"cursor-pointer","green-clr","fas","fa-rotate-left","font-20",3,"click"],[1,"col-md-12","d-flex","mt-2"],[1,"blue-clr","d-flex","align-items-center","fw-500","gap-1"],[1,"fa-solid","fa-circle-plus","primary-clr","fa-2x"],[1,"col-12","mb-4"],[1,"input-label"],[1,"form-control",3,"change"],[1,"fa-solid","fa-circle-notch","fa-spin"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e.YNc(3,xn,2,0,"button",3),e.qZA(),e.TgZ(4,"form",4),e.NdJ("submit",function(){return n.handleSubmit()}),e.TgZ(5,"div",1)(6,"div",5)(7,"div",6)(8,"div",7)(9,"table",8)(10,"thead")(11,"tr")(12,"th"),e._uU(13,"Paid Amount*"),e.qZA(),e.TgZ(14,"th"),e._uU(15,"Currency*"),e.qZA(),e.TgZ(16,"th"),e._uU(17,"Transfer Date*"),e.qZA(),e.TgZ(18,"th",9),e._uU(19,"Markazia Bank"),e._UZ(20,"br"),e._uU(21," Account No*"),e.qZA(),e.TgZ(22,"th"),e._uU(23,"Transfer Refernece*"),e.qZA(),e.TgZ(24,"th",9),e._uU(25,"Transfer Attachment"),e.qZA(),e.TgZ(26,"th"),e._uU(27,"Payer Name"),e.qZA(),e.TgZ(28,"th"),e._uU(29,"Same Customer"),e.qZA(),e.YNc(30,An,2,0,"th",10),e.qZA()(),e.TgZ(31,"tbody"),e.YNc(32,to,38,19,"ng-container",11),e.qZA()()()(),e.YNc(33,no,4,0,"div",12),e.qZA()(),e.YNc(34,oo,4,0,"div",13),e.TgZ(35,"div",5)(36,"div",14)(37,"button",15),e.NdJ("click",function(){return n.closeModal()}),e._uU(38,"Cancel"),e.qZA(),e.TgZ(39,"button",16),e._uU(40),e.YNc(41,ro,1,0,"i",17),e.qZA()()()()()()),2&t&&(e.xp6(3),e.Q6J("ngIf",!n.otherData.reverse&&!n.otherData.refund),e.xp6(1),e.Q6J("formGroup",n.bankTransferForm),e.xp6(26),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.isMultiCollect)),e.xp6(2),e.Q6J("ngForOf",null==n.bankArrControls?null:n.bankArrControls.controls),e.xp6(1),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.isMultiCollect||n.otherData.refund)),e.xp6(1),e.Q6J("ngIf",7001==n.otherData.collectionType||7004==n.otherData.collectionType||7005==n.otherData.collectionType||7008==n.otherData.collectionType||7009==n.otherData.collectionType||7002==n.otherData.collectionType&&n.otherData.refund),e.xp6(3),e.Q6J("disabled",n.colllectedViaMachine),e.xp6(2),e.Q6J("disabled",n.isPending),e.xp6(1),e.hij(" ",n.isPending?"Saving":"Confirm"," "),e.xp6(1),e.Q6J("ngIf",n.isPending))},dependencies:[m.sg,m.O5,c._Y,c.Fj,c.wV,c.Wl,c.JJ,c.JL,c.sg,c.u,c.x0,c.CE,x.w9,x.ir,h.Q,k.Q],styles:[".form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;margin-bottom:7px}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:46px}.form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:red;font-weight:500;font-size:14px}  .ng-dropdown-panel{z-index:9999999!important}.card-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 0 10px 15px!important;font-weight:500}.form-check-input[_ngcontent-%COMP%]{width:20px!important;height:20px}.card-table[_ngcontent-%COMP%]{overflow:visible}.custom-file[_ngcontent-%COMP%]{border:1px solid #dadada;display:flex;height:46px;border-radius:.375rem;justify-content:center;gap:5px;background:#fff}.file-input__input[_ngcontent-%COMP%]{width:.1px;height:.1px;opacity:0;overflow:hidden;position:absolute;z-index:-1}.file-input__label[_ngcontent-%COMP%]{cursor:pointer;display:inline-flex;align-items:center;border-radius:4px;font-weight:600;color:var(--gray-500);font-size:14px}"]}),o})();const G=["fileInput"];function ao(o,a){1&o&&(e.TgZ(0,"span",31),e._uU(1,"Input is required"),e.qZA())}function lo(o,a){1&o&&(e.TgZ(0,"span",31),e._uU(1,"Value must be greater than zero"),e.qZA())}function co(o,a){if(1&o&&(e.ynx(0),e.YNc(1,ao,2,0,"span",30),e.YNc(2,lo,2,0,"span",30),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n,r;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("pledgeAmountJod"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t||null==(r=t.get("pledgeAmountJod"))?null:r.errors.min)}}function so(o,a){if(1&o&&(e.ynx(0),e.YNc(1,co,3,2,"ng-container",20),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("pledgeAmountJod"))?null:n.invalid)&&(null==t||null==(n=t.get("pledgeAmountJod"))?null:n.touched)||(null==t||null==(n=t.get("pledgeAmountJod"))?null:n.dirty))}}function uo(o,a){1&o&&(e.TgZ(0,"span",31),e._uU(1,"Input is required"),e.qZA())}function mo(o,a){if(1&o&&(e.ynx(0),e.YNc(1,uo,2,0,"span",30),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("currencyId"))?null:n.errors.required)}}function _o(o,a){if(1&o&&(e.ynx(0),e.YNc(1,mo,2,1,"ng-container",20),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("currencyId"))?null:n.invalid)&&(null==t||null==(n=t.get("currencyId"))?null:n.touched)||(null==t||null==(n=t.get("currencyId"))?null:n.dirty))}}function po(o,a){1&o&&(e.TgZ(0,"span",31),e._uU(1,"Input is required"),e.qZA())}function go(o,a){if(1&o&&(e.ynx(0),e.YNc(1,po,2,0,"span",30),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("bankPledgeDate"))?null:n.errors.required)}}function ho(o,a){if(1&o&&(e.ynx(0),e.YNc(1,go,2,1,"ng-container",20),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("bankPledgeDate"))?null:n.invalid)&&(null==t||null==(n=t.get("bankPledgeDate"))?null:n.touched)||(null==t||null==(n=t.get("bankPledgeDate"))?null:n.dirty))}}function fo(o,a){1&o&&(e.TgZ(0,"span",31),e._uU(1,"Input is required"),e.qZA())}function Co(o,a){if(1&o&&(e.ynx(0),e.YNc(1,fo,2,0,"span",30),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("bankId"))?null:n.errors.required)}}function vo(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Co,2,1,"ng-container",20),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("bankId"))?null:n.invalid)&&(null==t||null==(n=t.get("bankId"))?null:n.touched)||(null==t||null==(n=t.get("bankId"))?null:n.dirty))}}function yo(o,a){1&o&&(e.TgZ(0,"span",31),e._uU(1,"Input is required"),e.qZA())}function xo(o,a){1&o&&(e.TgZ(0,"span",31),e._uU(1,"Input allows only digits"),e.qZA())}function Ao(o,a){if(1&o&&(e.ynx(0),e.YNc(1,yo,2,0,"span",30),e.YNc(2,xo,2,0,"span",30),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n,r;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("bankPledgeNumber"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t||null==(r=t.get("bankPledgeNumber"))?null:r.errors.pattern)}}function To(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Ao,3,2,"ng-container",20),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("bankPledgeNumber"))?null:n.invalid)&&(null==t||null==(n=t.get("bankPledgeNumber"))?null:n.touched)||(null==t||null==(n=t.get("bankPledgeNumber"))?null:n.dirty))}}function bo(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"input",32),e.NdJ("change",function(r){e.CHM(t);const i=e.oxw().index,l=e.oxw();return e.KtG(l.onFileChange(r,i))}),e.qZA()}if(2&o){const t=e.oxw().index;e.Q6J("id",t+"file-input")}}function Io(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",33),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(),i=r.$implicit,l=r.index,s=e.oxw();return e.KtG(s.fileAction(null==i?null:i.value.attachment,l,"view"))}),e.qZA(),e.TgZ(2,"img",34),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(),i=r.$implicit,l=r.index,s=e.oxw();return e.KtG(s.fileAction(null==i?null:i.value.attachment,l,"delete"))}),e.qZA(),e.BQk()}}function ko(o,a){1&o&&(e.TgZ(0,"span",31),e._uU(1,"Input is required"),e.qZA())}function No(o,a){if(1&o&&(e.ynx(0),e.TgZ(1,"div",18),e.YNc(2,ko,2,0,"span",30),e.qZA(),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(2),e.Q6J("ngIf",null==t||null==(n=t.get("attachment"))?null:n.errors.required)}}function Zo(o,a){if(1&o&&(e.ynx(0),e.YNc(1,No,3,1,"ng-container",20),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("attachment"))?null:n.invalid)&&(null==t||null==(n=t.get("attachment"))?null:n.touched)||(null==t||null==(n=t.get("attachment"))?null:n.dirty))}}function wo(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",36),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2).index,i=e.oxw();return e.KtG(i.removeItem(r))}),e.qZA(),e.BQk()}}function qo(o,a){if(1&o&&(e.ynx(0),e.YNc(1,wo,2,0,"ng-container",35),e.BQk()),2&o){e.oxw();const t=e.MAs(32),n=e.oxw();e.xp6(1),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.reverse))("ngIfElse",t)}}function Fo(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",36),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2).index,i=e.oxw();return e.KtG(i.removeItem(r))}),e.qZA(),e.BQk()}}function Po(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"i",38),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(3),i=r.$implicit,l=r.index,s=e.oxw();return e.KtG(s.reverse(i,l))}),e.qZA(),e.BQk()}}function Mo(o,a){if(1&o&&e.YNc(0,Po,2,0,"ng-container",20),2&o){const t=e.oxw(2).$implicit;e.Q6J("ngIf",!t.get("isReversed").value)}}function Do(o,a){if(1&o&&(e.YNc(0,Fo,2,0,"ng-container",35),e.YNc(1,Mo,1,1,"ng-template",null,37,e.W1O)),2&o){const t=e.MAs(2),n=e.oxw().$implicit;e.Q6J("ngIf",n.get("isNew").value)("ngIfElse",t)}}function Jo(o,a){if(1&o){const t=e.EpF();e.ynx(0,16),e.TgZ(1,"tr",17)(2,"td")(3,"div",18)(4,"input",19),e.NdJ("change",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.sendAmount())})("input",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.handleAmountFocus())}),e.qZA(),e.YNc(5,so,2,1,"ng-container",20),e.qZA()(),e.TgZ(6,"td")(7,"div",21),e._UZ(8,"ng-select",22),e.YNc(9,_o,2,1,"ng-container",20),e.qZA()(),e.TgZ(10,"td")(11,"div",18),e._UZ(12,"input",23),e.YNc(13,ho,2,1,"ng-container",20),e.qZA()(),e.TgZ(14,"td")(15,"div",18),e._UZ(16,"ng-select",24),e.YNc(17,vo,2,1,"ng-container",20),e.qZA()(),e.TgZ(18,"td")(19,"div",18),e._UZ(20,"input",25),e.YNc(21,To,2,1,"ng-container",20),e.qZA()(),e.TgZ(22,"td")(23,"div",26),e.YNc(24,bo,1,1,"input",27),e.TgZ(25,"label",28),e._uU(26),e.qZA(),e.YNc(27,Io,3,0,"ng-container",20),e.qZA(),e.YNc(28,Zo,2,1,"ng-container",20),e.qZA(),e.TgZ(29,"td"),e.YNc(30,qo,2,2,"ng-container",20),e.YNc(31,Do,3,2,"ng-template",null,29,e.W1O),e.qZA()(),e.BQk()}if(2&o){const t=a.$implicit,n=a.index,r=e.oxw();let i,l,s,u,v,Z;e.xp6(1),e.Q6J("formGroupName",n),e.xp6(4),e.Q6J("ngIf",null==t||null==(i=t.get("pledgeAmountJod"))?null:i.errors),e.xp6(3),e.Q6J("items",r.currencies),e.xp6(1),e.Q6J("ngIf",null==t||null==(l=t.get("currencyId"))?null:l.errors),e.xp6(4),e.Q6J("ngIf",null==t||null==(s=t.get("bankPledgeDate"))?null:s.errors),e.xp6(3),e.Q6J("items",r.banks),e.xp6(1),e.Q6J("ngIf",null==t||null==(u=t.get("bankId"))?null:u.errors),e.xp6(4),e.Q6J("ngIf",null==t||null==(v=t.get("bankPledgeNumber"))?null:v.errors),e.xp6(2),e.ekj("disable-elm",r.otherData.refund),e.xp6(1),e.Q6J("ngIf",t.get("isNew").value),e.xp6(1),e.ekj("text-success",null==t?null:t.value.attachment),e.uIk("for",n+"file-input"),e.xp6(1),e.Oqu((null==t?null:t.value.attachment)&&(null==t?null:t.value.attachment)||"Upload file"),e.xp6(1),e.Q6J("ngIf",null==t?null:t.value.attachment),e.xp6(1),e.Q6J("ngIf",null==t||null==(Z=t.get("attachment"))?null:Z.errors),e.xp6(2),e.Q6J("ngIf",!r.otherData.refund)}}function Vo(o,a){1&o&&(e.TgZ(0,"div",39)(1,"p",40),e._UZ(2,"i",41),e._uU(3,"Press Tab to add new row "),e.qZA()())}function Oo(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",42)(1,"label",43),e._uU(2,"Cashier Notes"),e.qZA(),e.TgZ(3,"textarea",44),e.NdJ("change",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i._subjectService.cashierNote.next(r.target.value))}),e.qZA()()}}function So(o,a){1&o&&e._UZ(0,"i",45)}let Qo=(()=>{class o{onKeydownHandler(){this.handleTabKeyDown()}constructor(t,n,r,i,l,s){this.fb=t,this._modalService=n,this._activeModal=r,this._commonService=i,this._subjectService=l,this._collectService=s,this.invalidFileType="",this.fileTypes=["image/jpeg","image/jpg","image/png","application/pdf"],this.banks=[],this.filesSubscription=new b.w0,this.amountEvent=new e.vpe,this.formValueEvent=new e.vpe,this.uploadedFiles=[],this.filesArray=[],this.colllectedViaMachine=!1}ngOnInit(){this.colllectedViaMachine=JSON.parse(localStorage.getItem("pos_mc")),this.initForm(),this.bankPledgeForm.statusChanges.subscribe(t=>{let n;n=this.otherData?.reverse?!("VALID"==t||"DISABLED"==t):"VALID"!=t,this.bankPledgeForm.markAllAsTouched(),this.formValueEvent.emit({values:this.bankPledgeForm.getRawValue(),touched:n})}),this.otherData?.refund&&this.pledgeArrControls.disable({emitEvent:!1}),this.otherData?.reverse&&this.disableReversedItems()}disableReversedItems(){this.pledgeArrControls.controls.forEach(t=>{let n=t.get("attachment"),r=n.getRawValue();this.filesArray.push(r),r&&n.setValue("Attachment"),t.get("isNew").value||t.disable()})}initForm(){if(this.bankPledgeForm=this.fb.group({pledgeArray:this.fb.array([this.pledgeFormControls()])}),this.recentFormValues?.bankPledge?.pledgeArray?.length){let t=this.recentFormValues.bankPledge.pledgeArray,n=this.bankPledgeForm.get("pledgeArray");n.removeAt(0);for(let i of t)n.push(this.pledgeFormControls(i));let r=this._subjectService.bankPledgeFiles.subscribe(i=>{i?.length>0&&(this.filesArray=i)});this.filesSubscription.add(r)}}ngOnDestroy(){this.recentFormValues?.bankPledge?.pledgeArray[0]?.pledgeAmountJod>0&&(this.formValueEvent.emit({values:this.bankPledgeForm.getRawValue(),touched:!1}),this._subjectService.bankPledgeFiles.next(this.filesArray),this.filesSubscription.unsubscribe())}handleAmountFocus(){this.bankPledgeForm.markAllAsTouched()}pledgeFormControls(t){return console.log(t?.isNew),this.fb.group({pledgeAmountJod:[t?.pledgeAmountJod||"",[c.kI.min(1e-16),c.kI.required]],bankPledgeDate:[t?.bankPledgeDate||(new Date).toISOString().substring(0,10),[c.kI.required]],bankId:[t?.bankId||null,[c.kI.required]],bankPledgeNumber:[t?.bankPledgeNumber||"",[c.kI.required,c.kI.pattern("^[0-9]*$")]],pledgeAttachment:[t?.pledgeAttachment||""],attachment:[t?.attachment||""],currencyId:[9001,[c.kI.required]],isReversed:[(t?.isReversed??t?.isReversed)||!1],isNew:[t?.isNew??(!this.otherData?.reverse||!(+t?.pledgeAmountJod>0))],lineNew:[t?.lineNew??(!this.otherData?.reverse||!(+t?.pledgeAmountJod>0))]})}fileAction(t,n,r){if("view"==r){const i=this._modalService.open(Q.g,{size:"md"});let l=this.pledgeArrControls.at(n).get("isReversed").getRawValue(),s=this.pledgeArrControls.at(n).get("isNew").getRawValue();if(this.otherData?.reverse&&!1!==l)(null===l||l)&&(i.componentInstance.imageUploadedView={viewOnly:!0,url:this.filesArray[n]});else{let u=this.filesArray[n];i.componentInstance.imageUploadedView=s?u:{viewOnly:!0,url:u}}}else{if(this.otherData?.reverse&&!this.pledgeArrControls.at(n).get("isNew").getRawValue())return;this.filesArray.splice(n,1,{});let i=this.inputRefList.toArray()[n];this.bankPledgeForm.get("pledgeArray").at(n).get("attachment")?.setValue(""),this.bankPledgeForm.get("pledgeArray").at(n).get("pledgeAttachment")?.setValue(""),i.nativeElement.value=null,this.removeFileFromLocalStorage(n)}}removeFileFromLocalStorage(t){let n=localStorage.getItem("bpUploadedFiles");n&&(this.uploadedFiles=[...JSON.parse(n)],this.uploadedFiles.splice(t,1,"noFile"),localStorage.setItem("bpUploadedFiles",JSON.stringify(this.uploadedFiles)))}onFileChange(t,n){let r=[...t.target.files],i=this.bankPledgeForm.get("pledgeArray");r.length>0&&(this.checkInvalidImageFormat(r)||r.forEach(s=>{this.uploadFile(s,n),this._commonService.fileToBase64(s).then(u=>{this.filesArray.splice(n,1,u),i.at(n).get("attachment")?.setValue("Attachment")})}))}uploadFile(t,n){const r=new FormData;r.append("Folder","BankPledge"),r.append("File",t),this._collectService.uploadFile(r).subscribe(i=>{i.isSuccess&&(this.uploadedFiles.splice(n,1,i.data),this.bankPledgeForm.get("pledgeArray").at(n).get("pledgeAttachment")?.setValue(i.data),localStorage.setItem("bpUploadedFiles",JSON.stringify(this.uploadedFiles)))})}checkInvalidImageFormat(t){let n,r=t.map(l=>l.file);n=void 0!==r[0]?r:t;let i=!1;for(let l of n)if(!this.fileTypes.includes(l.type)){i=!0,this.invalidFileType="This file not support, supported formates: JPEG, JPG, PNG, PDF",this.bankPledgeForm.get("attachment")?.patchValue(""),setTimeout(()=>this.invalidFileType="",3e3);break}return i}removeItem(t){this.otherData.refund||(this.filesArray.splice(t,1),this.pledgeArrControls.removeAt(t),this.removeFileFromLocalStorage(t),this.sendAmount())}get pledgeArrControls(){return this.bankPledgeForm?this.bankPledgeForm.get("pledgeArray"):null}handleTabKeyDown(){this.otherData.refund||this.bankPledgeForm.invalid||this.otherData.amountExceeded||this.otherData?.isMultiCollect||this.addNewRow()}addNewRow(){2==this.getDisabledFormGroupCount()&&this.otherData?.reverse&&(this.pledgeArrControls.push(this.pledgeFormControls({isReversed:!1,isNew:!0,lineNew:!0})),this.bankPledgeForm.markAsUntouched())}getDisabledFormGroupCount(){let t=0;return this.pledgeArrControls.controls.forEach(n=>{n.disabled&&t++}),t}handleSubmit(){this.bankPledgeForm.invalid?(this.bankPledgeForm.getRawValue(),this.bankPledgeForm.markAllAsTouched()):(console.log(this.bankPledgeForm.getRawValue()),this.formValueEvent.emit({values:this.bankPledgeForm.getRawValue(),submit:!0}))}get f(){return this.bankPledgeForm.controls}sendAmount(){this.calculateAmount()}calculateAmount(){let t=0;for(let n of this.pledgeArrControls.controls)t+=+n.controls.pledgeAmountJod.getRawValue();this.amountEvent.emit({amount:t})}reverse(t,n){const r=this.pledgeArrControls.at(n),i=this.fb.group({});Object.keys(r.controls).forEach(u=>{const v=I.cloneDeep(r.get(u)?.value);i.addControl(u,new c.NI(v))});let l=-1*r.get("pledgeAmountJod").value;i.patchValue({pledgeAmountJod:l,isReversed:!0,lineNew:!0}),r.get("isReversed").setValue(!0),r.get("lineNew").setValue(!1),this.pledgeArrControls.insert(n+1,i),this.filesArray.splice(n+1,0,this.filesArray[n]),this.pledgeArrControls.at(n).disable(),this.pledgeArrControls.at(n+1).disable(),this.sendAmount()}resetForm(){this.bankPledgeForm.reset(),this.bankPledgeForm.markAsUntouched(),this.formValueEvent.emit({values:this.bankPledgeForm.getRawValue(),touched:!1,reset:!0}),this.amountEvent.emit({amount:0})}closeModal(){this._activeModal?this._activeModal.close():this._commonService.NavigateToRoute(`/${this.otherData?.redirectRoute}`)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.qu),e.Y36(f.FF),e.Y36(f.Kz,8),e.Y36(F.v),e.Y36(D._),e.Y36(C.k))},o.\u0275cmp=e.Xpm({type:o,selectors:[["bankPledge"]],viewQuery:function(t,n){if(1&t&&(e.Gf(G,5),e.Gf(G,5)),2&t){let r;e.iGM(r=e.CRH())&&(n.inputRef=r.first),e.iGM(r=e.CRH())&&(n.inputRefList=r)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown.tab",function(i){return n.onKeydownHandler(i)},!1,e.evT)},inputs:{banks:"banks",currencies:"currencies",otherData:"otherData",recentFormValues:"recentFormValues",isPending:"isPending"},outputs:{amountEvent:"amountEvent",formValueEvent:"formValueEvent"},decls:37,vars:8,consts:[[1,"tab-item"],[1,"row"],[3,"formGroup","submit"],[1,"col-md-12"],[1,"card-table"],[1,""],[1,"table"],["width","15%"],["width","20%"],["formArrayName","pledgeArray",4,"ngFor","ngForOf"],["class","col-md-12 d-flex mt-2",4,"ngIf"],["class","col-12 mb-4",4,"ngIf"],[1,"btns-group","my-2","me-0"],["type","button",1,"btn","btn-cancel",3,"disabled","click"],["type","submit",1,"btn","btn-save",3,"disabled"],["class","fa-solid fa-circle-notch fa-spin",4,"ngIf"],["formArrayName","pledgeArray"],[3,"formGroupName"],[1,"form-group"],["type","number","placeholder","Amount","formControlName","pledgeAmountJod","appDecimalNumber","",1,"form-control",3,"change","input"],[4,"ngIf"],[1,"ngselect-curruncy","form-group"],["placeholder","Currency","bindLabel","name","bindValue","lookupId","formControlName","currencyId",3,"items"],["type","date","formControlName","bankPledgeDate",1,"form-control"],["id","bankId","placeholder"," Select Bank ","bindLabel","name","bindValue","id","formControlName","bankId",3,"items"],["type","text","formControlName","bankPledgeNumber",1,"form-control"],[1,"custom-file","align-items-center"],["type","file","class","file-input__input",3,"id","change",4,"ngIf"],[1,"file-input__label"],["reverseCase",""],["class","error",4,"ngIf"],[1,"error"],["type","file",1,"file-input__input",3,"id","change"],["height","20","src","assets/images/eye.png",1,"cursor-pointer",3,"click"],["height","20","src","assets/images/trash.png",1,"cursor-pointer",3,"click"],[4,"ngIf","ngIfElse"],["src","assets/images/trash.png","alt","",1,"cursor-pointer",2,"width","25px",3,"click"],["reverseTemp",""],[1,"cursor-pointer","green-clr","fas","fa-rotate-left","font-20",3,"click"],[1,"col-md-12","d-flex","mt-2"],[1,"blue-clr","d-flex","align-items-center","fw-500","gap-1"],[1,"fa-solid","fa-circle-plus","primary-clr","fa-2x"],[1,"col-12","mb-4"],[1,"input-label"],[1,"form-control",3,"change"],[1,"fa-solid","fa-circle-notch","fa-spin"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"form",2),e.NdJ("submit",function(){return n.handleSubmit()}),e.TgZ(3,"div",1)(4,"div",3)(5,"div",4)(6,"div",5)(7,"table",6)(8,"thead")(9,"tr")(10,"th"),e._uU(11,"Pledge Amount*"),e.qZA(),e.TgZ(12,"th"),e._uU(13,"Currency*"),e.qZA(),e.TgZ(14,"th"),e._uU(15,"Bank Pledge Date*"),e.qZA(),e.TgZ(16,"th"),e._uU(17,"Bank Name*"),e.qZA(),e.TgZ(18,"th",7),e._uU(19,"Bank Pledge"),e._UZ(20,"br"),e._uU(21," Number*"),e.qZA(),e.TgZ(22,"th",8),e._uU(23,"Pledge Attachment"),e.qZA(),e.TgZ(24,"th"),e._uU(25,"Action"),e.qZA()()(),e.TgZ(26,"tbody"),e.YNc(27,Jo,33,18,"ng-container",9),e.qZA()()()(),e.YNc(28,Vo,4,0,"div",10),e.qZA()(),e.YNc(29,Oo,4,0,"div",11),e.TgZ(30,"div",3)(31,"div",12)(32,"button",13),e.NdJ("click",function(){return n.closeModal()}),e._uU(33,"Cancel"),e.qZA(),e.TgZ(34,"button",14),e._uU(35),e.YNc(36,So,1,0,"i",15),e.qZA()()()()()()),2&t&&(e.xp6(2),e.Q6J("formGroup",n.bankPledgeForm),e.xp6(25),e.Q6J("ngForOf",null==n.pledgeArrControls?null:n.pledgeArrControls.controls),e.xp6(1),e.Q6J("ngIf",null==n.otherData?null:n.otherData.reverse),e.xp6(1),e.Q6J("ngIf",7001==n.otherData.collectionType||7004==n.otherData.collectionType||7005==n.otherData.collectionType||7008==n.otherData.collectionType||7009==n.otherData.collectionType||7002==n.otherData.collectionType&&n.otherData.refund),e.xp6(3),e.Q6J("disabled",n.colllectedViaMachine),e.xp6(2),e.Q6J("disabled",n.isPending),e.xp6(1),e.hij(" ",n.isPending?"Saving":"Confirm"," "),e.xp6(1),e.Q6J("ngIf",n.isPending))},dependencies:[m.sg,m.O5,c._Y,c.Fj,c.wV,c.JJ,c.JL,c.sg,c.u,c.x0,c.CE,x.w9,h.Q],styles:[".form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;margin-bottom:7px}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:46px}.form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:red;font-weight:500;font-size:14px}  .ng-dropdown-panel{z-index:9999999!important}.card-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 0 10px 15px!important}.card-table[_ngcontent-%COMP%]{overflow:visible}.card-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:500}.form-check-input[_ngcontent-%COMP%]{width:20px!important;height:20px}.custom-file[_ngcontent-%COMP%]{border:1px solid #dadada;display:flex;height:46px;border-radius:.375rem;justify-content:center;gap:5px;background:#fff}.file-input__input[_ngcontent-%COMP%]{width:.1px;height:.1px;opacity:0;overflow:hidden;position:absolute;z-index:-1}.file-input__label[_ngcontent-%COMP%]{cursor:pointer;display:inline-flex;align-items:center;border-radius:4px;font-weight:600;color:var(--gray-500);font-size:14px}"]}),o})();var Ro=_(53823);function Uo(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",2)(1,"label",3),e._uU(2,"Cashier Notes"),e.qZA(),e.TgZ(3,"textarea",4),e.NdJ("ngModelChange",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.cashierNotes=r)}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngModel",t.cashierNotes)}}function Yo(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.confirm())}),e._uU(1,"Confirm"),e.qZA()}}function Bo(o,a){1&o&&e._UZ(0,"saving-loader")}function Eo(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",5)(1,"div",6)(2,"button",7),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.closeModal())}),e._uU(3,"Cancel"),e.qZA(),e.YNc(4,Yo,2,0,"button",8),e.YNc(5,Bo,1,0,"saving-loader",9),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("ngIf",!t.isPending),e.xp6(1),e.Q6J("ngIf",t.isPending)}}let Go=(()=>{class o{constructor(t,n,r,i,l,s){this._activeModal=t,this._modalService=n,this._collectService=r,this._subjectService=i,this._commonService=l,this._spinner=s,this.eventData=new e.vpe,this.cashierNotes=""}ngOnInit(){console.log(this.otherData)}closeModal(){this._activeModal?this._activeModal.close():this._commonService.NavigateToRoute(`/${this.otherData?.redirectRoute}`)}confirm(){if(this._spinner.show(),this.otherData.isMultiCollect)this.isPending=!0,this._collectService.collectionOrderV2MultiCollect({ordersCollection:{orderCollectionType:this.otherData?.collectionType,orderNo:this.otherData?.orderNo},ordersOnAccountCollection:{onAccountCollectionJod:this.otherData?.grandAmount,onAccountPayerName:this.otherData?.customerName}}).subscribe(n=>{this.openSuccessModal(n.isSuccess?"ok":"no",n)},n=>{this.openSuccessModal("no",n)}).add(()=>this._spinner.hide());else{let t=0;7001==this.otherData?.collectionType?t=this.otherData.servicesSalesOrderNo||this.otherData.order?.servicesSalesOrderNo:7003==this.otherData?.collectionType&&(t=this.otherData?.sparePartsSalesOrderOpportunityNo||this.otherData?.order?.sparePartsSalesOrderOpportunityNo),this.isPending=!0,this._collectService.collectionOrderV2({ordersCollection:{orderCollectionType:this.otherData?.collectionType,orderNo:t,isReplace:this.otherData?.isFromReturn,cashierNotes:this.cashierNotes},ordersOnAccountCollection:{onAccountCollectionJod:this.otherData?.grandAmount||this.otherData?.order?.grandAmount,onAccountPayerName:this.otherData?.customer?.customerName}}).subscribe(r=>{r.isSuccess?(this._subjectService.isCollectionPaymentDone.next(!0),this._subjectService.collectedOrder.next({orderId:t}),this.openSuccessModal("ok",r)):this.openSuccessModal("no",r)},r=>{this.openSuccessModal("no",r)}).add(()=>this._spinner.hide())}}openSuccessModal(t,n,r){this.isPending=!1;const i=this._modalService.open(g.Y);if(i.componentInstance.name=t,7001!=this.otherData.collectionType&&7002!=this.otherData.collectionType&&7003!=this.otherData.collectionType||this.otherData.isMultiCollect)i.componentInstance.data=this.otherData.isMultiCollect?{collectionType:this.otherData?.collectionType,isMultiCollect:this.otherData.isMultiCollect}:{collectionType:this.otherData.collectionType,invoices:n.data};else{let l,s,u;10005==n.data.statusObj[0].lookupId?l=n.data?.receipt:10004==n.data.statusObj[0].lookupId&&(l=n.data?.receipt,s=n.data?.invoices,u=n.data?.summaryInvoice),i.componentInstance.data={collectionType:this.otherData.collectionType,status:n.data.statusObj[0].lookupId,invoice:s,receipt:l,summary:u,invoiceType:this.otherData?.invoiceType?.toLowerCase()}}n?n.error?i.componentInstance.errors=n.error.errors:i.componentInstance.response=n:i.componentInstance.errors=r.error.errors||r.error.Errors}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.Kz,8),e.Y36(f.FF),e.Y36(C.k),e.Y36(D._),e.Y36(F.v),e.Y36(A.t2))},o.\u0275cmp=e.Xpm({type:o,selectors:[["on-account"]],inputs:{otherData:"otherData"},outputs:{eventData:"eventData"},decls:2,vars:2,consts:[["class","col-12 mb-4",4,"ngIf"],["class","col-md-12",4,"ngIf"],[1,"col-12","mb-4"],[1,"input-label"],[1,"form-control",3,"ngModel","ngModelChange"],[1,"col-md-12"],[1,"btns-group","my-2","me-0"],["type","button",1,"btn","btn-cancel",3,"click"],["type","submit","class","btn btn-save",3,"click",4,"ngIf"],[4,"ngIf"],["type","submit",1,"btn","btn-save",3,"click"]],template:function(t,n){1&t&&(e.YNc(0,Uo,4,1,"div",0),e.YNc(1,Eo,6,2,"div",1)),2&t&&(e.Q6J("ngIf",7001==n.otherData.collectionType||7004==n.otherData.collectionType||7005==n.otherData.collectionType),e.xp6(1),e.Q6J("ngIf","credit"==(null==n.otherData||null==n.otherData.invoiceType?null:n.otherData.invoiceType.toLowerCase())||"internal"==(null==n.otherData||null==n.otherData.invoiceType?null:n.otherData.invoiceType.toLowerCase())||"tmc"==(null==n.otherData||null==n.otherData.invoiceType?null:n.otherData.invoiceType.toLowerCase())))},dependencies:[m.O5,c.Fj,c.JJ,c.On,Ro.V]}),o})();var O=_(82722),Lo=_(39485);function Ko(o,a){if(1&o&&(e.ynx(0),e.TgZ(1,"div",5)(2,"div",6),e._UZ(3,"i",7),e.qZA(),e.TgZ(4,"h6",8),e._uU(5),e.qZA()(),e.BQk()),2&o){const t=e.oxw();e.xp6(5),e.Oqu(t.message)}}function Ho(o,a){if(1&o&&(e.ynx(0),e.TgZ(1,"div",5)(2,"div",6),e._UZ(3,"i",9),e.qZA(),e.TgZ(4,"h6",8),e._uU(5),e.qZA()(),e.BQk()),2&o){const t=e.oxw();e.xp6(5),e.Oqu(t.message)}}let jo=(()=>{class o{constructor(t,n,r){this.router=t,this.modalService=n,this.activeModal=r,this.eventData=new e.vpe}ngOnInit(){"success"==this.type&&setTimeout(()=>{this.routeName&&this.router.navigateByUrl(this.routeName),this.toLoadData(),this.activeModal.dismiss()},3e3)}toLoadData(){this.eventData.emit()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(Lo.F0),e.Y36(f.FF),e.Y36(f.Kz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-response-modal"]],inputs:{type:"type",message:"message",routeName:"routeName",errors:"errors"},outputs:{eventData:"eventData"},decls:6,vars:2,consts:[["ngbAutoFocus","",1,"p-2","px-3"],[1,"d-flex","justify-content-end"],["type","button","aria-label","Close",1,"btn-close","text-end","font-14",3,"click"],[1,"mb-3"],[4,"ngIf"],[1,"d-flex","align-items-center","gap-2"],[1,"icon"],[1,"fa-regular","fa-circle-check","green-clr"],[1,"m-0"],[1,"fa-regular","fa-circle-xmark","text-danger"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"button",2),e.NdJ("click",function(){return n.activeModal.close("Cross click")}),e.qZA()(),e.TgZ(3,"div",3),e.YNc(4,Ko,6,1,"ng-container",4),e.YNc(5,Ho,6,1,"ng-container",4),e.qZA()()),2&t&&(e.xp6(4),e.Q6J("ngIf","success"==n.type),e.xp6(1),e.Q6J("ngIf","error"==n.type))},dependencies:[m.O5],styles:[".icon[_ngcontent-%COMP%]{height:25px}.icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:25px}"]}),o})();var $o=_(87192);function zo(o,a){if(1&o&&e._uU(0),2&o){const t=a.item;e.hij(" ",(null==t?null:t.machineName)+" - "+(null==t?null:t.machineID)," ")}}function Wo(o,a){if(1&o&&e._uU(0),2&o){const t=a.item;e.hij(" ",(null==t?null:t.machineName)+" - "+(null==t?null:t.machineID)," ")}}const Xo=function(){return{required:"Input is required"}};let er=(()=>{class o{constructor(t){this._activeModal=t,this.eventData=new e.vpe,this.providerMachineID=new c.NI(null,[c.kI.required])}handleConfirmClick(){this.providerMachineID.valid?this.eventData.emit({...this.providerMachineID.value}):this.providerMachineID.markAllAsTouched()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.Kz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-terminal-provider-modal"]],inputs:{data:"data"},outputs:{eventData:"eventData"},decls:17,vars:5,consts:[[1,"modal-header","align-items-center","justify-content-between"],["ngbAutoFocus","",1,"modal-title","font-20","fw-700"],[1,"modal-body"],[1,"row"],[1,"col-12"],[1,"input-label"],["placeholder","Select POS Machine","bindLabel","machineName",3,"items","formControl"],["ng-label-tmp",""],["ng-option-tmp",""],[3,"control","errorMessages"],[1,"modal-footer","mt-3"],["type","button",1,"redBtn",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h4",1),e._uU(2,"Terminal Providers Machine"),e.qZA()(),e.TgZ(3,"div",2)(4,"div",3)(5,"div",4)(6,"label",5),e._uU(7,"Plese select the POS machine through which you want to process the payment."),e.qZA(),e.TgZ(8,"ng-select",6),e.YNc(9,zo,1,1,"ng-template",7),e.YNc(10,Wo,1,1,"ng-template",8),e.qZA(),e._UZ(11,"validation-error",9),e.qZA()()(),e.TgZ(12,"div",10)(13,"button",11),e.NdJ("click",function(){return n._activeModal.close()}),e._uU(14,"Close"),e.qZA(),e.TgZ(15,"button",11),e.NdJ("click",function(){return n.handleConfirmClick()}),e._uU(16,"Confirm"),e.qZA()()),2&t&&(e.xp6(8),e.Q6J("items",null==n.data?null:n.data.providerList)("formControl",n.providerMachineID),e.xp6(3),e.Q6J("control",n.providerMachineID)("errorMessages",e.DdM(4,Xo)))},dependencies:[c.JJ,c.oH,x.w9,x.ir,x.mR,E.L]}),o})();var tr=_(29975);function nr(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.resetForm())}),e._UZ(1,"img",18),e.qZA()}}function or(o,a){1&o&&(e.TgZ(0,"th"),e._uU(1,"Action"),e.qZA())}function rr(o,a){1&o&&(e.TgZ(0,"span",34),e._uU(1,"Input is required"),e.qZA())}function ir(o,a){1&o&&(e.TgZ(0,"span",34),e._uU(1,"Value must be greater than zero"),e.qZA())}function ar(o,a){if(1&o&&(e.ynx(0),e.YNc(1,rr,2,0,"span",33),e.YNc(2,ir,2,0,"span",33),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n,r;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("cardCollectionJod"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t||null==(r=t.get("cardCollectionJod"))?null:r.errors.min)}}function lr(o,a){if(1&o&&(e.ynx(0),e.YNc(1,ar,3,2,"ng-container",9),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("cardCollectionJod"))?null:n.invalid)&&(null==t||null==(n=t.get("cardCollectionJod"))?null:n.touched)||(null==t||null==(n=t.get("cardCollectionJod"))?null:n.dirty))}}function cr(o,a){1&o&&(e.TgZ(0,"span",34),e._uU(1,"Input is required"),e.qZA())}function sr(o,a){if(1&o&&(e.ynx(0),e.YNc(1,cr,2,0,"span",33),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("currencyId"))?null:n.errors.required)}}function ur(o,a){if(1&o&&(e.ynx(0),e.YNc(1,sr,2,1,"ng-container",9),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("currencyId"))?null:n.invalid)&&(null==t||null==(n=t.get("currencyId"))?null:n.touched)||(null==t||null==(n=t.get("currencyId"))?null:n.dirty))}}function mr(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",35),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().$implicit,i=e.oxw();return e.KtG(i.handlePOSMachineClick(r))}),e.qZA(),e.BQk()}}function _r(o,a){1&o&&(e.TgZ(0,"span",34),e._uU(1,"Input is required"),e.qZA())}function dr(o,a){1&o&&(e.TgZ(0,"span",34),e._uU(1,"Input allows min and max 4 digits"),e.qZA())}function pr(o,a){if(1&o&&(e.ynx(0),e.YNc(1,_r,2,0,"span",33),e.YNc(2,dr,2,0,"span",33),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n,r;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("cardLast4Digits"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t||null==(r=t.get("cardLast4Digits"))?null:r.errors.pattern)}}function gr(o,a){if(1&o&&(e.ynx(0),e.YNc(1,pr,3,2,"ng-container",9),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("cardLast4Digits"))?null:n.invalid)&&(null==t||null==(n=t.get("cardLast4Digits"))?null:n.touched)||(null==t||null==(n=t.get("cardLast4Digits"))?null:n.dirty))}}function hr(o,a){1&o&&(e.TgZ(0,"span",34),e._uU(1,"Input is required"),e.qZA())}function fr(o,a){1&o&&(e.TgZ(0,"span",34),e._uU(1,"Input allows only digits"),e.qZA())}function Cr(o,a){if(1&o&&(e.ynx(0),e.YNc(1,hr,2,0,"span",33),e.YNc(2,fr,2,0,"span",33),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n,r;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("machineReceiptNumber"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t||null==(r=t.get("machineReceiptNumber"))?null:r.errors.pattern)}}function vr(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Cr,3,2,"ng-container",9),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("machineReceiptNumber"))?null:n.invalid)&&(null==t||null==(n=t.get("machineReceiptNumber"))?null:n.touched)||(null==t||null==(n=t.get("machineReceiptNumber"))?null:n.dirty))}}function yr(o,a){1&o&&(e.TgZ(0,"span",34),e._uU(1,"Input is required"),e.qZA())}function xr(o,a){if(1&o&&(e.ynx(0),e.YNc(1,yr,2,0,"span",33),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("cardTerminalProviderId"))?null:n.errors.required)}}function Ar(o,a){if(1&o&&(e.ynx(0),e.YNc(1,xr,2,1,"ng-container",9),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("cardTerminalProviderId"))?null:n.invalid)&&(null==t||null==(n=t.get("cardTerminalProviderId"))?null:n.touched)||(null==t||null==(n=t.get("cardTerminalProviderId"))?null:n.dirty))}}function Tr(o,a){1&o&&(e.TgZ(0,"span",34),e._uU(1,"Input is required"),e.qZA())}function br(o,a){1&o&&(e.TgZ(0,"span",34),e._uU(1,"Input allows only alphabets"),e.qZA())}function Ir(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Tr,2,0,"span",33),e.YNc(2,br,2,0,"span",33),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n,r;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("machineID"))?null:n.errors.required),e.xp6(1),e.Q6J("ngIf",null==t||null==(r=t.get("machineID"))?null:r.errors.pattern)}}function kr(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Ir,3,2,"ng-container",9),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("machineID"))?null:n.invalid)&&(null==t||null==(n=t.get("machineID"))?null:n.touched)||(null==t||null==(n=t.get("machineID"))?null:n.dirty))}}function Nr(o,a){1&o&&(e.TgZ(0,"span",34),e._uU(1,"Input is required"),e.qZA())}function Zr(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Nr,2,0,"span",33),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("cardPayerName"))?null:n.errors.required)}}function wr(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Zr,2,1,"ng-container",9),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("cardPayerName"))?null:n.invalid)&&(null==t||null==(n=t.get("cardPayerName"))?null:n.touched)||(null==t||null==(n=t.get("cardPayerName"))?null:n.dirty))}}function qr(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",38),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2).index,i=e.oxw();return e.KtG(i.removeItem(r))}),e.qZA(),e.BQk()}}function Fr(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"img",38),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(3).index,i=e.oxw();return e.KtG(i.removeItem(r))}),e.qZA(),e.BQk()}}function Pr(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"i",40),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(4),i=r.$implicit,l=r.index,s=e.oxw();return e.KtG(s.reverse(i,l))}),e.qZA(),e.BQk()}}function Mr(o,a){if(1&o&&e.YNc(0,Pr,2,0,"ng-container",9),2&o){const t=e.oxw(3).$implicit;e.Q6J("ngIf",!t.get("isReversed").value)}}function Dr(o,a){if(1&o&&(e.YNc(0,Fr,2,0,"ng-container",36),e.YNc(1,Mr,1,1,"ng-template",null,39,e.W1O)),2&o){const t=e.MAs(2),n=e.oxw(2).$implicit;e.Q6J("ngIf",n.get("isNew").value)("ngIfElse",t)}}function Jr(o,a){if(1&o&&(e.TgZ(0,"td"),e.YNc(1,qr,2,0,"ng-container",36),e.YNc(2,Dr,3,2,"ng-template",null,37,e.W1O),e.qZA()),2&o){const t=e.MAs(3),n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.reverse))("ngIfElse",t)}}function Vr(o,a){if(1&o){const t=e.EpF();e.ynx(0,19),e.TgZ(1,"tr",20)(2,"td")(3,"div",21)(4,"input",22),e.NdJ("change",function(){const i=e.CHM(t).index,l=e.oxw();return e.KtG(l.convertCash(i))})("input",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.handleAmountFocus())}),e.qZA(),e.YNc(5,lr,2,1,"ng-container",9),e.qZA()(),e.TgZ(6,"td")(7,"div",23)(8,"ng-select",24),e.NdJ("change",function(r){const l=e.CHM(t).index,s=e.oxw();return e.KtG(s.chooseCurrency(r,l))}),e.qZA(),e.YNc(9,ur,2,1,"ng-container",9),e.qZA()(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td")(13,"div",25),e._uU(14),e.YNc(15,mr,2,0,"ng-container",9),e.qZA()(),e.TgZ(16,"td")(17,"div",21),e._UZ(18,"input",26),e.YNc(19,gr,2,1,"ng-container",9),e.qZA()(),e.TgZ(20,"td")(21,"div",21),e._UZ(22,"input",27),e.YNc(23,vr,2,1,"ng-container",9),e.qZA()(),e.TgZ(24,"td")(25,"div",21),e._UZ(26,"ng-select",28),e.YNc(27,Ar,2,1,"ng-container",9),e.qZA()(),e.TgZ(28,"td")(29,"div",21),e._UZ(30,"input",29),e.YNc(31,kr,2,1,"ng-container",9),e.qZA()(),e.TgZ(32,"td")(33,"div",21),e._UZ(34,"input",30),e.YNc(35,wr,2,1,"ng-container",9),e.qZA()(),e.TgZ(36,"td")(37,"div",31)(38,"input",32),e.NdJ("change",function(r){const l=e.CHM(t).index,s=e.oxw();return e.KtG(s.isSameCustomer(r,l))}),e.qZA()()(),e.YNc(39,Jr,4,2,"td",9),e.qZA(),e.BQk()}if(2&o){const t=a.$implicit,n=a.index,r=e.oxw();let i,l,s,u,v,Z,w,V;e.xp6(1),e.Q6J("formGroupName",n),e.xp6(4),e.Q6J("ngIf",null==t||null==(i=t.get("cardCollectionJod"))?null:i.errors),e.xp6(3),e.Q6J("items",r.currencyList),e.xp6(1),e.Q6J("ngIf",null==(l=t.get("currencyId"))?null:l.errors),e.xp6(2),e.Oqu((null==t||null==(s=t.get("rate"))?null:s.value)||0),e.xp6(3),e.hij(" ",(null==t||null==t.value?null:t.value.vjod)||0," "),e.xp6(1),e.Q6J("ngIf",13013==r.paymentTypeId&&!r.otherData.refund),e.xp6(4),e.Q6J("ngIf",null==t||null==(u=t.get("cardLast4Digits"))?null:u.errors),e.xp6(4),e.Q6J("ngIf",null==t||null==(v=t.get("machineReceiptNumber"))?null:v.errors),e.xp6(3),e.Q6J("items",r.terminals),e.xp6(1),e.Q6J("ngIf",null==t||null==(Z=t.get("cardTerminalProviderId"))?null:Z.errors),e.xp6(4),e.Q6J("ngIf",null==t||null==(w=t.get("machineID"))?null:w.errors),e.xp6(4),e.Q6J("ngIf",null==t||null==(V=t.get("cardPayerName"))?null:V.errors),e.xp6(4),e.Q6J("ngIf",!(null!=r.otherData&&r.otherData.isMultiCollect||r.otherData.refund))}}function Or(o,a){1&o&&(e.TgZ(0,"div",41)(1,"p",42),e._UZ(2,"i",43),e._uU(3,"Press Tab to add payment in another currency "),e.qZA()())}function Sr(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",44)(1,"label",45),e._uU(2,"Cashier Notes"),e.qZA(),e.TgZ(3,"textarea",46),e.NdJ("change",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i._subjectService.cashierNote.next(r.target.value))}),e.qZA()()}}function Qr(o,a){1&o&&e._UZ(0,"i",47)}let Rr=(()=>{class o{onKeydownHandler(){this.handleTabKeyDown()}constructor(t,n,r,i,l,s,u,v){this.collectService=t,this.fb=n,this._activeModal=r,this._commonService=i,this._subjectService=l,this._modalService=s,this._httpService=u,this._sharedService=v,this.destroy$=new R.x,this.terminals=[],this.currencies=[],this.currencyList=[],this.providerMachineList=[],this.subscription=new b.w0,this.isMachineResponse=!1,this.amountEvent=new e.vpe,this.formValueEvent=new e.vpe,this.colllectedViaMachine=!1,this.isMachineFgReset=!1}ngOnInit(){if(this.colllectedViaMachine=JSON.parse(localStorage.getItem("pos_mc")),this.isMachineFgReset=JSON.parse(localStorage.getItem("isMachineFgReset")),this.isMachineResponse=13013!=this.paymentTypeId,this.otherData?.refund&&(this.isMachineResponse=!0),this.currencyList=this.currencies.filter(t=>9001==t.lookupId),13013==this.paymentTypeId&&this.isMachineFgReset&&this.cardArrayControl.clear(),0==this.cardArrayControl.length&&(this.cardArrayControl.push(this.cardControls()),!this.colllectedViaMachine&&13013==this.paymentTypeId)){let t="",n=+this.otherData?.remainingAmountAfterSomeCollection||0;t=n>0&&n||this.otherData?.remainingAmount,this.cardArrayControl.at(0).get("cardCollectionJod").setValue(t),this.convertCash(0),localStorage.setItem("isMachineFgReset",JSON.stringify(!1))}this.form.statusChanges.pipe((0,O.R)(this.destroy$)).subscribe(t=>{let n;n=this.otherData?.reverse?!("VALID"==t||"DISABLED"==t):"VALID"!=t,this.form.markAllAsTouched(),this.formValueEvent.emit({values:this.form.value,touched:n})}),this.otherData?.refund&&this.cardArrayControl.disable({emitEvent:!1}),this.otherData?.reverse&&this.disableReversedItems()}disableReversedItems(){this.cardArrayControl.controls.forEach(t=>{t.get("isNew").value||t.disable()})}ngOnDestroy(){this.subscription.unsubscribe(),this.destroy$.next(),this.destroy$.complete()}cardControls(){return this.fb.group({isChecked:[!0],cardCollectionJod:["",[c.kI.min(1e-16),c.kI.required]],machineReceiptNumber:["",[c.kI.pattern("^[0-9]*$")]],cardTerminalProviderId:[null,[c.kI.required]],machineID:["",[c.kI.required,c.kI.pattern("^[a-zA-Z0-9 ]*$")]],cardPayerName:[localStorage.getItem("pmcn")||"No Customer",7004!=this.otherData.collectionType&&[c.kI.required]],cardLast4Digits:["",[c.kI.required,c.kI.pattern("^[0-9]{4}$")]],paymentCardTypeId:[this.paymentTypeId],currencyId:[9001,[c.kI.required]],rate:[""],vjod:[""],isReversed:[!1],isNew:[!0],lineNew:[!0]})}get cardArrayControl(){return this.form?this.form.get("card"):null}handleTabKeyDown(){this.otherData.refund||this.form.invalid||this.otherData?.amountExceeded||this.otherData?.isMultiCollect||this.addNewRow()}chooseCurrency(t,n){this.form.markAllAsTouched();let r=this.cardArrayControl.at(n).get("vjod"),i=this.cardArrayControl.at(n).get("cardCollectionJod").getRawValue();this.cardArrayControl.at(n).get("rate").setValue(t?.rate),9001==t?.lookupId?r.patchValue((1*i).toFixed(3)):(9002==t?.lookupId||9003==t?.lookupId)&&r.patchValue((i*+t?.rate).toFixed(3)),this.calculateAmount()}convertCash(t){let n=this.cardArrayControl.at(t).get("vjod"),i=(this.cardArrayControl.at(t),this.cardArrayControl.at(t).get("cardCollectionJod").getRawValue()),l=this.cardArrayControl.at(t).get("currencyId").getRawValue();9001==l?n.patchValue((1*i).toFixed(3)):9002==l?n.patchValue((.71*i).toFixed(3)):9003==l&&n.patchValue((.76*i).toFixed(3)),this.calculateAmount()}getTerminalProviderMachine(t){let n=+this._sharedService.getRegister?.registerObj?.id||0;n&&(this._httpService._spinnerService.show(),this._httpService.get(this._httpService.apiUrl.POSMachine.GetTerminalProviderMachine+`?registerId=${n}&status=2001&pageSize=1000`,"admin").pipe((0,O.R)(this.destroy$)).subscribe({next:i=>{if(i.isSuccess)if(this.providerMachineList=i.data,this.providerMachineList?.length)if(1==this.providerMachineList.length)this.handleConfirmCardRequest({...t,...this.providerMachineList[0]});else{const l=this._modalService.open(er,{size:"md",centered:!0});l.componentInstance.data={providerList:this.providerMachineList},l.componentInstance.eventData.pipe((0,O.R)(this.destroy$)).subscribe(s=>{l.close(),this.handleConfirmCardRequest({...t,...s})})}else this.responseModal("error","Their is no POS terminal machine defined for this register.")},error:i=>{this.responseModal("error",i?.error.errors[0].errorMessageEn||i?.error.errors[0].ErrorMessageEn||i?.error?.info)}}).add(()=>{this._httpService._spinnerService.hide()}))}handleConfirmCardRequest(t){this.confirmCreditCardRequest(t).pipe((0,O.R)(this.destroy$)).subscribe({next:n=>{n&&this.sendCreditCardRequest(t).pipe((0,O.R)(this.destroy$)).subscribe({next:r=>{if(r.isSuccess){let i=t?.formGroup,l=r.data;if(1==l?.posRespStatus){let u={cardLast4Digits:l?.posPan.split("*").pop(),machineReceiptNumber:l?.posInvoiceNumber,cardTerminalProviderId:t?.providerName?.providerId,machineID:t?.machineID};i.patchValue(u),this.isMachineResponse=!0,i.disable({emitEvent:!1}),localStorage.setItem("pos_mc","true"),this.colllectedViaMachine=!0,this.responseModal("success",l?.posRespText)}else 0==l?.posRespStatus&&this.responseModal("error",l?.posRespText||l?.webResponseErrorDesc)}},error:r=>{this.responseModal("error",r?.error.errors[0].errorMessageEn||r?.error.errors[0].ErrorMessageEn||r?.error?.info)}}).add(()=>{this._httpService._spinnerService.hide()})}})}handlePOSMachineClick(t){if(this.colllectedViaMachine)return;let n=t.get("vjod").value;return+n<=0?void this.responseModal("error","Please enter amount to pay via POS machine."):void this.getTerminalProviderMachine({amount:n,formGroup:t})}sendCreditCardRequest(t){this._httpService._spinnerService.show();const n=new FormData;return n.append("MID",t?.machineID),n.append("TerminalID",t?.terminalID),n.append("SecurityKey",t?.secretKey),n.append("Amount",t?.amount),this._httpService.post(`${this._httpService.apiUrl.POSMachine.SendCreditCardRequest}`,n)}responseModal(t,n){const r=this._modalService.open(jo,{centered:!0});r.componentInstance.type=t,r.componentInstance.message=n}confirmCreditCardRequest(t){const n=this._modalService.open($o.z,{centered:!0});return n.componentInstance.data={headingText:"Confirm Request",body:`Are you sure you want to pay <span class='primary-clr'>${this._httpService._helperService.transformDecimal(t?.amount)} JOD</span> using POS machine?`},n.componentInstance.eventData}addNewRow(){13013!=this.paymentTypeId||1!=this.cardArrayControl.length?(this.cardArrayControl.push(this.cardControls()),this.form.markAsUntouched()):this.responseModal("error","Only one line allowed to pay via POS machine")}removeItem(t){this.colllectedViaMachine&&13013==this.paymentTypeId||this.otherData.refund||(this.cardArrayControl.removeAt(t),this.sendAmount())}handleAmountFocus(){this.form.markAllAsTouched()}sendAmount(){this.calculateAmount()}reverse(t,n){const r=this.cardArrayControl.at(n);if(+r.value.cardCollectionJod<=0)return;r.get("isReversed").setValue(!0),r.get("lineNew").setValue(!1);const i=this.fb.group({});Object.keys(r.controls).forEach(s=>{const u=I.cloneDeep(r.get(s)?.value);i.addControl(s,new c.NI(u))});let l=-1*r.get("vjod").getRawValue();i.patchValue({vjod:l,cardCollectionJod:l,isReversed:!0,lineNew:!0}),this.cardArrayControl.insert(n+1,i),this.cardArrayControl.at(n).disable(),this.cardArrayControl.at(n+1).disable(),this.sendAmount()}calculateAmount(){let t=0;for(let n of this.cardArrayControl.controls)t+=+n.controls.vjod.getRawValue();this.amountEvent.emit({amount:t})}handleSubmit(){this.form.invalid?this.form.markAllAsTouched():this.formValueEvent.emit({submit:!0})}resetForm(){this.colllectedViaMachine&&13013==this.paymentTypeId||(13013==this.paymentTypeId&&localStorage.setItem("isMachineFgReset",JSON.stringify(!0)),this.cardArrayControl.clear(),this.cardArrayControl.push(this.cardControls()),this.form.markAsUntouched(),this.formValueEvent.emit({touched:!1,reset:!0}),this.amountEvent.emit({amount:0}))}isSameCustomer(t,n){let r=this.cardArrayControl.at(n);if(t.target.checked)if(7004==this.otherData.collectionType)r.controls.cardPayerName.setValue("No Customer");else{let i=localStorage.getItem("pmcn");r.controls.cardPayerName.setValue(i)}else r.controls.cardPayerName.setValue("")}closeModal(){this._activeModal?this._activeModal.close():this._commonService.NavigateToRoute(`/${this.otherData?.redirectRoute}`)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.k),e.Y36(c.qu),e.Y36(f.Kz,8),e.Y36(F.v),e.Y36(D._),e.Y36(f.FF),e.Y36(tr.O),e.Y36(q.F))},o.\u0275cmp=e.Xpm({type:o,selectors:[["card-form"]],hostBindings:function(t,n){1&t&&e.NdJ("keydown.tab",function(i){return n.onKeydownHandler(i)},!1,e.evT)},inputs:{form:"form",terminals:"terminals",currencies:"currencies",recentFormValues:"recentFormValues",isPending:"isPending",otherData:"otherData",paymentTypeId:"paymentTypeId"},outputs:{amountEvent:"amountEvent",formValueEvent:"formValueEvent"},decls:46,vars:10,consts:[[1,"tab-item"],[1,"row"],[1,"col-md-12","text-end","my-2"],["type","button","class","btn btn-trash",3,"click",4,"ngIf"],[3,"formGroup","submit"],[1,"col-md-12"],[1,"card-table"],[1,""],[1,"table"],[4,"ngIf"],["formArrayName","card",4,"ngFor","ngForOf"],["class","col-md-12 d-flex mt-2",4,"ngIf"],["class","col-12 mb-4",4,"ngIf"],[1,"btns-group","my-2","me-0"],["type","button",1,"btn","btn-cancel",3,"disabled","click"],["type","submit",1,"btn","btn-save",3,"disabled"],["class","fa-solid fa-circle-notch fa-spin",4,"ngIf"],["type","button",1,"btn","btn-trash",3,"click"],["src","assets/images/reload.png","alt","",2,"width","25px"],["formArrayName","card"],[3,"formGroupName"],[1,"form-group"],["type","number","placeholder","Amount","formControlName","cardCollectionJod","appDecimalNumber","",1,"form-control",3,"change","input"],[1,"ngselect-curruncy","form-group"],["placeholder","Currency","bindLabel","name","bindValue","lookupId","formControlName","currencyId",3,"items","change"],[1,"d-flex","gap-2","align-items-center"],["type","text","placeholder","","formControlName","cardLast4Digits",1,"form-control"],["type","text","placeholder","","formControlName","machineReceiptNumber",1,"form-control"],["id","cardTerminalProviderId","placeholder"," Select Terminal ","bindLabel","name","bindValue","id","formControlName","cardTerminalProviderId",3,"items"],["type","text","formControlName","machineID",1,"form-control"],["type","text","placeholder","","formControlName","cardPayerName","OnlyCharacter","",1,"form-control"],[1,"form-check"],["type","checkbox","formControlName","isChecked",1,"form-check-input",3,"change"],["class","error",4,"ngIf"],[1,"error"],["height","40","src","/assets/images/pos-machine.png",1,"cursor-pointer",3,"click"],[4,"ngIf","ngIfElse"],["reverseCase",""],["src","assets/images/trash.png","alt","",1,"cursor-pointer",2,"width","25px",3,"click"],["reverseTemp",""],[1,"cursor-pointer","green-clr","fas","fa-rotate-left","font-20",3,"click"],[1,"col-md-12","d-flex","mt-2"],[1,"blue-clr","d-flex","align-items-center","fw-500","gap-1"],[1,"fa-solid","fa-circle-plus","primary-clr","fa-2x"],[1,"col-12","mb-4"],[1,"input-label"],[1,"form-control",3,"change"],[1,"fa-solid","fa-circle-notch","fa-spin"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e.YNc(3,nr,2,0,"button",3),e.qZA(),e.TgZ(4,"form",4),e.NdJ("submit",function(){return n.handleSubmit()}),e.TgZ(5,"div",1)(6,"div",5)(7,"div",6)(8,"div",7)(9,"table",8)(10,"thead")(11,"tr")(12,"th"),e._uU(13,"Paid Amount*"),e.qZA(),e.TgZ(14,"th"),e._uU(15,"Currency*"),e.qZA(),e.TgZ(16,"th"),e._uU(17,"Rate"),e.qZA(),e.TgZ(18,"th"),e._uU(19,"Value in JOD"),e.qZA(),e.TgZ(20,"th"),e._uU(21,"Last 4 Card #*"),e.qZA(),e.TgZ(22,"th"),e._uU(23,"Credit Card Machince "),e._UZ(24,"br"),e._uU(25," Recepit No"),e.qZA(),e.TgZ(26,"th"),e._uU(27,"Terminal Provider"),e.qZA(),e.TgZ(28,"th"),e._uU(29,"Merchant ID"),e.qZA(),e.TgZ(30,"th"),e._uU(31,"Payer Name"),e.qZA(),e.TgZ(32,"th"),e._uU(33,"Same Customer"),e.qZA(),e.YNc(34,or,2,0,"th",9),e.qZA()(),e.TgZ(35,"tbody"),e.YNc(36,Vr,40,14,"ng-container",10),e.qZA()()()(),e.YNc(37,Or,4,0,"div",11),e.qZA()(),e.YNc(38,Sr,4,0,"div",12),e.TgZ(39,"div",5)(40,"div",13)(41,"button",14),e.NdJ("click",function(){return n.closeModal()}),e._uU(42,"Cancel"),e.qZA(),e.TgZ(43,"button",15),e._uU(44),e.YNc(45,Qr,1,0,"i",16),e.qZA()()()()()()),2&t&&(e.xp6(3),e.Q6J("ngIf",!n.otherData.reverse&&!n.otherData.refund),e.xp6(1),e.Q6J("formGroup",n.form),e.xp6(30),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.isMultiCollect)),e.xp6(2),e.Q6J("ngForOf",null==n.cardArrayControl?null:n.cardArrayControl.controls),e.xp6(1),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.isMultiCollect||n.otherData.refund)),e.xp6(1),e.Q6J("ngIf",7001==n.otherData.collectionType||7004==n.otherData.collectionType||7005==n.otherData.collectionType||7008==n.otherData.collectionType||7009==n.otherData.collectionType||7002==n.otherData.collectionType&&n.otherData.refund),e.xp6(3),e.Q6J("disabled",n.colllectedViaMachine),e.xp6(2),e.Q6J("disabled",n.isPending||!n.isMachineResponse),e.xp6(1),e.hij(" ",n.isPending?"Saving":"Confirm"," "),e.xp6(1),e.Q6J("ngIf",n.isPending))},dependencies:[m.sg,m.O5,c._Y,c.Fj,c.wV,c.Wl,c.JJ,c.JL,c.sg,c.u,c.x0,c.CE,x.w9,h.Q,k.Q],styles:[".form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;margin-bottom:7px}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:46px}.form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:red;font-weight:500;font-size:14px}  .ng-dropdown-panel{z-index:9999999!important}.card-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 0 10px 15px!important;font-weight:500}.form-check-input[_ngcontent-%COMP%]{width:20px!important;height:20px}.card-table[_ngcontent-%COMP%]{overflow:visible}"]}),o})();var Ur=_(97185);const Yr=["fileInput"];function Br(o,a){1&o&&(e.TgZ(0,"th"),e._uU(1,"Action"),e.qZA())}function Er(o,a){1&o&&e._UZ(0,"i",30)}function Gr(o,a){1&o&&(e.TgZ(0,"span",32),e._uU(1,"Input is required"),e.qZA())}function Lr(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Gr,2,0,"span",31),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("voucherNumber"))?null:n.errors.required)}}function Kr(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Lr,2,1,"ng-container",10),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("voucherNumber"))?null:n.invalid)&&(null==t||null==(n=t.get("voucherNumber"))?null:n.touched)||(null==t||null==(n=t.get("voucherNumber"))?null:n.dirty))}}function Hr(o,a){if(1&o&&(e.TgZ(0,"small",33),e._uU(1),e.ALo(2,"number"),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.hij(" Voucher Amount: ",e.xi3(2,1,null==t.markaziaVoucher?null:t.markaziaVoucher.markaziaVAmount,"2.3-3")," JOD ")}}function jr(o,a){1&o&&(e.TgZ(0,"span",32),e._uU(1,"Input is required"),e.qZA())}function $r(o,a){if(1&o&&(e.ynx(0),e.YNc(1,jr,2,0,"span",31),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("amountJod"))?null:n.errors.required)}}function zr(o,a){if(1&o&&(e.ynx(0),e.YNc(1,$r,2,1,"ng-container",10),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("amountJod"))?null:n.invalid)&&(null==t||null==(n=t.get("amountJod"))?null:n.touched)||(null==t||null==(n=t.get("amountJod"))?null:n.dirty))}}function Wr(o,a){1&o&&(e.TgZ(0,"span",32),e._uU(1,"Input is required"),e.qZA())}function Xr(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Wr,2,0,"span",31),e.BQk()),2&o){const t=e.oxw(2).$implicit;let n;e.xp6(1),e.Q6J("ngIf",null==t||null==(n=t.get("currencyId"))?null:n.errors.required)}}function ei(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Xr,2,1,"ng-container",10),e.BQk()),2&o){const t=e.oxw().$implicit;let n;e.xp6(1),e.Q6J("ngIf",(null==t||null==(n=t.get("currencyId"))?null:n.invalid)&&(null==t||null==(n=t.get("currencyId"))?null:n.touched)||(null==t||null==(n=t.get("currencyId"))?null:n.dirty))}}function ti(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"td")(1,"button",3),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().index,i=e.oxw();return e.KtG(i.removeItem(r))}),e._UZ(2,"img",34),e.qZA()()}}function ni(o,a){if(1&o){const t=e.EpF();e.ynx(0,18),e.TgZ(1,"tr",19)(2,"td")(3,"div",20)(4,"input",21),e.NdJ("change",function(r){const l=e.CHM(t).index,s=e.oxw();return e.KtG(s.handleSearch(r,l))}),e.qZA(),e.YNc(5,Er,1,0,"i",22),e.qZA(),e.YNc(6,Kr,2,1,"ng-container",10),e.qZA(),e.TgZ(7,"td")(8,"input",23),e.NdJ("change",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.sendAmount())})("input",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.handleAmountFocus())}),e.qZA(),e.YNc(9,Hr,3,4,"small",24),e.YNc(10,zr,2,1,"ng-container",10),e.qZA(),e.TgZ(11,"td")(12,"div",25),e._UZ(13,"ng-select",26),e.YNc(14,ei,2,1,"ng-container",10),e.qZA()(),e.TgZ(15,"td"),e._UZ(16,"input",27),e.qZA(),e.TgZ(17,"td"),e._UZ(18,"input",28),e.qZA(),e.TgZ(19,"td"),e._UZ(20,"input",29),e.qZA(),e.YNc(21,ti,3,0,"td",10),e.qZA(),e.BQk()}if(2&o){const t=a.$implicit,n=a.index,r=e.oxw();let i,l,s;e.xp6(1),e.Q6J("formGroupName",n),e.xp6(4),e.Q6J("ngIf",r.isLoading&&r.searchIndex==n),e.xp6(1),e.Q6J("ngIf",null==t||null==(i=t.get("voucherNumber"))?null:i.errors),e.xp6(3),e.Q6J("ngIf",(null==r.markaziaVoucher?null:r.markaziaVoucher.markaziaVAmount)>r.otherData.grandAmount),e.xp6(1),e.Q6J("ngIf",null==t||null==(l=t.get("amountJod"))?null:l.errors),e.xp6(3),e.Q6J("items",r.currencies),e.xp6(1),e.Q6J("ngIf",null==(s=t.get("currencyId"))?null:s.errors),e.xp6(7),e.Q6J("ngIf",!(null!=r.otherData&&r.otherData.isMultiCollect))}}function oi(o,a){1&o&&(e.TgZ(0,"div",35)(1,"p",36),e._UZ(2,"i",37),e._uU(3,"Press Tab to add payment in another currency "),e.qZA()())}function ri(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",38)(1,"label",39),e._uU(2,"Cashier Notes"),e.qZA(),e.TgZ(3,"textarea",40),e.NdJ("change",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i._subjectService.cashierNote.next(r.target.value))}),e.qZA()()}}function ii(o,a){1&o&&e._UZ(0,"i",41)}let ai=(()=>{class o{onKeydownHandler(){this.handleTabKeyDown()}constructor(t,n,r,i,l,s,u,v){this.fb=t,this._modalService=n,this._activeModal=r,this._datePipe=i,this._commonService=l,this._subjectService=s,this._toastr=u,this._vocuherService=v,this.invalidFileType="",this.fileTypes=["image/jpeg","image/jpg","image/png","application/pdf"],this.accounts=[],this.vouchersList=[],this.filesArray=[],this.uploadedFiles=[],this.filesSubscription=new b.w0,this.isLoading=!1,this.amountEvent=new e.vpe,this.formValueEvent=new e.vpe,this.searchSequenceSubject=new R.x,this.searchSequenceSubject.pipe((0,U.b)(1e3)).subscribe(Z=>{this.getMarkaziaVouchers(Z)})}ngOnInit(){console.log(this.otherData),this.initForm(),this.voucherForm.statusChanges.subscribe(t=>{this.voucherForm.markAllAsTouched(),this.formValueEvent.emit({values:this.voucherForm.getRawValue(),touched:"VALID"!=t})})}initForm(){if(this.voucherForm=this.fb.group({voucherArray:this.fb.array([this.initVoucherFormgroup()])}),this.recentFormValues?.voucher?.voucherArray?.length){let t=this.recentFormValues.voucher.voucherArray,n=this.voucherForm.get("voucherArray");n.removeAt(0);for(let r of t)n.push(this.initVoucherFormgroup(r))}}ngOnDestroy(){this.recentFormValues?.voucher?.voucherArray[0]?.amountJod>0&&this.formValueEvent.emit({values:this.voucherForm.getRawValue(),touched:!1})}handleAmountFocus(){this.voucherForm.markAllAsTouched()}initVoucherFormgroup(t){return this.fb.group({voucherSequence:[t?.voucherSequence||""],voucherNumber:[t?.voucherNumber||"",[c.kI.required]],amountJod:[{value:t?.amountJod||"",disabled:!0},[c.kI.required]],currencyId:[{value:9001,disabled:!0}],brand:[{value:t?.brand||"",disabled:!0}],campaign:[{value:t?.campaign||"",disabled:!0}],validityTo:[{value:t?.validityTo||"",disabled:!0}]})}handleSearch(t,n){let r=t.target.value;this.searchIndex=n,r?this.searchSequenceSubject.next(r):this.voucherArray.at(this.searchIndex).reset()}getMarkaziaVouchers(t){this.isLoading=!0,this._vocuherService.getMarkaziaVoucherList(`?pageSize=1000&sequence=${t}`).pipe((0,U.b)(500)).subscribe(r=>{let i=r.data[0];this.markaziaVoucher=i;let l={amountJod:i?.markaziaVAmount,voucherSequence:i?.markaziaVSequence,brand:i?.brand?.brand,campaign:i?.markaziaVCampaign,validityTo:this._datePipe.transform(i?.markaziaVValidityTo,"mediumDate")};i?39001==i.markaziaVStatus?(this.voucherArray.at(this.searchIndex).patchValue(l),l?.amountJod>this.otherData.grandAmount?this.voucherArray.at(this.searchIndex).get("amountJod").enable():(this.voucherArray.at(this.searchIndex).get("amountJod").disable(),this.sendAmount())):(this._toastr.error("Invalid Voucher","Invalid"),this.voucherArray.at(this.searchIndex).reset(),this.sendAmount()):(this.voucherArray.at(this.searchIndex).reset(),this._toastr.error("No voucher found","Not Found"),this.sendAmount())}).add(()=>this.isLoading=!1)}removeItem(t){this.voucherArray.removeAt(t),this.sendAmount()}get voucherArray(){return this.voucherForm?this.voucherForm.get("voucherArray"):null}handleTabKeyDown(){this.voucherForm.invalid||this.otherData.amountExceeded||this.otherData?.isMultiCollect||this.addNewRow()}addNewRow(){this.voucherArray.push(this.initVoucherFormgroup()),this.voucherForm.markAsUntouched()}handleSubmit(){this.voucherForm.invalid?this.voucherForm.markAllAsTouched():this.formValueEvent.emit({values:this.voucherForm.getRawValue(),submit:!0})}get f(){return this.voucherForm.controls}sendAmount(){this.calculateAmount()}calculateAmount(){let t=0;for(let n of this.voucherArray.controls)t+=parseFloat((+n.controls.amountJod.value).toFixed(3));this.amountEvent.emit({amount:t})}resetForm(){this.voucherForm.reset(),this.voucherForm.markAsUntouched(),this.formValueEvent.emit({values:this.voucherForm.getRawValue(),touched:!1,reset:!0}),this.amountEvent.emit({amount:0})}closeModal(){this._activeModal?this._activeModal.close():this._commonService.NavigateToRoute(`/${this.otherData?.redirectRoute}`)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.qu),e.Y36(f.FF),e.Y36(f.Kz,8),e.Y36(m.uU),e.Y36(F.v),e.Y36(D._),e.Y36(Ur._W),e.Y36(B.n))},o.\u0275cmp=e.Xpm({type:o,selectors:[["voucher"]],viewQuery:function(t,n){if(1&t&&e.Gf(Yr,5),2&t){let r;e.iGM(r=e.CRH())&&(n.inputRefList=r)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown.tab",function(i){return n.onKeydownHandler(i)},!1,e.evT)},inputs:{accounts:"accounts",currencies:"currencies",recentFormValues:"recentFormValues",isPending:"isPending",otherData:"otherData"},outputs:{amountEvent:"amountEvent",formValueEvent:"formValueEvent"},decls:37,vars:8,consts:[[1,"tab-item"],[1,"row"],[1,"col-md-12","text-end","my-2"],["type","button",1,"btn","btn-trash",3,"click"],["src","assets/images/reload.png","alt","",2,"width","25px"],[3,"formGroup","submit"],[1,"col-md-12"],[1,"card-table"],[1,""],[1,"table"],[4,"ngIf"],["formArrayName","voucherArray",4,"ngFor","ngForOf"],["class","col-md-12 d-flex mt-2",4,"ngIf"],["class","col-12 mb-4",4,"ngIf"],[1,"btns-group","my-2","me-0"],["type","button",1,"btn","btn-cancel",3,"click"],["type","submit",1,"btn","btn-save",3,"disabled"],["class","fa-solid fa-circle-notch fa-spin",4,"ngIf"],["formArrayName","voucherArray"],[3,"formGroupName"],[1,"position-relative"],["type","text","placeholder","Voucher Sequence","formControlName","voucherNumber",1,"form-control",3,"change"],["class","fa-solid fa-circle-notch fa-spin fa-2x primary-clr search-loader",4,"ngIf"],["type","number","placeholder","Amount","formControlName","amountJod","appDecimalNumber","",1,"form-control",3,"change","input"],["class","primary-clr d-block",4,"ngIf"],[1,"ngselect-curruncy","form-group"],["placeholder","Currency","bindLabel","name","bindValue","lookupId","formControlName","currencyId",3,"items"],["type","text","placeholder","Validiy To","formControlName","validityTo",1,"form-control"],["type","text","placeholder","Brand","formControlName","brand",1,"form-control"],["type","text","placeholder","Campaign","formControlName","campaign",1,"form-control"],[1,"fa-solid","fa-circle-notch","fa-spin","fa-2x","primary-clr","search-loader"],["class","error",4,"ngIf"],[1,"error"],[1,"primary-clr","d-block"],["src","assets/images/trash.png","alt","",2,"width","25px"],[1,"col-md-12","d-flex","mt-2"],[1,"blue-clr","d-flex","align-items-center","fw-500","gap-1"],[1,"fa-solid","fa-circle-plus","primary-clr","fa-2x"],[1,"col-12","mb-4"],[1,"input-label"],[1,"form-control",3,"change"],[1,"fa-solid","fa-circle-notch","fa-spin"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),e.NdJ("click",function(){return n.resetForm()}),e._UZ(4,"img",4),e.qZA()(),e.TgZ(5,"form",5),e.NdJ("submit",function(){return n.handleSubmit()}),e.TgZ(6,"div",1)(7,"div",6)(8,"div",7)(9,"div",8)(10,"table",9)(11,"thead")(12,"tr")(13,"th"),e._uU(14,"Voucher Sequence*"),e.qZA(),e.TgZ(15,"th"),e._uU(16,"Amount"),e.qZA(),e.TgZ(17,"th"),e._uU(18,"Currency"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"Validity To"),e.qZA(),e.TgZ(21,"th"),e._uU(22,"Brand"),e.qZA(),e.TgZ(23,"th"),e._uU(24,"Campaign"),e.qZA(),e.YNc(25,Br,2,0,"th",10),e.qZA()(),e.TgZ(26,"tbody"),e.YNc(27,ni,22,8,"ng-container",11),e.qZA()()()(),e.YNc(28,oi,4,0,"div",12),e.qZA()(),e.YNc(29,ri,4,0,"div",13),e.TgZ(30,"div",6)(31,"div",14)(32,"button",15),e.NdJ("click",function(){return n.closeModal()}),e._uU(33,"Cancel"),e.qZA(),e.TgZ(34,"button",16),e._uU(35),e.YNc(36,ii,1,0,"i",17),e.qZA()()()()()()),2&t&&(e.xp6(5),e.Q6J("formGroup",n.voucherForm),e.xp6(20),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.isMultiCollect)),e.xp6(2),e.Q6J("ngForOf",null==n.voucherArray?null:n.voucherArray.controls),e.xp6(1),e.Q6J("ngIf",!(null!=n.otherData&&n.otherData.isMultiCollect)),e.xp6(1),e.Q6J("ngIf",7001==n.otherData.collectionType||7004==n.otherData.collectionType||7005==n.otherData.collectionType||7008==n.otherData.collectionType||7009==n.otherData.collectionType),e.xp6(5),e.Q6J("disabled",n.isPending),e.xp6(1),e.hij(" ",n.isPending?"Saving":"Confirm"," "),e.xp6(1),e.Q6J("ngIf",n.isPending))},dependencies:[m.sg,m.O5,c._Y,c.Fj,c.wV,c.JJ,c.JL,c.sg,c.u,c.x0,c.CE,x.w9,h.Q,m.JJ],styles:[".ng-dropdown-panel{z-index:9999999!important}.card-table[_ngcontent-%COMP%]{overflow:visible}label[_ngcontent-%COMP%]{font-weight:600;margin-bottom:7px}.form-control[_ngcontent-%COMP%]{height:46px}.error[_ngcontent-%COMP%]{color:red;font-weight:500;font-size:14px}.search-loader[_ngcontent-%COMP%]{position:absolute;right:10px;top:10px}.card-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 0 10px 15px!important;font-weight:500}"]}),o})();function li(o,a){if(1&o&&(e.TgZ(0,"div",10)(1,"h3"),e._uU(2," Customer name "),e.qZA(),e.TgZ(3,"p"),e._uU(4),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.hij(" ",(null==t.detailsItem||null==t.detailsItem.customer?null:t.detailsItem.customer.customerName)||(null==t.detailsItem?null:t.detailsItem.customerName)," ")}}function ci(o,a){1&o&&(e.TgZ(0,"div",10)(1,"h3",11),e._uU(2," Collection "),e.qZA()())}function si(o,a){if(1&o&&(e.TgZ(0,"span",22),e._uU(1),e.ALo(2,"number"),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.hij(" Minimum Payment: ",e.xi3(2,1,(null==t.detailsItem?null:t.detailsItem.minAmount)||(null==t.details||null==t.details.order?null:t.details.order.minAmount)||0,"2.3-3")," JOD ")}}function ui(o,a){if(1&o&&(e.TgZ(0,"div",23)(1,"p",24),e._uU(2),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.remainingAmountMessage)}}function mi(o,a){if(1&o&&(e.TgZ(0,"div",12)(1,"div",1)(2,"div",13)(3,"div",14)(4,"div",15)(5,"div",16)(6,"p"),e._uU(7," Grand Amount"),e.qZA(),e.TgZ(8,"div",17),e._uU(9),e.ALo(10,"number"),e.qZA()(),e.YNc(11,si,3,4,"span",18),e.qZA()()(),e.TgZ(12,"div",13)(13,"div",19)(14,"p"),e._uU(15,"Remaining Amount"),e.qZA(),e.TgZ(16,"div",20),e._uU(17),e.ALo(18,"number"),e.qZA()()(),e.YNc(19,ui,3,1,"div",21),e.qZA()()),2&o){const t=e.oxw();e.xp6(9),e.hij(" ",e.xi3(10,4,t.grandAmount,"2.3-3")," JOD "),e.xp6(2),e.Q6J("ngIf",7001==t.collectionType||7002==t.collectionType||7003==t.collectionType),e.xp6(6),e.hij(" ",e.xi3(18,7,t.remainingAmount-t.paymentSum,"2.3-3")," JOD "),e.xp6(2),e.Q6J("ngIf",t.remainingAmountMessage)}}function _i(o,a){if(1&o&&(e.TgZ(0,"div",29)(1,"p",24),e._uU(2),e.qZA()()),2&o){const t=e.oxw(3);e.xp6(2),e.Oqu(t.remainingAmountMessage)}}function di(o,a){if(1&o&&(e.ynx(0),e.TgZ(1,"div",27)(2,"div",19)(3,"p"),e._uU(4,"Remaining Amount"),e.qZA(),e.TgZ(5,"div",20),e._uU(6),e.ALo(7,"number"),e.qZA()(),e.YNc(8,_i,3,1,"div",28),e.qZA(),e.BQk()),2&o){const t=e.oxw(2);e.xp6(6),e.hij(" ",e.xi3(7,2,t.remainingAmount-t.paymentSum,"2.3-3")," JOD "),e.xp6(2),e.Q6J("ngIf",t.remainingAmountMessage)}}function pi(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",25)(1,"otherRevenueForm",26),e.NdJ("calcRevenueRemainingAmount",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.calcRemainingAmount(r))}),e.qZA(),e.YNc(2,di,9,5,"ng-container",8),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("data",t.otherRevenueData),e.xp6(1),e.Q6J("ngIf",!t.noTotalAmountFromOrAndCp)}}function gi(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",37)(2,"button",38),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().$implicit,i=e.oxw(3);return e.KtG(i.chooseTab(null==r?null:r.paymentTypeId,null==r?null:r.cat))}),e.TgZ(3,"div",39),e._UZ(4,"img",40),e.qZA(),e.TgZ(5,"h5"),e._uU(6),e.qZA()(),e.TgZ(7,"h6"),e._uU(8),e.ALo(9,"number"),e.qZA()(),e.BQk()}if(2&o){const t=e.oxw().$implicit,n=e.oxw(3);e.xp6(2),e.ekj("active",n.selected==(null==t?null:t.paymentTypeId)),e.xp6(2),e.Q6J("src",null==t?null:t.paymentTypeImage,e.LSH),e.uIk("alt",null==t?null:t.paymentTypeImage),e.xp6(2),e.Oqu(null==t||null==t.translations[0]?null:t.translations[0].lookupName),e.xp6(2),e.Oqu(e.xi3(9,6,null==t?null:t.currentAmount,"2.3-3"))}}function hi(o,a){if(1&o&&(e.ynx(0),e.YNc(1,gi,10,9,"ng-container",8),e.BQk()),2&o){const t=a.$implicit;e.xp6(1),e.Q6J("ngIf",null==t?null:t.show)}}function fi(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"paymentCashForm",41,42),e.NdJ("amountEvent",function(r){e.CHM(t);const i=e.oxw(3);return e.KtG(i.getAmount(r,"cash"))})("formValueEvent",function(r){e.CHM(t);const i=e.oxw(3);return e.KtG(i.getFormValue(r,"cash"))}),e.qZA()}if(2&o){const t=e.oxw(3);e.Q6J("otherData",t.otherData)("isPending",t.isPending)("currencies",t.registerCurrencies)("recentFormValues",t.paymentFormsValue)}}function Ci(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"paymentChequeForm",43),e.NdJ("amountEvent",function(r){e.CHM(t);const i=e.oxw(3);return e.KtG(i.getAmount(r,"cheque"))})("formValueEvent",function(r){e.CHM(t);const i=e.oxw(3);return e.KtG(i.getFormValue(r,"cheque"))}),e.qZA()}if(2&o){const t=e.oxw(3);e.Q6J("otherData",t.otherData)("banks",t.banks)("isPending",t.isPending)("currencies",t.registerCurrencies)("recentFormValues",t.paymentFormsValue)}}function vi(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"card-form",45),e.NdJ("amountEvent",function(r){e.CHM(t);const i=e.oxw().index,l=e.oxw(3);return e.KtG(l.getAmount(r,"card",l.cardsList[i].paymentTypeId))})("formValueEvent",function(r){e.CHM(t);const i=e.oxw(4);return e.KtG(i.getFormValue(r,"card"))}),e.qZA()}if(2&o){const t=e.oxw(),n=t.$implicit,r=t.index,i=e.oxw(3);e.Q6J("form",n)("currencies",i.registerCurrencies)("isPending",i.isPending)("otherData",i.otherData)("terminals",i.terminals)("paymentTypeId",i.cardsList[r].paymentTypeId)}}function yi(o,a){if(1&o&&(e.ynx(0),e.YNc(1,vi,1,6,"card-form",44),e.BQk()),2&o){const t=a.index,n=e.oxw(3);e.xp6(1),e.Q6J("ngIf",n.selected==n.cardsList[t].paymentTypeId)}}function xi(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"bankTransfer",41),e.NdJ("amountEvent",function(r){e.CHM(t);const i=e.oxw(3);return e.KtG(i.getAmount(r,"bankTransfer"))})("formValueEvent",function(r){e.CHM(t);const i=e.oxw(3);return e.KtG(i.getFormValue(r,"bankTransfer"))}),e.qZA()}if(2&o){const t=e.oxw(3);e.Q6J("otherData",t.otherData)("isPending",t.isPending)("currencies",t.jodCurrencyOnly)("recentFormValues",t.paymentFormsValue)}}function Ai(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"bankPledge",43),e.NdJ("amountEvent",function(r){e.CHM(t);const i=e.oxw(3);return e.KtG(i.getAmount(r,"bankPledge"))})("formValueEvent",function(r){e.CHM(t);const i=e.oxw(3);return e.KtG(i.getFormValue(r,"bankPledge"))}),e.qZA()}if(2&o){const t=e.oxw(3);e.Q6J("otherData",t.otherData)("banks",t.banks)("isPending",t.isPending)("currencies",t.jodCurrencyOnly)("recentFormValues",t.paymentFormsValue)}}function Ti(o,a){if(1&o&&e._UZ(0,"on-account",46),2&o){const t=e.oxw(3);e.Q6J("otherData",t.onAccountData)}}function bi(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"voucher",41),e.NdJ("amountEvent",function(r){e.CHM(t);const i=e.oxw(3);return e.KtG(i.getAmount(r,"voucher"))})("formValueEvent",function(r){e.CHM(t);const i=e.oxw(3);return e.KtG(i.getFormValue(r,"voucher"))}),e.qZA()}if(2&o){const t=e.oxw(3);e.Q6J("otherData",t.otherData)("isPending",t.isPending)("currencies",t.jodCurrencyOnly)("recentFormValues",t.paymentFormsValue)}}function Ii(o,a){if(1&o&&(e.ynx(0),e.TgZ(1,"div",2)(2,"div",31),e.YNc(3,hi,2,1,"ng-container",32),e.qZA()(),e.TgZ(4,"div",2)(5,"div",33),e.YNc(6,fi,2,4,"paymentCashForm",34),e.YNc(7,Ci,1,5,"paymentChequeForm",35),e.YNc(8,yi,2,1,"ng-container",32),e.YNc(9,xi,1,4,"bankTransfer",34),e.YNc(10,Ai,1,5,"bankPledge",35),e.YNc(11,Ti,1,1,"on-account",36),e.YNc(12,bi,1,4,"voucher",34),e.qZA()(),e.BQk()),2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngForOf",t.paymentTypes),e.xp6(3),e.Q6J("ngIf",t.registerCurrencies&&27001==t.selected),e.xp6(1),e.Q6J("ngIf",t.registerCurrencies&&27002==t.selected),e.xp6(1),e.Q6J("ngForOf",t.formGroups),e.xp6(1),e.Q6J("ngIf",27006==t.selected),e.xp6(1),e.Q6J("ngIf",27005==t.selected),e.xp6(1),e.Q6J("ngIf",27004==t.selected),e.xp6(1),e.Q6J("ngIf",27007==t.selected)}}function ki(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Ii,13,8,"ng-container",30),e.BQk()),2&o){const t=e.oxw(),n=e.MAs(14);e.xp6(1),e.Q6J("ngIf",t.selected>0)("ngIfElse",n)}}function Ni(o,a){1&o&&(e.TgZ(0,"h6",47),e._uU(1,"You have no permissions to collect from this type of order!"),e.qZA())}let Zi=(()=>{class o{constructor(t,n,r,i,l,s,u,v,Z){this.collectService=t,this.sharedService=n,this.activeModal=r,this.modalService=i,this._commonService=l,this._decimalPipe=s,this._subjectService=u,this._spinner=v,this.fb=Z,this.selected=0,this.totalCash=0,this.totalCheque=0,this.totalVisa=0,this.totalMaster=0,this.totalExpress=0,this.totalAccount=0,this.totalBankTransfer=0,this.totalPledge=0,this.totalVoucher=0,this.remainingAmount=0,this.grandAmount=0,this.paymentSum=0,this.sparePartInvoiceType="",this.remainingAmountMessage="",this.isCash=!0,this.isBankTransfer=!0,this.isBankPledge=!0,this.paymentTabItem={isCash:!0,isCheque:!1,isVisa:!1,isMaster:!1,isExpress:!1,isAccount:!1,bankTransfer:!1,bankPledge:!1},this.terminals=[],this.banks=[],this.paymentTypes=[],this.cardsList=[],this.cardCollectedAmount=[],this.formGroups=[],this.sendtoLoadData=new e.vpe,this.subscription=new b.w0,this.noTotalAmountFromOrAndCp=!1,this.isReverse=!1,this.isRefund=!1,this.reversedAmount=0,this.totalCollectedAmountByPaymentTypeList=[]}ngOnInit(){this.isReverse=this.detailsItem?.reverse,this.isRefund=this.detailsItem?.refund,(this.isReverse||this.isRefund)&&(this.collectionType=this.detailsItem.collectionType);let t=this._subjectService.cashierNote.subscribe(n=>{this.ordersCollectionForm.get("cashierNotes").setValue(n)});this.subscription.add(t),this.getRegisterDetails(),this.getTerminalProviders(),this.getBanks(),this.getRegisterPaymentTypesForOrders(),this.initForm(),this.sparePartInvoiceType=this.detailsItem?.invoiceType?.toLowerCase(),this.onAccountData={...this.detailsItem,collectionType:this.collectionType},this.otherData={...this.detailsItem,collectionType:this.collectionType},this.otherRevenueData={...this.otherRevenueData,collectionType:this.collectionType},this.detailsItem&&!this.isReverse&&!this.isRefund&&(this.detailsItem.isMultiCollect?(this.sparePartInvoiceType=this.detailsItem.invoiceType,this.grandAmount=this.detailsItem.grandAmount,this.remainingAmount=this.detailsItem.remainingAmount,this.ordersCollectionForm.get("orderNo").setValue(this.detailsItem.orderNo),localStorage.setItem("pmcn",this.detailsItem?.customerName)):(localStorage.setItem("pmcn",this.detailsItem?.customer?.customerName||this.detailsItem?.customerName),7002==this.collectionType?this.GetDirectPaymentSalesOrdersDetails():7001==this.collectionType?this.GetServicesSalesOrderDetails():7003==this.collectionType?this.GetSparePartsSalesOrdersDetails():7006==this.collectionType?this.getBanksUnderTakingSalesOrdersDetails():7007==this.collectionType?this.getInhouseFinancingOrderDetails():7008==this.collectionType?this.getPnOrderDetails():7009==this.collectionType&&this.getTransferFeesOrderDetails())),localStorage.removeItem("pos_mc"),localStorage.removeItem("isMachineFgReset")}handleReverse(){this.grandAmount=this.detailsItem.collectedAmount,this.remainingAmount=this.detailsItem.collectedAmount,this.paymentSum=this.detailsItem.collectedAmount,this.collectedOrderDetails=this.detailsItem.collectedOrderDetails,this.ordersCollectionForm.get("orderNo").setValue(this.detailsItem.orderNo),this.detailsItem.minAmount=0,localStorage.setItem("pmcn",this.detailsItem?.customerName),this.bindCollectedValueToPaymentType(this.collectedOrderDetails?.ordersCashCollections,"cash"),this.bindCollectedValueToPaymentType(this.collectedOrderDetails?.ordersChequeCollection,"cheque"),this.bindCollectedValueToPaymentType(this.collectedOrderDetails?.bankPledge,"bankPledge"),this.bindCollectedValueToPaymentType(this.collectedOrderDetails?.bankTransfere,"bankTransfer"),this.bindCollectedValueToPaymentType(this.collectedOrderDetails?.ordersCardsCollection,"card")}bindCollectedValueToPaymentType(t,n){if(!t?.length)return;const r=i=>i?i.split("/").slice(-3).join("/"):"";if("cash"==n){let i=t.map(u=>({currencyId:u?.currencyId,collectedAmount:u?.collectedAmount,vjod:u?.collectedAmountJOD,sameCustomer:u?.cashPayerName==this.detailsItem.customerName,cashPayerName:u?.cashPayerName,rate:u?.rate,isDisabled:!0}));this.paymentFormsValue={...this.paymentFormsValue,cash:{cashArray:i}};let s=this.sumCollectedAmounts(i,"vjod");this.totalCash=s,this.totalCollectedAmountByPaymentTypeList.push({id:27001,amount:s})}else if("cheque"==n){let i=t.map(u=>({isChecked:u?.chequeDrawerName==this.detailsItem.customerName,chequeCollectionJod:u?.collectedAmount,currencyId:u?.currencyId,chequeNo:u?.chequeNo,chequeDate:new Date(u?.chequeDate),bankId:u?.bankId,chequeDrawerName:u?.chequeDrawerName,chequeImage:r(u?.chequeImage),attachment:u?.chequeImage,financeApprovalAttachment:r(u?.financeApprovalAttachment),tempFinanceAttachment:u?.financeApprovalAttachment,vjod:u?.chequeCollectionJod,rate:u?.rate??""}));this.paymentFormsValue={...this.paymentFormsValue,cheque:{chequeArray:i}};let s=this.sumCollectedAmounts(i,"vjod");this.totalCheque=s,this.totalCollectedAmountByPaymentTypeList.push({id:27002,amount:s})}else if("bankPledge"==n){let i=t.map(u=>({pledgeAmountJod:u?.pledgeAmountJod,bankPledgeDate:this._commonService.transformDate(u?.bankPledgeDate),bankId:u?.bankId,bankPledgeNumber:u?.bankPledgeNumber,pledgeAttachment:r(u?.pledgeAttachment),attachment:u?.pledgeAttachment,currencyId:9001,isNew:!1}));this.paymentFormsValue={...this.paymentFormsValue,bankPledge:{pledgeArray:i}};let s=this.sumCollectedAmounts(i,"pledgeAmountJod");this.totalPledge=s,this.totalCollectedAmountByPaymentTypeList.push({id:27005,amount:s})}else if("bankTransfer"==n){let i=t.map(u=>({sameCustomer:u?.cardPayerName==this.detailsItem.customerName,paidAmountJod:u?.paidAmountJod,transfereDate:this._commonService.transformDate(u?.transfereDate),markaziaBankAccountId:u?.markaziaBankAccountId,transfereReference:u?.transfereReference,transfereAttachment:r(u?.transfereAttachment),attachment:u?.transfereAttachment,cardPayerName:u?.cardPayerName,currencyId:9001}));this.paymentFormsValue={...this.paymentFormsValue,bankTransfer:{bankArray:i}};let s=this.sumCollectedAmounts(i,"paidAmountJod");this.totalBankTransfer=s,this.totalCollectedAmountByPaymentTypeList.push({id:27006,amount:s})}else if("card"==n){this.cardsList.forEach((l,s)=>{t.find(v=>v.paymentCardTypeId==l.paymentTypeId)||t.push({paymentCardTypeId:l.paymentTypeId})}),this.formGroups=[];let i={};t.forEach(l=>{i[l?.paymentCardTypeId]||(i[l?.paymentCardTypeId]={items:[]}),i[l?.paymentCardTypeId].items.push(l)});for(let l in i){const s=this.fb.group({card:this.fb.array([])});let u=s.get("card"),v=i[l]?.items,Z=0;v.forEach((w,V)=>{if(w?.cardCollectionJod>0){let wi=this.fb.group({isChecked:w?.cardPayerName==this.detailsItem.customerName,cardCollectionJod:[w?.cardCollectionJod,[c.kI.min(1e-16),c.kI.required]],machineReceiptNumber:[w?.machineReceiptNumber,[c.kI.pattern("^[0-9]*$")]],cardTerminalProviderId:[w?.cardTerminalProviderId,[c.kI.required]],machineID:[w?.machineID,[c.kI.required,c.kI.pattern("^[a-zA-Z0-9 ]*$")]],cardPayerName:[w?.cardPayerName,[c.kI.required]],cardLast4Digits:[w?.cardLast4Digits,[c.kI.required,c.kI.pattern("^[0-9]{4}$")]],paymentCardTypeId:w?.paymentCardTypeId,currencyId:[w?.currencyId,[c.kI.required]],rate:w?.rate,vjod:w?.cardCollectionJod,isReversed:!1,isNew:!(+w?.cardCollectionJod>0),lineNew:!1});u.push(wi),Z+=+(w?.cardCollectionJod||0),v.length-1==V&&(this.totalCollectedAmountByPaymentTypeList.push({id:w?.paymentCardTypeId,amount:Z}),this.cardCollectedAmount.push({paymentTypeId:w?.paymentCardTypeId,amount:Z}),this.totalVisa+=Z,this.totalVisa=+this.totalVisa.toFixed(3))}}),this.formGroups.push(s)}}}updateCollectedAmountReverse(){this.paymentTypes.forEach(t=>{let n=this.totalCollectedAmountByPaymentTypeList.find(r=>r.id==t.paymentTypeId);n&&(t.currentAmount=n.amount)})}sumCollectedAmounts(t,n){return t.reduce((r,i)=>r+ +i[n],0)}chooseTab(t,n){let r=localStorage.getItem("pos_mc"),i=this.cardCollectedAmount.length&&this.cardCollectedAmount.find(l=>13013==l.paymentTypeId);return i&&+i?.amount>0&&!r?(this.remainingAmountMessage="Complete the payment process via POS machine or reset to collect via other payment methods.",void setTimeout(()=>{this.remainingAmountMessage=""},5e3)):!this.touched&&this.detailsItem?.isMultiCollect&&this.paymentSum>0?(this.remainingAmountMessage="You can collect order using single payment type only.",void setTimeout(()=>{this.remainingAmountMessage=""},5e3)):void(this.noTotalAmountFromOrAndCp||!(this.touched||this.paymentSum>this.remainingAmount)?(this.selected=t,this.remainingAmountMessage="",this.paymentTabItem[t]=!0):this.paymentSum>this.remainingAmount&&(this.remainingAmountMessage="Collected amount exceeds the remaining amount,please correct your payment.",setTimeout(()=>{this.remainingAmountMessage=""},5e3)))}getAmount(t,n,r){if("cash"==n)this.totalCash=t.amount,this.updateCollectedAmount(27001,t.amount);else if("cheque"==n)this.totalCheque=t.amount,this.updateCollectedAmount(27002,t.amount);else if("card"==n){let i=this.cardCollectedAmount.findIndex(s=>s.paymentTypeId==r);i>=0?this.cardCollectedAmount[i].amount=t.amount:this.cardCollectedAmount.push({paymentTypeId:r,amount:t.amount});let l=+(+this.cardCollectedAmount.reduce((s,u)=>s+u.amount,0)).toFixed(3);this.totalVisa=l,this.updateCollectedAmount(r,t.amount)}else"bankTransfer"==n?(this.totalBankTransfer=t.amount,this.updateCollectedAmount(27006,t.amount)):"bankPledge"==n?(this.totalPledge=t.amount,this.updateCollectedAmount(27005,t.amount)):"voucher"==n&&(this.totalVoucher=t.amount,this.updateCollectedAmount(27007,t.amount));this.paymentSum=+(this.totalCash+this.totalCheque+this.totalVisa+this.totalBankTransfer+this.totalPledge+this.totalVoucher).toFixed(3),this.otherData={...this.otherData,remainingAmountAfterSomeCollection:this._decimalPipe.transform(this.remainingAmount-this.paymentSum,"2.3-3")},(this.isReset||7002!=this.collectionType&&this.paymentSum==this.remainingAmount)&&(this.remainingAmountMessage=""),this.otherData=this.paymentSum>this.remainingAmount?{...this.otherData,amountExceeded:!0}:{...this.otherData,amountExceeded:!1},this.noTotalAmountFromOrAndCp&&(this.otherRevenueData={...this.otherRevenueData,totalCollectedAmount:this.paymentSum},this.otherData={...this.otherData,amountExceeded:!1})}updateCollectedAmount(t,n){let r,i;r=this.paymentTypes.findIndex(l=>l.paymentTypeId==t),i=this.paymentTypes[r],i.currentAmount=n,this.paymentTypes.splice(r,1,i)}getFormValue(t,n){let r=t.reset;this.isReset=r,"cash"==n?(r?delete this.paymentFormsValue.cash:this.paymentFormsValue={...this.paymentFormsValue,cash:t.values},this.touched=t.touched||!1):"cheque"==n?(r?delete this.paymentFormsValue.cheque:this.paymentFormsValue={...this.paymentFormsValue,cheque:t.values},this.touched=t.touched||!1):"card"==n?this.touched=t.touched||!1:"bankTransfer"==n?(r?delete this.paymentFormsValue.bankTransfer:this.paymentFormsValue={...this.paymentFormsValue,bankTransfer:t.values},this.touched=t.touched||!1):"bankPledge"==n?(r?delete this.paymentFormsValue.bankPledge:this.paymentFormsValue={...this.paymentFormsValue,bankPledge:t.values},this.touched=t.touched||!1):"voucher"==n&&(r?delete this.paymentFormsValue.voucher:this.paymentFormsValue={...this.paymentFormsValue,voucher:t.values},this.touched=t.touched||!1),t.submit&&(7001!=this.collectionType&&7002!=this.collectionType&&7003!=this.collectionType&&7008!=this.collectionType?(this.remainingAmount==this.paymentSum?this.confirmPaymentModal():this.remainingAmountMessage=this.paymentSum>this.remainingAmount?`Collected amount exceeds the remaining amount (${this._decimalPipe.transform(this.remainingAmount-this.paymentSum,"2.3-3")}) JOD, please correct your payment.`:"Collected amount must be equal to remaining amount",setTimeout(()=>{this.remainingAmountMessage=""},5e3)):(this.paymentSum>this.remainingAmount?this.remainingAmountMessage=`Collected amount exceeds the remaining amount (${this._decimalPipe.transform(this.remainingAmount-this.paymentSum,"2.3-3")}) JOD, please correct your payment.`:this.paymentSum<this.detailsItem?.minAmount?this.remainingAmountMessage=`Minimum ${this.detailsItem.minAmount} is required`:this.paymentSum<this.remainingAmount&&0==this.detailsItem?.minAmount&&7002!=this.collectionType?this.remainingAmountMessage="Collected amount must be equal to remaining amount":this.confirmPaymentModal(),setTimeout(()=>{this.remainingAmountMessage=""},5e3)))}closeModal(){JSON.parse(localStorage.getItem("pos_mc"))||this.activeModal&&this.activeModal.close()}ngOnDestroy(){localStorage.removeItem("pmcn"),localStorage.removeItem("bpUploadedFiles")}initForm(){this.ordersCollectionForm=this.fb.group({orderCollectionType:[this.collectionType],orderNo:0,isReplace:[!1],cashierNotes:[""]}),7008==this.collectionType&&(this.ordersCollectionForm.addControl("pnBoogkNotesIds",new c.NI(this.detailsItem?.pnBookNotesIds||"")),this.ordersCollectionForm.addControl("earlysettlement",new c.NI(this.detailsItem?.earlysettlement)),this.detailsItem?.pnBookNotesIds||this.ordersCollectionForm.addControl("amountToPay",new c.NI(this.detailsItem?.grandAmount)))}getRegisterPaymentTypesForOrders(){this.collectService.getRegisterPaymentTypesForOrders(this.sharedService.getRegister.registerObj?.id,this.collectionType).subscribe(t=>{let n=t.data,r=7002==this.collectionType&&this.detailsItem?.flag?.toLowerCase();if(7002==this.collectionType&&"in-house"==r)this.selected=27002,this.paymentTypes=n.map(i=>({...i,show:27002==i.paymentTypeId}));else{if(this.paymentTypes=n.map(l=>({...l,show:!0})),this.cardsList=this.paymentTypes.filter(l=>2==l.cat),this.cardsList.length>0)for(let l=0;l<this.cardsList.length;l++){const s=this.fb.group({card:this.fb.array([])});this.formGroups.push(s)}!["credit","internal","tmc"].includes(this.sparePartInvoiceType)||7003!=this.collectionType&&7001!=this.collectionType?this.paymentTypes=this.paymentTypes.filter(l=>27004!=l.paymentTypeId):(this.paymentTypes=this.paymentTypes.filter(l=>27004==l.paymentTypeId),this.paymentTypes[0].currentAmount=this.detailsItem?.grandAmount||this.detailsItem?.order?.grandAmount),this.selected=this.paymentTypes[0]?.paymentTypeId}(this.isReverse||this.isRefund)&&(this.handleReverse(),this.updateCollectedAmountReverse())})}getBanks(){this.collectService.getLookupsById(11).subscribe(t=>{this.banks=t.data.map(n=>({id:n.id,name:n.name[0].lookupName}))})}getTerminalProviders(){this.collectService.getTerminalProviders().subscribe(t=>{this.terminals=t.data.map(n=>({id:n.providerId,name:n.providerName}))})}calcRemainingAmount(t){this.noTotalAmountFromOrAndCp=t.noTotalAmount;let n=t.formValue;if(this.noTotalAmountFromOrAndCp&&n?.totalAmount>0&&n?.amount>0)this.remainingAmount=this.paymentSum,this.generateRevenueFormValue(t);else{if(this.noTotalAmountFromOrAndCp)return;this.remainingAmount=+(+t.amount).toFixed(3),this.otherData={...this.otherData,remainingAmount:this.remainingAmount},this.generateRevenueFormValue(t)}}generateRevenueFormValue(t){if(console.log(t),7004==this.collectionType)this.revenueFormValue=t.formValue,this.revenueFormValue={...this.revenueFormValue,totalAmount:(+this.revenueFormValue.totalAmount).toFixed(3),amount:(+this.revenueFormValue.amount).toFixed(3),tax:this.revenueFormValue.tax};else{let n=t.formValue;this.customerPaymentFormValue={...n,customerPaymentCategoryId:n.revenueCategoryId},this.customerPaymentFormValue={...this.customerPaymentFormValue,amount:(+this.customerPaymentFormValue.amount).toFixed(3),totalAmount:(+this.customerPaymentFormValue.totalAmount).toFixed(3)}}}confirmPaymentModal(){const t=this.modalService.open(d,{centered:!0,backdrop:"static"});t.componentInstance.data={collectionType:this.collectionType,reverse:this.isReverse,refund:this.isRefund,remainingAmount:this.remainingAmount-this.paymentSum},t.result.then(n=>{this.isPending=!0,this.collectPayments()},n=>{})}collectPayments(){this._spinner.show();let t=[],n=[];this.formGroups.forEach(l=>{t.push(...l.getRawValue().card)}),this.paymentFormsValue?.cheque?.chequeArray?.length>0&&(this.paymentFormsValue.cheque.chequeArray=[...this.paymentFormsValue.cheque?.chequeArray.map(l=>({...l,chequeNo:l.chequeNo.toString()}))]),this.paymentFormsValue?.bankTransfer?.bankArray?.length>0&&(this.paymentFormsValue.bankTransfer.bankArray=[...this.paymentFormsValue.bankTransfer?.bankArray?.map(l=>({...l,transfereReference:l.transfereReference.toString()}))]),this.paymentFormsValue?.bankPledge?.pledgeAmountJod>0&&(this.paymentFormsValue.bankPledge={...this.paymentFormsValue?.bankPledge,bankPledgeNumber:this.paymentFormsValue?.bankPledge?.bankPledgeNumber.toString()}),t?.length>0&&(t=[...t.filter(s=>s.cardCollectionJod).map(s=>({...s,machineReceiptNumber:s?.machineReceiptNumber?.toString(),cardLast4Digits:s?.cardLast4Digits?.toString()}))]),this.paymentFormsValue?.voucher?.voucherArray?.length>0&&(n=this.paymentFormsValue?.voucher?.voucherArray.map(l=>({amountJod:l.amountJod,voucherNumber:l.voucherSequence})));let i,r={ordersCollection:this.ordersCollectionForm.value,...this.paymentFormsValue?.cash?.cashArray[0].collectedAmount>0&&{ordersCashCollections:this._commonService.roundValue(this.paymentFormsValue?.cash?.cashArray,"collectedAmount")},...this.paymentFormsValue?.cheque?.chequeArray?.length>0&&{ordersChequeCollection:this._commonService.roundValue(this.paymentFormsValue.cheque?.chequeArray,"chequeCollectionJod")},...this.revenueFormValue?.revenueCategoryId>0&&{revenueCollection:this.revenueFormValue},...this.customerPaymentFormValue?.customerId>0&&this.customerPaymentFormValue?.customerPaymentCategoryId>0&&{customerPaymentCollection:this.customerPaymentFormValue},...t?.length&&{ordersCardsCollection:this._commonService.roundValue(t,"cardCollectionJod")},...this.paymentFormsValue?.bankTransfer?.bankArray?.length>0&&{orderBankTransfereCollections:this._commonService.roundValue(this.paymentFormsValue?.bankTransfer?.bankArray,"paidAmountJod")},...this.paymentFormsValue?.voucher?.voucherArray?.length>0&&{markaziaVouchers:n}};if(this.isReverse||this.isRefund){let l=this.paymentFormsValue?.bankPledge?.pledgeArray;l?.length&&(i=this._commonService.roundValue(l,"pledgeAmountJod"),r.ordersBanksPledgeCollectionModel=i)}else{let l=this.paymentFormsValue?.bankPledge?.pledgeArray[0];+l?.pledgeAmountJod>0&&(i=this._commonService.roundValue(l,"pledgeAmountJod"),r.ordersBanksPledgeCollectionModel=i)}if(console.log(r),this.isReverse||this.isRefund){if(this.isReverse){let l;r.ordersCollection.reversedCollectionId=this.detailsItem.orderCollectionId,r.ordersCollection.corrospondingSessionId=this.detailsItem.corrospondingSessionId,l=this.collectService.reverseCollection(r),l.subscribe({next:s=>{s.isSuccess?(this.openSuccessModal("ok",s),this.sendtoLoadData.emit()):this.openSuccessModal("no",s)},error:s=>{this.openSuccessModal("no",s)}}).add(()=>this._spinner.hide())}else if(this.isRefund){let l;r.ordersCollection.reversedCollectionId=this.detailsItem.orderCollectionId;const s=+localStorage.getItem("current_session");r.ordersCollection.corrospondingSessionId=s,l=this.collectService.refundReciptsForAllOrders(r),l.subscribe({next:u=>{u.isSuccess?(this.openSuccessModal("ok",u),this.sendtoLoadData.emit()):this.openSuccessModal("no",u)},error:u=>{this.openSuccessModal("no",u)}}).add(()=>this._spinner.hide())}}else if(7004==this.collectionType)this.collectService.addOtherRevenueOrdersV2(r).subscribe(l=>{if(l.isSuccess){this.isPending=!1;const s=this.modalService.open(g.Y);s.componentInstance.name="ok",s.componentInstance.response=l,s.componentInstance.data={collectionType:this.collectionType},setTimeout(()=>{this.sendtoLoadData.emit()},2e3)}else{this.isPending=!1;const s=this.modalService.open(g.Y);s.componentInstance.name="no",s.componentInstance.errors=l.Errors||l.errors}},l=>{this.isPending=!1;const s=this.modalService.open(g.Y);s.componentInstance.name="no",s.componentInstance.errors=l.error.errors||l.error.Errors}).add(()=>this._spinner.hide());else if(7005==this.collectionType)this.collectService.addCustomerPaymentOrders(r).subscribe(l=>{if(l.isSuccess){this.isPending=!1;const s=this.modalService.open(g.Y);s.componentInstance.name="ok",s.componentInstance.response=l,s.componentInstance.data={collectionType:this.collectionType},setTimeout(()=>{this.sendtoLoadData.emit()},2e3)}else{this.isPending=!1;const s=this.modalService.open(g.Y);s.componentInstance.name="no",s.componentInstance.errors=l.Errors||l.errors}},l=>{this.isPending=!1;const s=this.modalService.open(g.Y);s.componentInstance.name="no",s.componentInstance.errors=l.error.errors||l.error.Errors}).add(()=>this._spinner.hide());else if(7008==this.collectionType)this.collectService.collectionOrderV2PNOrder(r).subscribe(l=>{if(l.isSuccess){this.isPending=!1;const s=this.modalService.open(g.Y);s.componentInstance.data={collectionType:7008},s.componentInstance.name="ok",s.componentInstance.response=l,s.componentInstance.notAutoDismiss=!0,this.sendtoLoadData.emit()}else{this.isPending=!1;const s=this.modalService.open(g.Y);s.componentInstance.name="no",s.componentInstance.errors=l.Errors||l.errors}},l=>{this.isPending=!1;const s=this.modalService.open(g.Y);s.componentInstance.name="no",s.componentInstance.errors=l.error.errors||l.error.Errors}).add(()=>this._spinner.hide());else if(this.detailsItem.isMultiCollect)this.collectService.collectionOrderV2MultiCollect(r).subscribe(l=>{l.isSuccess?(this.paymentSum=0,this.openSuccessModal("ok",l),this.sendtoLoadData.emit()):this.openSuccessModal("no",l)},l=>{this.openSuccessModal("no",l)}).add(()=>this._spinner.hide());else{let l;l=7001==this.collectionType?this.collectService.servicesOrdersCollection(r):this.collectService.collectionOrderV3(r),l.subscribe(s=>{s.isSuccess?(this.paymentSum=0,this.openSuccessModal("ok",s),this.sendtoLoadData.emit()):this.openSuccessModal("no",s)},s=>{this.openSuccessModal("no",s)}).add(()=>this._spinner.hide())}}openSuccessModal(t,n,r){this.isPending=!1;const i=this.modalService.open(g.Y);if(i.componentInstance.name=t,n?.error)i.componentInstance.errors=n.error.errors||n.error.Errors;else{if(7001!=this.collectionType&&7002!=this.collectionType&&7003!=this.collectionType||this.detailsItem.isMultiCollect)i.componentInstance.data=this.detailsItem.isMultiCollect?{collectionType:this.collectionType,isMultiCollect:this.detailsItem.isMultiCollect}:{collectionType:this.collectionType,invoices:n.data,reverse:this.isReverse,refund:this.isRefund};else{let l,s,u;10005==n.data.statusObj[0].lookupId?l=n.data?.receipt:10004==n.data.statusObj[0].lookupId&&(l=n.data?.receipt,s=n.data?.invoices,u=n.data?.summaryInvoice),i.componentInstance.data={collectionType:this.collectionType,status:n.data.statusObj[0].lookupId,invoice:s,receipt:l,summary:u,reverse:this.isReverse,refund:this.isRefund}}n?n.error?i.componentInstance.errors=n.error.errors:i.componentInstance.response=n:i.componentInstance.errors=r.error.errors||r.error.Errors}}GetServicesSalesOrderDetails(){this.detailsItem?.isFromReturn?(this.remainingAmount=this.detailsItem?.grandAmount,this.grandAmount=this.detailsItem?.grandAmount,this.ordersCollectionForm.controls.orderNo.setValue(this.detailsItem?.servicesSalesOrderNo),this.ordersCollectionForm.get("isReplace").setValue(!0)):this.collectService.GetServicesSalesOrderDetails(this.detailsItem.servicesSalesOrderNo||this.detailsItem.order.servicesSalesOrderNo).subscribe(n=>{n&&(this.details=n.data,this.remainingAmount="credit"!==this.sparePartInvoiceType&&"internal"!==this.sparePartInvoiceType?this.details.order.remainingAmount:0,this.grandAmount=this.details.order.grandAmount,this.ordersCollectionForm.controls.orderNo.setValue(this.details.order.servicesSalesOrderNo))})}GetDirectPaymentSalesOrdersDetails(){this.collectService.GetDirectPaymentSalesOrdersDetails(this.detailsItem.directPaymentSalesOrderOpportunityNo||this.detailsItem.order.directPaymentSalesOrderOpportunityNo).subscribe(n=>{n&&(this.details=n.data,this.remainingAmount=this.details.order.remainingAmount,this.grandAmount=this.details.order.grandAmount,this.ordersCollectionForm.controls.orderNo.setValue(this.details.order.directPaymentSalesOrderOpportunityNo))})}GetSparePartsSalesOrdersDetails(){this.detailsItem?.isFromReturn?(this.remainingAmount="credit"!==this.sparePartInvoiceType&&"internal"!==this.sparePartInvoiceType?this.detailsItem?.grandAmount:0,this.grandAmount=this.detailsItem?.grandAmount,this.ordersCollectionForm.controls.orderNo.setValue(this.detailsItem?.sparePartsSalesOrderOpportunityNo),this.ordersCollectionForm.get("isReplace").setValue(!0)):this.collectService.GetSparePartsSalesOrdersDetails(this.detailsItem?.sparePartsSalesOrderOpportunityNo||this.detailsItem?.order?.sparePartsSalesOrderOpportunityNo).subscribe(n=>{n&&(this.details=n.data,this.remainingAmount="credit"!==this.sparePartInvoiceType&&"internal"!==this.sparePartInvoiceType?this.details.remainingAmount:0,this.grandAmount=this.details.order.grandAmount,this.ordersCollectionForm.controls.orderNo.setValue(this.details.order.sparePartsSalesOrderOpportunityNo))})}getBanksUnderTakingSalesOrdersDetails(){const t=this.detailsItem?.order?.banksUnderTakingSalesOrderOpportunityNo||this.detailsItem?.banksUnderTakingSalesOrderOpportunityNo;this.remainingAmount=this.detailsItem?.order?.remainingAmount||this.detailsItem?.remainingAmount,this.grandAmount=this.detailsItem?.order?.grandAmount||this.detailsItem?.grandAmount,this.ordersCollectionForm.controls.orderNo.setValue(t)}getInhouseFinancingOrderDetails(){const t=this.detailsItem?.order?.banksUnderTakingSalesOrderOpportunityNo||this.detailsItem?.inHouceFinancingSalesOrderOpportunityNo;this.remainingAmount=this.detailsItem?.order?.remainingAmount||this.detailsItem?.remainingAmount,this.grandAmount=this.detailsItem?.order?.grandAmount||this.detailsItem?.grandAmount,this.ordersCollectionForm.controls.orderNo.setValue(t)}getTransferFeesOrderDetails(){const t=this.detailsItem?.transferFeesOrderId;this.remainingAmount=this.detailsItem?.feesAmount,this.grandAmount=this.detailsItem?.feesAmount,this.ordersCollectionForm.controls.orderNo.setValue(t)}getPnOrderDetails(){const t=this.detailsItem?.pnOrderId;this.remainingAmount=this.detailsItem?.grandAmount,this.grandAmount=this.detailsItem?.remainingAmount,this.ordersCollectionForm.controls.orderNo.setValue(t)}getRegisterDetails(){return this.collectService.GetRegisterDetails(this.sharedService.getRegister.registerObj?.id).subscribe(t=>{t&&(this.registers=t.data,this.registerCurrencies=this.registers.registerCurrencies.map(n=>({id:n.id,name:n.currency[0].lookupName,lookupId:n.currency[0].lookupId,rate:n?.rate})),this.jodCurrencyOnly=[...this.registerCurrencies.filter(n=>9001==n.lookupId)],this.isCash=this.registers.cash,this.isCheque=this.registers.cheque,this.isVisa=this.registers.visa,this.isMaster=this.registers.mastercard,this.isExpress=this.registers.americanExpress,this.isAccount=this.registers.onCustomerAccount)})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.k),e.Y36(q.F),e.Y36(f.Kz,8),e.Y36(f.FF),e.Y36(F.v),e.Y36(m.JJ),e.Y36(D._),e.Y36(A.t2),e.Y36(c.qu))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-payment-modal"]],inputs:{detailsItem:"detailsItem",multiCollection:"multiCollection",collectionType:"collectionType"},outputs:{sendtoLoadData:"sendtoLoadData"},decls:15,vars:5,consts:[[1,"modal-body"],[1,"row"],[1,"col-md-12"],[1,"d-flex","justify-content-between","align-items-center"],["class","payment-head",4,"ngIf"],[1,"fas","fa-times-circle","primary-clr","cursor-pointer","fa-2x",3,"click"],["class","card-payment",4,"ngIf"],["class","mb-4",4,"ngIf"],[4,"ngIf"],["noPermissionToCollect",""],[1,"payment-head"],[1,"py-2"],[1,"card-payment"],[1,"col-sm-6"],[1,"total-card"],[1,"d-flex","flex-column"],[1,"d-flex","align-items-center","gap-1"],[1,"total"],["class","font-13",4,"ngIf"],[1,"total-card","justify-content-end"],[1,"total2"],["class","col-12",4,"ngIf"],[1,"font-13"],[1,"col-12"],[1,"alert","alert-danger"],[1,"mb-4"],[3,"data","calcRevenueRemainingAmount"],[1,"col-sm-12","card-payment","mt-4"],["class","col-12 mt-3",4,"ngIf"],[1,"col-12","mt-3"],[4,"ngIf","ngIfElse"],[1,"tab-nav"],[4,"ngFor","ngForOf"],[1,"tab-content"],[3,"otherData","isPending","currencies","recentFormValues","amountEvent","formValueEvent",4,"ngIf"],[3,"otherData","banks","isPending","currencies","recentFormValues","amountEvent","formValueEvent",4,"ngIf"],[3,"otherData",4,"ngIf"],[1,"payitem"],["type","button",1,"btn",3,"click"],[1,"imag"],[3,"src"],[3,"otherData","isPending","currencies","recentFormValues","amountEvent","formValueEvent"],["cashComponent",""],[3,"otherData","banks","isPending","currencies","recentFormValues","amountEvent","formValueEvent"],[3,"form","currencies","isPending","otherData","terminals","paymentTypeId","amountEvent","formValueEvent",4,"ngIf"],[3,"form","currencies","isPending","otherData","terminals","paymentTypeId","amountEvent","formValueEvent"],[3,"otherData"],[1,"fw-600","primary-clr"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div"),e.YNc(5,li,5,1,"div",4),e.YNc(6,ci,3,0,"div",4),e.qZA(),e.TgZ(7,"i",5),e.NdJ("click",function(){return n.closeModal()}),e.qZA()(),e._UZ(8,"hr"),e.qZA(),e.TgZ(9,"div",2),e.YNc(10,mi,20,10,"div",6),e.YNc(11,pi,3,2,"div",7),e.qZA(),e.YNc(12,ki,2,2,"ng-container",8),e.qZA()(),e.YNc(13,Ni,2,0,"ng-template",null,9,e.W1O)),2&t&&(e.xp6(5),e.Q6J("ngIf",n.detailsItem),e.xp6(1),e.Q6J("ngIf",!n.detailsItem),e.xp6(4),e.Q6J("ngIf",n.detailsItem),e.xp6(1),e.Q6J("ngIf",!n.detailsItem),e.xp6(1),e.Q6J("ngIf",n.remainingAmount>0||n.isReverse||n.isRefund||n.noTotalAmountFromOrAndCp||("credit"==n.sparePartInvoiceType||"internal"==n.sparePartInvoiceType)&&(7003==n.collectionType||7001==n.collectionType)))},dependencies:[m.sg,m.O5,_e,at,vn,io,Qo,Go,Rr,ai,m.JJ],styles:[".modal-body[_ngcontent-%COMP%]{padding:20px 25px}.payment-head[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:600;font-size:18px;color:#1b212d;margin:0}.payment-head[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-weight:600;font-size:16px;color:#929eae;margin-bottom:10px}.card-payment[_ngcontent-%COMP%]{margin:5px 0}.card-payment[_ngcontent-%COMP%]   .total-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px;margin:5px 0}.card-payment[_ngcontent-%COMP%]   .total-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#000;margin:0}.card-payment[_ngcontent-%COMP%]   .total-card[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]{background-color:#f8f8f8;font-size:14px;font-weight:600;padding:10px 30px;display:block;border-radius:9px}.card-payment[_ngcontent-%COMP%]   .total-card[_ngcontent-%COMP%]   .total2[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ccc;font-size:14px;font-weight:600;padding:10px 30px;display:block;border-radius:9px}.paytitle[_ngcontent-%COMP%]{font-weight:700;font-size:18px;line-height:20px;color:#1b212d;margin-bottom:10px}.tab-nav[_ngcontent-%COMP%]{display:flex}.tab-nav[_ngcontent-%COMP%]   .payitem[_ngcontent-%COMP%]{text-align:center;margin-bottom:0;width:16.666%;padding:5px}.tab-nav[_ngcontent-%COMP%]   .payitem[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-weight:600;font-size:18px;line-height:22px;text-align:center;color:#000;padding:15px 5px 5px;margin:0}.tab-nav[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{background:#ffffff;border:1px solid #d1d1d1;border-radius:15px;height:140px;width:100%;padding:3px}.tab-nav[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   .imag[_ngcontent-%COMP%]{width:70px;height:60px;display:flex;margin:0 auto;justify-content:center;align-items:center;background:#fff}.tab-nav[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.tab-nav[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-weight:600;font-size:16px;color:#929eae;padding:15px 5px;margin:0}.tab-nav[_ngcontent-%COMP%]   .btn.active[_ngcontent-%COMP%]{background:#ffffff;border:1px solid #dc3545;box-shadow:0 10px 20px #0000001a;border-radius:15px}.tab-nav[_ngcontent-%COMP%]   .btn.active[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{color:#000}.card-form[_ngcontent-%COMP%]{background:#ffffff;border:0px solid #c4cdd5;box-shadow:none;border-radius:8px;margin:0;padding:0}.card-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:15px}.card-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:16px}.form-check[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:16px;font-weight:500}.btn-trash[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:25px}.btn-push[_ngcontent-%COMP%]{font-size:16px;font-weight:500;padding:0}.btn-push[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#dc3545;font-size:24px;vertical-align:bottom;margin-inline-end:5px}.convert[_ngcontent-%COMP%]{font-size:12px;padding:5px}.btnacount.disabled[_ngcontent-%COMP%], .btnacount[_ngcontent-%COMP%]:disabled{background-color:#eee!important}"]}),o})()},32298:(J,M,_)=>{_.d(M,{g:()=>D});var e=_(94650),c=_(42953),g=_(11481),f=_(36895);function m(A,I){if(1&A&&(e.ynx(0),e._UZ(1,"img",6),e.BQk()),2&A){const y=e.oxw(2);e.xp6(1),e.Q6J("src",null==y.imageUploadedView?null:y.imageUploadedView.base64,e.LSH)}}function T(A,I){if(1&A&&(e.TgZ(0,"div",7),e._UZ(1,"img",8)(2,"br"),e.TgZ(3,"a",9),e._uU(4,"click to open pdf "),e.qZA()()),2&A){const y=e.oxw(2);e.xp6(3),e.Q6J("href",y.viewPdf(null==y.imageUploadedView?null:y.imageUploadedView.file),e.LSH)}}function d(A,I){if(1&A){const y=e.EpF();e.ynx(0),e.TgZ(1,"div",2),e.YNc(2,m,2,1,"ng-container",0),e.YNc(3,T,5,1,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(5,"div",4)(6,"button",5),e.NdJ("click",function(){e.CHM(y);const h=e.oxw();return e.KtG(h.activeModal.close("Close click"))}),e._uU(7," Close "),e.qZA()(),e.BQk()}if(2&A){const y=e.MAs(4),x=e.oxw();e.xp6(2),e.Q6J("ngIf","image/png"==(null==x.imageUploadedView?null:x.imageUploadedView.fileType)||"image/jpeg"==(null==x.imageUploadedView?null:x.imageUploadedView.fileType)||"image/jpg"==(null==x.imageUploadedView?null:x.imageUploadedView.fileType))("ngIfElse",y)}}function b(A,I){if(1&A&&(e.ynx(0),e._UZ(1,"img",11),e.BQk()),2&A){const y=e.oxw(2);e.xp6(1),e.Q6J("src",y.fileURL,e.LSH)}}function C(A,I){if(1&A&&(e.ynx(0),e.TgZ(1,"div",7),e._UZ(2,"img",8)(3,"br"),e.TgZ(4,"a",9),e._uU(5,"click to open PDF "),e.qZA()(),e.BQk()),2&A){const y=e.oxw(3);e.xp6(4),e.s9C("href",y.fileURL,e.LSH)}}function q(A,I){if(1&A&&(e.ynx(0,12),e.YNc(1,C,6,1,"ng-container",13),e.BQk()),2&A){const y=e.oxw(2);e.Q6J("ngSwitch",y.fileType),e.xp6(1),e.Q6J("ngSwitchCase","pdf")}}function F(A,I){if(1&A){const y=e.EpF();e.TgZ(0,"div",2),e.YNc(1,b,2,1,"ng-container",0),e.YNc(2,q,2,2,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(4,"div",4)(5,"button",5),e.NdJ("click",function(){e.CHM(y);const h=e.oxw();return e.KtG(h.activeModal.close("Close click"))}),e._uU(6," Close "),e.qZA()()}if(2&A){const y=e.MAs(3),x=e.oxw();e.xp6(1),e.Q6J("ngIf","png"==x.fileType||"jpeg"==x.fileType||"jpg"==x.fileType||"svg"==x.fileType)("ngIfElse",y)}}let D=(()=>{class A{constructor(y,x){this.activeModal=y,this.sanitizer=x,this.viewOnly=!1,this.fileType="",this.fileURL=""}ngOnInit(){console.log(this.imageUploadedView),this.viewOnly=this.imageUploadedView?.viewOnly,this.viewOnly&&(this.fileType=this.getFileType(this.imageUploadedView.url),this.fileURL=this.imageUploadedView.url)}viewPdf(y){let x=URL.createObjectURL(y);return this.sanitizer.bypassSecurityTrustResourceUrl(x)}getFileType(y){return y?.split(".").pop().trim().toLowerCase()}}return A.\u0275fac=function(y){return new(y||A)(e.Y36(c.Kz),e.Y36(g.H7))},A.\u0275cmp=e.Xpm({type:A,selectors:[["app-view-file"]],inputs:{imageUploadedView:"imageUploadedView"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["viewOnlyURL",""],[1,"modal-body","p-2"],["pdf",""],[1,"btns-group","my-2","mx-0"],["type","button",1,"btn","btn-cancel",3,"click"],[1,"w-100",3,"src"],[1,"d-flex","justify-content-center","flex-column","align-items-center"],["height","80","width","80","src","assets/images/pdf.png","alt",""],["target","_blank",1,"text-decoration-none","text-capitalize",3,"href"],["elseExtViewBlock",""],[1,"w-100","mb-2",3,"src"],[3,"ngSwitch"],[4,"ngSwitchCase"]],template:function(y,x){if(1&y&&(e.YNc(0,d,8,2,"ng-container",0),e.YNc(1,F,7,2,"ng-template",null,1,e.W1O)),2&y){const h=e.MAs(2);e.Q6J("ngIf",!x.viewOnly)("ngIfElse",h)}},dependencies:[f.O5,f.RF,f.n9],styles:[".imagepath[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.imagepath-no[_ngcontent-%COMP%]{text-align:center;padding:50px}.btns-group[_ngcontent-%COMP%]{display:flex;justify-content:center}.btns-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{background:#f8f8f8;color:#dc3545;border-radius:10px;padding:12px 35px;font-weight:600}.card-pdf[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:150px}.card-pdf[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#000;font-size:18px;font-weight:600;display:block;padding:15px}"]}),A})()},81181:(J,M,_)=>{_.d(M,{n:()=>f});var e=_(94650),c=_(80529),g=_(69082);let f=(()=>{class m{constructor(d,b){this.http=d,this.sharedService=b,this.apiUrl=this.sharedService.getUrl,this.apiUrl2=this.sharedService.getUrl2}getBrands(d){return this.http.get(`${this.apiUrl2}Customer/GetBrands${d}`,this.sharedService.getHeaders())}getLookup(d){return this.http.get(`${this.apiUrl}Lookups/GetLookups${d}`,this.sharedService.getHeaders())}getCostCenter(d){return this.http.get(`${this.apiUrl}PettyCash/GetCostCenters${d}`,this.sharedService.getHeaders())}getMarkaziaVoucherList(d){return this.http.get(`${this.apiUrl}MarkaziaVouchers/GetMarkaziaVouchers${d}`,this.sharedService.getHeaders())}deleteMarkaziaVouchers(d){return this.http.post(`${this.apiUrl}MarkaziaVouchers/DeleteMarkaziaVouchers`,d,this.sharedService.getHeaders())}generateVoucher(d){return this.http.post(`${this.apiUrl}MarkaziaVouchers/GenerateMarkaziaVouchers`,d,this.sharedService.getHeaders())}}return m.\u0275fac=function(d){return new(d||m)(e.LFG(c.eN),e.LFG(g.F))},m.\u0275prov=e.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()},29975:(J,M,_)=>{_.d(M,{O:()=>q});var e=_(80529),c=_(54004),g=_(92340);const f={},m={Lookup:{GetLookups:"Lookup/GetLookups",GetAdminLookup:"Lookups/GetLookups",AddLookup:"Lookup/AddLookup",EditLookup:"Lookup/EditLookup",DeleteLookup:"Lookup/DeleteLookup"},PNsFollowUpControler:{AddPNNoteFollowUp:"PNsFollowUpControler/AddPNNoteFollowUp"},POSMachine:{SendCreditCardRequest:"POSMachine/send-credit-card-request",GetTerminalProviderMachine:"TerminalProviders/GetTerminalProviderMachine"},Treasury:{GetRefundedOrders:"Treasury/GetRefundedOrders"},Regenerate:{RegenerateOrderOrigionalInvoiceServiceOrder:"Cashier/RegenerateOrderOrigionalInvoiceServiceOrder",RegenerateOrigionalReceiptServiceOrder:"Cashier/RegenerateOrigionalReceiptServiceOrder",RegenerateOrigionalReceiptDirectPayment:"Cashier/RegenerateOrigionalReceiptDirectPayment",RegenerateOrigionalInvoiceSpareParts:"Cashier/RegenerateOrigionalInvoiceSpareParts",RegenerateOrigionalReceiptSpareParts:"Cashier/RegenerateOrigionalReceiptSpareParts",RegenerateORReceipt:"Cashier/RegenerateORReceipt",RegenerateOrigionalReceiptCustomer:"Cashier/RegenerateOrigionalReceiptCustomer",RegenerateCashierFullRefundOrder:"DirectPaymentReturnOrder/RegenerateCashierFullRefundOrder",RegenerateCashierRefundServiceOrder:"ServiceLayerReturnOrder/RegenerateCashierRefundServiceOrder",RegenerateSparePartReturnOrderInvoice:"SparePartsReturnOrder/RegenerateSparePartReturnOrderInvoice"}};var T=_(94650),d=_(68423),b=_(75304),C=_(69082);let q=(()=>{class F{constructor(A,I,y,x){this.http=A,this._spinnerService=I,this._helperService=y,this._sharedService=x,this.appRoutes=f,this.apiUrl=m}get getToken(){return localStorage.getItem("token")||sessionStorage.getItem("token")}get(A,I){let y=new e.WM({"Content-Type":"application/json; charset=utf-8","Access-Control-Allow-Origin":"*","Access-Control-Expose-Headers":"*","Access-Control-Allow-Methods":"GET","Access-Control-Allow-Headers":"*"});y=y.set("Authorization","Bearer "+this.getToken);let h="";return h="admin"===I?g.N.apiUrl2:"master"===I?g.N.masterBaseUrl:"cm"===I?g.N.cmBaseUrl:g.N.apiUrl,this.http.get(h+A,{headers:y}).pipe((0,c.U)(k=>"string"==typeof k?this.JsonParseData(k):k))}post(A,I,y){let x=new e.WM({...!(I instanceof FormData)&&{"Content-Type":"application/json; charset=utf-8"},"Access-Control-Allow-Origin":"*","Access-Control-Expose-Headers":"*","Access-Control-Allow-Methods":"POST","Access-Control-Allow-Headers":"*"});x=x.set("Authorization","Bearer "+this.getToken);let h={headers:x},k="";k="admin"===y?g.N.apiUrl2:"master"===y?g.N.masterBaseUrl:"cm"===y?g.N.cmBaseUrl:g.N.apiUrl;const p=I instanceof FormData?I:JSON.stringify(I);return this.http.post(k+A,p,{...h}).pipe((0,c.U)(N=>"string"==typeof N?this.JsonParseData(N):N))}JsonParseData(A){let I=A;try{I=JSON.parse(A)}catch(y){console.log(y)}return I}}return F.\u0275fac=function(A){return new(A||F)(T.LFG(e.eN),T.LFG(d.t2),T.LFG(b.v),T.LFG(C.F))},F.\u0275prov=T.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"}),F})()},87192:(J,M,_)=>{_.d(M,{z:()=>T});var e=_(94650),c=_(42953),g=_(36895);function f(d,b){1&d&&(e.ynx(0),e.TgZ(1,"h6",11),e._uU(2,"Are you sure?"),e.qZA(),e.BQk())}function m(d,b){if(1&d&&e._UZ(0,"p",12),2&d){const C=e.oxw();e.Q6J("innerHTML",null==C.data?null:C.data.body,e.oJD)}}let T=(()=>{class d{constructor(C){this._activeModel=C,this.eventData=new e.vpe}confirm(C){this.eventData.emit(C),this._activeModel.dismiss()}}return d.\u0275fac=function(C){return new(C||d)(e.Y36(c.Kz))},d.\u0275cmp=e.Xpm({type:d,selectors:[["app-confirm-modal"]],inputs:{data:"data"},outputs:{eventData:"eventData"},decls:15,vars:5,consts:[[1,"row"],[1,"col-12"],[1,"modal-header","border-0"],["ngbAutoFocus","",1,"font-20","fw-600","mb-0"],[1,"modal-body"],[4,"ngIf","ngIfElse"],["elseBlock",""],[1,"modal-footer","border-0"],[1,"btns-group","gap-2","mx-0"],["type","button",1,"btn","btn-save",3,"click"],["type","button",1,"btn","btn-cancel",3,"click"],[1,"mb-0","fw-500"],[1,"mb-0","fs-16","fw-500",3,"innerHTML"]],template:function(C,q){if(1&C&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),e._uU(4),e.qZA()(),e.TgZ(5,"div",4),e.YNc(6,f,3,0,"ng-container",5),e.YNc(7,m,1,1,"ng-template",null,6,e.W1O),e.qZA(),e.TgZ(9,"div",7)(10,"div",8)(11,"button",9),e.NdJ("click",function(){return q.confirm(!0)}),e._uU(12),e.qZA(),e.TgZ(13,"button",10),e.NdJ("click",function(){return q.confirm(!1)}),e._uU(14),e.qZA()()()()()),2&C){const F=e.MAs(8);e.xp6(4),e.Oqu((null==q.data?null:q.data.headingText)||"Confirm"),e.xp6(2),e.Q6J("ngIf",!(null!=q.data&&q.data.body))("ngIfElse",F),e.xp6(6),e.Oqu((null==q.data?null:q.data.confirmText)||"Yes"),e.xp6(2),e.Oqu((null==q.data?null:q.data.cancelText)||"No")}},dependencies:[g.O5]}),d})()},59442:(J,M,_)=>{_.d(M,{w:()=>c});var e=_(94650);let c=(()=>{class g{}return g.\u0275fac=function(m){return new(m||g)},g.\u0275cmp=e.Xpm({type:g,selectors:[["app-not-found"]],decls:3,vars:0,consts:[[1,"not-found"]],template:function(m,T){1&m&&(e.TgZ(0,"div",0)(1,"p"),e._uU(2," No data to display "),e.qZA()())},styles:[".not-found[_ngcontent-%COMP%]{text-align:center;padding:10%}.not-found[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#c9c9d1;font-size:16px;font-weight:600}"]}),g})()},53823:(J,M,_)=>{_.d(M,{V:()=>c});var e=_(94650);let c=(()=>{class g{constructor(){this.text=""}}return g.\u0275fac=function(m){return new(m||g)},g.\u0275cmp=e.Xpm({type:g,selectors:[["saving-loader"]],inputs:{text:"text"},decls:3,vars:1,consts:[["type","button","disabled","",1,"btn","btn-save","d-flex","align-items-center","gap-2"],[1,"fa-solid","fa-circle-notch","fa-spin"]],template:function(m,T){1&m&&(e.TgZ(0,"button",0),e._uU(1),e._UZ(2,"i",1),e.qZA()),2&m&&(e.xp6(1),e.hij(" ",T.text&&T.text||"Saving",""))}}),g})()},67711:(J,M,_)=>{_.d(M,{L:()=>T});var e=_(94650),c=_(36895);function g(d,b){if(1&d&&(e.TgZ(0,"span",2),e._uU(1),e.qZA()),2&d){const C=b.$implicit,q=e.oxw(3);e.xp6(1),e.Oqu(q.errorMessages[C])}}function f(d,b){if(1&d&&(e.ynx(0),e.YNc(1,g,2,1,"span",1),e.BQk()),2&d){const C=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",C.validationKeys)}}function m(d,b){if(1&d&&(e.ynx(0),e.YNc(1,f,2,1,"ng-container",0),e.BQk()),2&d){const C=e.oxw();e.xp6(1),e.Q6J("ngIf",C.control.invalid&&(C.control.dirty||C.control.touched))}}let T=(()=>{class d{get validationKeys(){let C=this.control;return C&&C.errors?Object.keys(C.errors):[]}}return d.\u0275fac=function(C){return new(C||d)},d.\u0275cmp=e.Xpm({type:d,selectors:[["validation-error"]],inputs:{control:"control",errorMessages:"errorMessages"},decls:1,vars:1,consts:[[4,"ngIf"],["class","validation-error d-block",4,"ngFor","ngForOf"],[1,"validation-error","d-block"]],template:function(C,q){1&C&&e.YNc(0,m,2,1,"ng-container",0),2&C&&e.Q6J("ngIf",null==q.control?null:q.control.errors)},dependencies:[c.sg,c.O5]}),d})()},80145:(J,M,_)=>{_.d(M,{O:()=>g,Q:()=>c});var e=_(94650);let c=(()=>{class f{constructor(T){this.el=T}onKeyDown(T){[8,9,13,27,46].indexOf(T.keyCode)}onKeyup(T){this.validateFields(T)}blockPaste(T){this.validateFields(T)}validateFields(T){this.el.nativeElement.value=this.el.nativeElement.value.replace(/[^A-Za-z\u0621-\u064a ]/g,""),T.preventDefault()}}return f.\u0275fac=function(T){return new(T||f)(e.Y36(e.SBq))},f.\u0275dir=e.lG2({type:f,selectors:[["","OnlyCharacter",""]],hostBindings:function(T,d){1&T&&e.NdJ("keydown",function(C){return d.onKeyDown(C)})("keyup",function(C){return d.onKeyup(C)})("paste",function(C){return d.blockPaste(C)})},inputs:{validationFieldsType:"validationFieldsType"}}),f})();function g(f){return f.replace(/[^A-Za-z\u0621-\u064a ]/g,"")}},55134:(J,M,_)=>{_.d(M,{Q:()=>c});var e=_(94650);let c=(()=>{class g{constructor(m){this.el=m,this.regex=new RegExp(/^\d*\.?\d{0,50}$/g),this.specialKeys=["Backspace","Tab","End","Home","ArrowLeft","ArrowRight","Del","Delete"]}onKeyDown(m){if(-1!==this.specialKeys.indexOf(m.key))return;const d=this.el.nativeElement.value.concat(m.key);d&&!String(d).match(this.regex)&&m.preventDefault()}setInputFocusOut(){let m=+this.el.nativeElement.value;m>0&&(this.el.nativeElement.value=m.toFixed(3))}}return g.\u0275fac=function(m){return new(m||g)(e.Y36(e.SBq))},g.\u0275dir=e.lG2({type:g,selectors:[["","appDecimalNumber",""]],hostBindings:function(m,T){1&m&&e.NdJ("keydown",function(b){return T.onKeyDown(b)})("blur",function(){return T.setInputFocusOut()})}}),g})()},75706:(J,M,_)=>{_.d(M,{Rr:()=>g,XQ:()=>c,qb:()=>e});var e=(()=>{return(m=e||(e={}))[m.Opened=16001]="Opened",m[m.Unclosed=16002]="Unclosed",m[m.Waiting=16003]="Waiting",m[m.Closed=16004]="Closed",m[m.Partial=16005]="Partial",m[m.Settled=16006]="Settled",m[m.OnHold=16007]="OnHold",m[m.RegisterFullDeposit=16008]="RegisterFullDeposit",m[m.PartiallySettled=16009]="PartiallySettled",m[m.Active=2001]="Active",e;var m})(),c=(()=>{return(m=c||(c={}))[m.ServicesSalesOrders=7001]="ServicesSalesOrders",m[m.DirectPaymentSalesOrders=7002]="DirectPaymentSalesOrders",m[m.SparePartsSalesOrders=7003]="SparePartsSalesOrders",m[m.OtherRevenues=7004]="OtherRevenues",m[m.CustomerPayments=7005]="CustomerPayments",m[m.BankUndertakingSalesOrders=7006]="BankUndertakingSalesOrders",m[m.InHouseFinancingSalesOrders=7007]="InHouseFinancingSalesOrders",m[m.PromissoryNotes=7008]="PromissoryNotes",c;var m})(),g=(()=>{return(m=g||(g={}))[m.Refunded=33004]="Refunded",g;var m})()}}]);