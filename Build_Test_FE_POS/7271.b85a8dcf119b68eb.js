"use strict";(self.webpackChunkmarkaizaAdmin=self.webpackChunkmarkaizaAdmin||[]).push([[7271],{67271:(j,g,i)=>{i.r(g),i.d(g,{LoginModule:()=>R});var d=i(36895),c=i(39485),e=i(94650),f=i(69082);let p=(()=>{class t{constructor(o,s){this.router=o,this.sharedService=s,this.isLog=!1,console.log(!!this.sharedService.getToken),this.isLog=!!this.sharedService.getToken}canActivate(o,s){return!this.sharedService.getToken||(this.router.navigate(["/"]),!1)}}return t.\u0275fac=function(o){return new(o||t)(e.LFG(c.F0),e.LFG(f.F))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var a=i(24006),m=i(53396),v=i(50727),I=i(97185),b=i(48766),y=i(68423),S=i(79345),M=i(36690),u=i(8672),Z=i(21864),L=i(75304),T=i(92216);function N(t,r){1&t&&(e.TgZ(0,"div",26)(1,"p",27),e._uU(2,"Please wait.................loading your permissions."),e.qZA()())}function w(t,r){1&t&&(e.TgZ(0,"span")(1,"span",30),e._uU(2,"Please Enter Email."),e.qZA()())}function C(t,r){if(1&t&&(e.TgZ(0,"div",28),e.YNc(1,w,3,0,"span",29),e.qZA()),2&t){const o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.itemForm.controls.identity.errors)}}function x(t,r){if(1&t){const o=e.EpF();e.TgZ(0,"fa-icon",31),e.NdJ("click",function(){e.CHM(o);const n=e.oxw();return e.KtG(n.showPassword())}),e.qZA()}if(2&t){const o=e.oxw();e.Q6J("icon",o.faEye)}}function k(t,r){if(1&t){const o=e.EpF();e.TgZ(0,"fa-icon",31),e.NdJ("click",function(){e.CHM(o);const n=e.oxw();return e.KtG(n.showPassword())}),e.qZA()}if(2&t){const o=e.oxw();e.Q6J("icon",o.faEyeSlash)}}function J(t,r){1&t&&(e.TgZ(0,"span")(1,"span",30),e._uU(2,"Please Enter Password ."),e.qZA()())}function U(t,r){if(1&t&&(e.TgZ(0,"div",28),e.YNc(1,J,3,0,"span",29),e.qZA()),2&t){const o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.itemForm.controls.password.errors)}}function F(t,r){if(1&t&&(e.TgZ(0,"div",32),e._uU(1),e.qZA()),2&t){const o=e.oxw();e.xp6(1),e.hij(" ",o.errorMessage," ")}}function _(t,r){1&t&&(e.TgZ(0,"button",33),e._uU(1,"Login"),e.qZA())}function A(t,r){1&t&&(e.TgZ(0,"button",34),e._UZ(1,"i",35),e.qZA())}const D=[{path:"",component:(()=>{class t{constructor(o,s,n,l,E,O,Q,B,G,z,q){this.toastr=o,this.utlilitySerivce=s,this.spinner=n,this.router=l,this.formBuilder=E,this.httpserviceService=O,this.headerService=Q,this.connectionService=B,this._generalService=G,this._commonService=z,this._activeRoute=q,this.formModel={},this.faUser=m.ILF,this.faEye=m.Mdf,this.faEyeSlash=m.Aq,this.IsshowPassword=!1,this.userInfo={},this.rememberMe=!1,this.isRemembered=!1,this.subscription=new v.w0,this.status="ONLINE",this.isConnected=!0,this.token="",this.connectionService.monitor().subscribe(h=>{console.log(h),this.isConnected=h.hasNetworkConnection,this.isConnected?(this.status="ONLINE",console.log(this.status)):(this.status="OFFLINE",console.log(this.status))}),this.itemForm=this.formBuilder.group({identity:[this.formModel.identity,[a.kI.required]],password:[this.formModel.password,[a.kI.required]],rememberMe:[this.formModel.rememberMe]})}ngOnInit(){this.checkRememberMe(),this.getToken()}getToken(){this._activeRoute.queryParams.subscribe(o=>{if(this.token=o.token,this.token){localStorage.setItem("redirectUrl",o.redirectUrl);let n=this._commonService.decodeToken(this.token);sessionStorage.setItem("token",this.token),console.log(n),n?.Register2&&(this.register2=JSON.parse(n.Register2)),this.getUserDetails(+n.nameid),this.getUserPermissions(+n.nameid)}})}getUserPermissions(o){this._generalService.getUserPermissions(o).subscribe(s=>{localStorage.setItem("permissions",JSON.stringify(s.data))})}getUserDetails(o){this._generalService.GetUserDetails(o).subscribe(s=>{this.userData=s.data,console.log(this.userData),localStorage.setItem("fullName",this.userData.fullName),localStorage.setItem("city",this.userData.city),localStorage.setItem("userid",this.userData.userId),localStorage.setItem("role",JSON.stringify(this.userData.role)),localStorage.setItem("branch",JSON.stringify(this.userData.branch)),this.register2&&localStorage.setItem("register",JSON.stringify({registerObj:{id:this.register2.Id,registersName:this.register2.RegistersName,registeBranch:{branchId:this.register2.RegisteBranch.BranchId,branchName:this.register2.RegisteBranch.BranchName,city:this.register2.RegisteBranch.City}}})),this.getUserMenu()})}getUserMenu(){this._generalService.GetUserMenuNew(17001).subscribe(o=>{let s=o?.data?.menu[0]?.items;if(s.length){for(let l of s)if(l?.canClick){this._commonService.NavigateToRoute(l?.url);break}0==s.filter(l=>l.canClick).length&&this._commonService.NavigateToRoute("no-menu")}else this._commonService.NavigateToRoute("no-menu")})}ngOnDestroy(){this.subscription.unsubscribe()}checkRememberMe(){null!==localStorage.getItem("rememberMe")&&(this.itemForm.controls.identity.setValue(localStorage.getItem("identity")),this.itemForm.controls.password.setValue(localStorage.getItem("password")),this.formModel.identity=localStorage.getItem("identity"),this.formModel.password=localStorage.getItem("password"),this.formModel.rememberMe=!0,this.rememberMe=!0,this.isRemembered=!0)}showPassword(){this.IsshowPassword=0==this.IsshowPassword}onLogin(){this.itemForm.valid?"ONLINE"==this.status?(this.userInfo={},this.isLoading=!0,this.httpserviceService.login(this.itemForm.value).subscribe(o=>{this.userInfo=o,this.userData=o.data,console.log(this.userData),this.userData?(this.isLoading=!1,localStorage.setItem("fullName",this.userData.fullName),localStorage.setItem("city",this.userData.city),localStorage.setItem("userid",this.userData.id),localStorage.setItem("role",JSON.stringify(this.userData.role)),localStorage.setItem("branch",JSON.stringify(this.userData.branch)),localStorage.setItem("register",JSON.stringify(this.userData.register)),localStorage.setItem("permissions",JSON.stringify(this.userData.permissions)),1==this.rememberMe?(localStorage.setItem("identity",this.itemForm.controls.identity.value),localStorage.setItem("password",this.itemForm.controls.password.value),localStorage.setItem("rememberMe",this.rememberMe.toString()),localStorage.setItem("token",this.userData.token)):sessionStorage.setItem("token",this.userData.token),(1==this.userData?.role?.roleId||36==this.userData?.role?.roleId||37==this.userData?.role?.roleId||38==this.userData?.role?.roleId)&&this.getUserMenu()):(this.errorMessage=(o=this.userInfo.Errors[0]).ErrorMessageEn,this.isLoading=!1)},o=>{this.isLoading=!1,this.spinner.hide(),this.errorMessage=o.error.errors[0].ErrorMessageEn})):this.errorMessage="Please check your connection, Network error":this.itemForm.markAllAsTouched()}rememberMeClick(o){alert(o)}}return t.\u0275fac=function(o){return new(o||t)(e.Y36(I._W),e.Y36(b.k),e.Y36(y.t2),e.Y36(c.F0),e.Y36(a.qu),e.Y36(S.h),e.Y36(M.r),e.Y36(u.Mo),e.Y36(Z.m),e.Y36(L.v),e.Y36(c.gz))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-login"]],decls:41,vars:13,consts:[[1,"page-login","d-flex","align-items-center","justify-content-center"],[1,"d-block","fa-solid","fa-circle-notch","fa-spin","primary-clr","me-4",2,"font-size","80px"],["class","d-flex flex-column gap-2",4,"ngIf"],[1,"container-fluid","px-0","mx-0","d-none"],[1,"row","px-0","mx-0"],[1,"col-md-6","col-sm-12","px-0","mx-0"],[1,"card-login"],["src","assets/images/markazia.png","alt","logo"],[1,"log-text"],[3,"formGroup","ngSubmit"],[1,"form-group"],["type","text","formControlName","identity","placeholder","example@markazia.jo",1,"form-control",3,"ngModel"],["class","ng-dirty",4,"ngIf"],["formControlName","password",1,"form-control",3,"type","ngModel"],[1,"passicon"],["class","custom-search-botton",3,"icon","click",4,"ngIf"],[1,"form-group","rememberme"],[1,"form-check"],["type","checkbox","formControlName","rememberMe","name","rememberbtn","id","rememberMe",1,"form-check-input",3,"ngModel","ngModelChange"],["for","rememberMe",1,"form-check-label"],["routerLink","/forgot-password",1,"forgetpass"],["class","alert alert-danger","role","alert",4,"ngIf"],["type","submit","class","btn btn-login",4,"ngIf"],["type","button","class","btn btn-login",4,"ngIf"],[1,"bg-image"],["src","assets/images/loginLogo.png","alt",""],[1,"d-flex","flex-column","gap-2"],[1,"fw-600","m-0"],[1,"ng-dirty"],[4,"ngIf"],[1,"error"],[1,"custom-search-botton",3,"icon","click"],["role","alert",1,"alert","alert-danger"],["type","submit",1,"btn","btn-login"],["type","button",1,"btn","btn-login"],[1,"fa-solid","fa-circle-notch","fa-spin"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"i",1),e.YNc(2,N,3,0,"div",2),e.TgZ(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),e._UZ(7,"img",7),e.TgZ(8,"div",8)(9,"p"),e._uU(10,"Please fill your detail to access your account."),e.qZA()(),e.TgZ(11,"form",9),e.NdJ("ngSubmit",function(){return s.onLogin()}),e.TgZ(12,"div",10)(13,"label"),e._uU(14,"Email"),e.qZA(),e.TgZ(15,"div"),e._UZ(16,"input",11),e.YNc(17,C,2,1,"div",12),e.qZA()(),e.TgZ(18,"div",10)(19,"label"),e._uU(20,"Password"),e.qZA(),e.TgZ(21,"div"),e._UZ(22,"input",13),e.TgZ(23,"div",14),e.YNc(24,x,1,1,"fa-icon",15),e.YNc(25,k,1,1,"fa-icon",15),e.qZA()(),e.YNc(26,U,2,1,"div",12),e.qZA(),e.TgZ(27,"div",16)(28,"div",17)(29,"input",18),e.NdJ("ngModelChange",function(l){return s.rememberMe=l}),e.qZA(),e.TgZ(30,"label",19),e._uU(31," Remember Me "),e.qZA()(),e.TgZ(32,"a",20),e._uU(33,"Forget your password ?"),e.qZA()(),e.YNc(34,F,2,1,"div",21),e.TgZ(35,"div"),e.YNc(36,_,2,0,"button",22),e.YNc(37,A,2,0,"button",23),e.qZA()()()(),e.TgZ(38,"div",5)(39,"div",24),e._UZ(40,"img",25),e.qZA()()()()()),2&o&&(e.xp6(2),e.Q6J("ngIf",s.token),e.xp6(9),e.Q6J("formGroup",s.itemForm),e.xp6(5),e.Q6J("ngModel",s.formModel.identity),e.xp6(1),e.Q6J("ngIf",s.itemForm.controls.identity.invalid&&(s.itemForm.controls.identity.dirty||s.itemForm.controls.identity.touched)),e.xp6(5),e.Q6J("type",s.IsshowPassword?"text":"password")("ngModel",s.formModel.password),e.xp6(2),e.Q6J("ngIf",!s.IsshowPassword),e.xp6(1),e.Q6J("ngIf",s.IsshowPassword),e.xp6(1),e.Q6J("ngIf",s.itemForm.controls.password.invalid&&(s.itemForm.controls.password.dirty||s.itemForm.controls.password.touched)),e.xp6(3),e.Q6J("ngModel",s.rememberMe),e.xp6(5),e.Q6J("ngIf",s.errorMessage),e.xp6(2),e.Q6J("ngIf",!s.isLoading),e.xp6(1),e.Q6J("ngIf",s.isLoading))},dependencies:[d.O5,c.rH,a._Y,a.Fj,a.Wl,a.JJ,a.JL,a.sg,a.u,T.BN]}),t})(),canActivate:[p]}];let Y=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[c.Bz.forChild(D),c.Bz]}),t})();var P=i(21515);let R=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[d.ez,Y,a.u5,a.UX,P.m,u.XY]}),t})()}}]);